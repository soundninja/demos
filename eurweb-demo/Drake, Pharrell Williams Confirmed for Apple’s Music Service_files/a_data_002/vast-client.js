!function(e){if("object"==typeof exports)module.exports=e();else if("function"==typeof define&&define.amd)define(e);else{var t;"undefined"!=typeof window?t=window:"undefined"!=typeof global?t=global:"undefined"!=typeof self&&(t=self),t.DMVAST=e()}}(function(){return function e(t,r,i){function n(a,o){if(!r[a]){if(!t[a]){var l="function"==typeof require&&require;if(!o&&l)return l(a,!0);if(s)return s(a,!0);throw new Error("Cannot find module '"+a+"'")}var u=r[a]={exports:{}};t[a][0].call(u.exports,function(e){var r=t[a][1][e];return n(r?r:e)},u,u.exports,e,t,r,i)}return r[a].exports}for(var s="function"==typeof require&&require,a=0;a<i.length;a++)n(i[a]);return n}({1:[function(e,t){function r(){this._events=this._events||{},this._maxListeners=this._maxListeners||void 0}function i(e){return"function"==typeof e}function n(e){return"number"==typeof e}function s(e){return"object"==typeof e&&null!==e}function a(e){return void 0===e}t.exports=r,r.EventEmitter=r,r.prototype._events=void 0,r.prototype._maxListeners=void 0,r.defaultMaxListeners=10,r.prototype.setMaxListeners=function(e){if(!n(e)||0>e||isNaN(e))throw TypeError("n must be a positive number");return this._maxListeners=e,this},r.prototype.emit=function(e){var t,r,n,o,l,u;if(this._events||(this._events={}),"error"===e&&(!this._events.error||s(this._events.error)&&!this._events.error.length))throw t=arguments[1],t instanceof Error?t:TypeError('Uncaught, unspecified "error" event.');if(r=this._events[e],a(r))return!1;if(i(r))switch(arguments.length){case 1:r.call(this);break;case 2:r.call(this,arguments[1]);break;case 3:r.call(this,arguments[1],arguments[2]);break;default:for(n=arguments.length,o=new Array(n-1),l=1;n>l;l++)o[l-1]=arguments[l];r.apply(this,o)}else if(s(r)){for(n=arguments.length,o=new Array(n-1),l=1;n>l;l++)o[l-1]=arguments[l];for(u=r.slice(),n=u.length,l=0;n>l;l++)u[l].apply(this,o)}return!0},r.prototype.addListener=function(e,t){var n;if(!i(t))throw TypeError("listener must be a function");if(this._events||(this._events={}),this._events.newListener&&this.emit("newListener",e,i(t.listener)?t.listener:t),this._events[e]?s(this._events[e])?this._events[e].push(t):this._events[e]=[this._events[e],t]:this._events[e]=t,s(this._events[e])&&!this._events[e].warned){var n;n=a(this._maxListeners)?r.defaultMaxListeners:this._maxListeners,n&&n>0&&this._events[e].length>n&&(this._events[e].warned=!0,console.error("(node) warning: possible EventEmitter memory leak detected. %d listeners added. Use emitter.setMaxListeners() to increase limit.",this._events[e].length),console.trace())}return this},r.prototype.on=r.prototype.addListener,r.prototype.once=function(e,t){function r(){this.removeListener(e,r),n||(n=!0,t.apply(this,arguments))}if(!i(t))throw TypeError("listener must be a function");var n=!1;return r.listener=t,this.on(e,r),this},r.prototype.removeListener=function(e,t){var r,n,a,o;if(!i(t))throw TypeError("listener must be a function");if(!this._events||!this._events[e])return this;if(r=this._events[e],a=r.length,n=-1,r===t||i(r.listener)&&r.listener===t)delete this._events[e],this._events.removeListener&&this.emit("removeListener",e,t);else if(s(r)){for(o=a;o-->0;)if(r[o]===t||r[o].listener&&r[o].listener===t){n=o;break}if(0>n)return this;1===r.length?(r.length=0,delete this._events[e]):r.splice(n,1),this._events.removeListener&&this.emit("removeListener",e,t)}return this},r.prototype.removeAllListeners=function(e){var t,r;if(!this._events)return this;if(!this._events.removeListener)return 0===arguments.length?this._events={}:this._events[e]&&delete this._events[e],this;if(0===arguments.length){for(t in this._events)"removeListener"!==t&&this.removeAllListeners(t);return this.removeAllListeners("removeListener"),this._events={},this}if(r=this._events[e],i(r))this.removeListener(e,r);else for(;r.length;)this.removeListener(e,r[r.length-1]);return delete this._events[e],this},r.prototype.listeners=function(e){var t;return t=this._events&&this._events[e]?i(this._events[e])?[this._events[e]]:this._events[e].slice():[]},r.listenerCount=function(e,t){var r;return r=e._events&&e._events[t]?i(e._events[t])?1:e._events[t].length:0}},{}],2:[function(e,t){var r;r=function(){function e(){this.sequence=0,this.version=0,this.id=null,this.adTitle=null,this.adSystem=null,this.description=null,this.advertiser=null,this.surveyURL=[],this.pricing={},this.extensions=null,this.errorURLTemplates=[],this.impressionURLTemplates=[],this.creatives=[]}return e}(),t.exports=r},{}],3:[function(e,t){var r,i,n;i=e("./parser.coffee"),n=e("./util.coffee"),r=function(){function e(){}return e.cappingFreeLunch=0,e.cappingMinimumTimeInterval=0,e.timeout=0,e.get=function(e,t){var r;return r=+new Date,this.totalCallsTimeout<r?(this.totalCalls=1,this.totalCallsTimeout=r+36e5):this.totalCalls++,this.cappingFreeLunch>=this.totalCalls?void t(null):r-this.lastSuccessfullAd<this.cappingMinimumTimeInterval?void t(null):i.parse(e,function(){return function(e){return t(e)}}(this))},function(){var t,r;r=n.storage,t=Object.defineProperty,["lastSuccessfullAd","totalCalls","totalCallsTimeout"].forEach(function(i){t(e,i,{get:function(){return r.getItem(i)},set:function(e){return r.setItem(i,e)},configurable:!1,enumerable:!0})}),null==e.totalCalls&&(e.totalCalls=0),null==e.totalCallsTimeout&&(e.totalCallsTimeout=0)}(),e}(),t.exports=r},{"./parser.coffee":8,"./util.coffee":14}],4:[function(e,t){var r;r=function(){function e(){this.id=null,this.width=0,this.height=0,this.expandedHeight=0,this.expandedWidth=0,this.assetWidth=0,this.assetHeight=0,this.adSlotID=0,this.required="",this.scalable=!1,this.maintainAspectRatio=!1,this.minSuggestedDuration=1e3,this.apiFramework="vast",this.creativeType=null,this.resourceType=null,this.resource=null,this.companionClickThroughURLTemplate=null,this.adParameters={},this.trackingEvents={}}return e}(),t.exports=r},{}],5:[function(e,t){var r,i,n,s,a={}.hasOwnProperty,o=function(e,t){function r(){this.constructor=e}for(var i in t)a.call(t,i)&&(e[i]=t[i]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};r=function(){function e(){this.sequence=0,this.adParameters={},this.trackingEvents={}}return e}(),n=function(e){function t(){t.__super__.constructor.apply(this,arguments),this.type="linear",this.duration=0,this.skipDelay=null,this.mediaFiles=[],this.progressTracking={},this.icons=[],this.videoClickThroughURLTemplate=null,this.videoClickTrackingURLTemplate=null,this.videoCustomClick=null}return o(t,e),t}(r),s=function(e){function t(){t.__super__.constructor.apply(this,arguments),this.type="nonlinear",this.variations=[]}return o(t,e),t}(r),i=function(e){function t(){t.__super__.constructor.apply(this,arguments),this.type="companion",this.altText="",this.variations=[]}return o(t,e),t}(r),t.exports={VASTCreativeLinear:n,VASTCreativeNonLinear:s,VASTCreativeCompanion:i}},{}],6:[function(e,t){t.exports={client:e("./client.coffee"),tracker:e("./tracker.coffee"),parser:e("./parser.coffee"),util:e("./util.coffee")}},{"./client.coffee":3,"./parser.coffee":8,"./tracker.coffee":10,"./util.coffee":14}],7:[function(e,t){var r;r=function(){function e(){this.fileURL=null,this.deliveryType="progressive",this.mimeType=null,this.codec=null,this.bitrate=0,this.minBitrate=0,this.maxBitrate=0,this.apiFramework=null,this.scalable=!1,this.maintainAspectRatio=null,this.width=0,this.height=0}return e}(),t.exports=r},{}],8:[function(e,t){var r,i,n,s,a,o,l,u,c,h,p,d,f,g=[].indexOf||function(e){for(var t=0,r=this.length;r>t;t++)if(t in this&&this[t]===e)return t;return-1};r=e("./urlhandler.coffee"),p=e("./response.coffee"),i=e("./ad.coffee"),d=e("./util.coffee"),o=e("./creative.coffee").VASTCreativeLinear,a=e("./creative.coffee").VASTCreativeCompanion,s=e("./creative.coffee").VASTCreativeNonLinear,l=e("./mediafile.coffee"),n=e("./companionad.coffee"),f=e("./nonlinearad.coffee"),u=e("./icon.coffee"),c=e("./adparameters.coffee"),h=function(){function e(){}var t;return t=[],e.addURLTemplateFilter=function(e){"function"==typeof e&&t.push(e)},e.removeURLTemplateFilter=function(){return t.pop()},e.countURLTemplateFilters=function(){return t.length},e.clearUrlTemplateFilters=function(){return t=[]},e.parse=function(e,t){return this._parse(e,null,function(e,r){return t(r)})},e.parseXml=function(e,t,r){return null==t&&(t=[]),function(e,i){var n,s,a,o,l,u,c,h,f,m,v,T;if(null!=i)return r(i);if(l=new p,null==(null!=e?e.documentElement:void 0)||"VAST"!==e.documentElement.nodeName)return l.errorCode=100,l.errorMessage="No VAST tag found",r(l);for(u=e.documentElement.getAttribute("version")||"2.0",v=e.documentElement.childNodes,c=0,f=v.length;f>c;c++)o=v[c],"Error"===o.nodeName&&l.errorURLTemplates.push(this.DMVAST.parser.parseNodeText(o));for(T=e.documentElement.childNodes,h=0,m=T.length;m>h;h++)o=T[h],"Ad"===o.nodeName&&(n=this.DMVAST.parser.parseAdElement(o),l.adId=n.id,n.version=u,null!=n?l.ads.push(n):d.track(l.errorURLTemplates,{ERRORCODE:101}));for(s=function(){var e,t,i;if(l){for(i=l.ads,e=0,t=i.length;t>e;e++)if(n=i[e],null!=n.nextWrapperURL)return;return 0===l.ads.length&&(d.track(l.errorURLTemplates,{ERRORCODE:303}),l.errorCode=1,l.errorMessage="Ad tag empty"),r(l)}},a=l.ads.length;a--;)n=l.ads[a],null!=n.nextWrapperURL&&!function(e){var r,i;return t.length>=10||(i=e.nextWrapperURL,g.call(t,i)>=0)?(d.track(e.errorURLTemplates,{ERRORCODE:302}),l.ads.splice(l.ads.indexOf(e),1),void s()):(-1===e.nextWrapperURL.indexOf("://")&&(r=url.slice(0,url.lastIndexOf("/")),e.nextWrapperURL=""+r+"/"+e.nextWrapperURL),this.DMVAST.parser._parse(e.nextWrapperURL,t,function(t,r){var i,n,a,o,u,c,h,p,f,g,m,v,T,k;if(null!=t)d.track(e.errorURLTemplates,{ERRORCODE:301}),l.ads.splice(l.ads.indexOf(e),1);else if(null==r)d.track(e.errorURLTemplates,{ERRORCODE:303}),l.ads.splice(l.ads.indexOf(e),1);else for(l.errorURLTemplates=l.errorURLTemplates.concat(r.errorURLTemplates),a=l.ads.indexOf(e),l.ads.splice(a,1),v=r.ads,c=0,h=v.length;h>c;c++){if(o=v[c],o.errorURLTemplates=e.errorURLTemplates.concat(o.errorURLTemplates),o.impressionURLTemplates=e.impressionURLTemplates.concat(o.impressionURLTemplates),null!=e.trackingEvents)for(T=o.creatives,g=0,p=T.length;p>g;g++)for(i=T[g],k=Object.keys(e.trackingEvents),m=0,f=k.length;f>m;m++)n=k[m],(u=i.trackingEvents)[n]||(u[n]=[]),i.trackingEvents[n]=i.trackingEvents[n].concat(e.trackingEvents[n]);if(null!=e.progressTracking)for(T=o.creatives,g=0,p=T.length;p>g;g++)for(i=T[g],k=Object.keys(e.progressTracking),m=0,f=k.length;f>m;m++)n=k[m],(u=i.progressTracking)[n]||(u[n]=[]),i.progressTracking[n]=i.progressTracking[n].concat(e.progressTracking[n]);l.ads.splice(a,0,o)}return delete e.nextWrapperURL,s()}))}(n);return s()}(e)},e._parse=function(e,i,n){var s,a,o;for(a=0,o=t.length;o>a;a++)s=t[a],e=s(e);return null==i&&(i=[]),i.push(e),r.get(e,function(t){return function(r,s){var a,o,l,u,c,h,f,m,v,T,k,y;if(null!=r)return n(r);if(c=new p,null==(null!=s?s.documentElement:void 0)||"VAST"!==s.documentElement.nodeName)return c.errorCode=100,c.errorMessage="No VAST tag found",n(r,c);for(h=s.documentElement.getAttribute("version")||"2.0",k=s.documentElement.childNodes,f=0,v=k.length;v>f;f++)u=k[f],"Error"===u.nodeName&&c.errorURLTemplates.push(t.parseNodeText(u));for(y=s.documentElement.childNodes,m=0,T=y.length;T>m;m++)u=y[m],"Ad"===u.nodeName&&(a=t.parseAdElement(u),c.adId=u.getAttribute("id")||"",a.version=h,null!=a?c.ads.push(a):d.track(c.errorURLTemplates,{ERRORCODE:101}));for(o=function(){var e,t,r;if(c){for(r=c.ads,e=0,t=r.length;t>e;e++)if(a=r[e],null!=a.nextWrapperURL)return;return 0===c.ads.length&&(d.track(c.errorURLTemplates,{ERRORCODE:303}),0==c.errorCode&&(c.errorCode=1,c.errorMessage="Ad tag empty")),n(null,c)}},l=c.ads.length;l--;)a=c.ads[l],null!=a.nextWrapperURL&&!function(r){var n,s;return i.length>=10||(s=r.nextWrapperURL,g.call(i,s)>=0)?(d.track(r.errorURLTemplates,{ERRORCODE:302}),c.ads.splice(c.ads.indexOf(r),1),void o()):(-1===r.nextWrapperURL.indexOf("://")&&(n=e.slice(0,e.lastIndexOf("/")),r.nextWrapperURL=""+n+"/"+r.nextWrapperURL),t._parse(r.nextWrapperURL,i,function(e,t){var i,n,s,a,l,u,h,p,f,g,m,v,T,k;if(null!=e)return d.track(r.errorURLTemplates,{ERRORCODE:301}),void c.ads.splice(c.ads.indexOf(r),1);if(0!=t.errorCode&&d.track(r.errorURLTemplates,{ERRORCODE:303}),null!=e)d.track(r.errorURLTemplates,{ERRORCODE:301}),c.ads.splice(c.ads.indexOf(r),1);else if(null==t)d.track(r.errorURLTemplates,{ERRORCODE:303}),c.ads.splice(c.ads.indexOf(r),1);else for(c.errorURLTemplates=c.errorURLTemplates.concat(t.errorURLTemplates),s=c.ads.indexOf(r),c.ads.splice(s,1),v=t.ads,u=0,h=v.length;h>u;u++){if(a=v[u],a.errorURLTemplates=r.errorURLTemplates.concat(a.errorURLTemplates),a.impressionURLTemplates=r.impressionURLTemplates.concat(a.impressionURLTemplates),null!=r.trackingEvents)for(T=a.creatives,g=0,p=T.length;p>g;g++)for(i=T[g],k=Object.keys(r.trackingEvents),m=0,f=k.length;f>m;m++)n=k[m],(l=i.trackingEvents)[n]||(l[n]=[]),i.trackingEvents[n]=i.trackingEvents[n].concat(r.trackingEvents[n]);if(null!=r.progressTracking)for(T=a.creatives,g=0,p=T.length;p>g;g++)for(i=T[g],k=Object.keys(r.progressTracking),m=0,f=k.length;f>m;m++)n=k[m],(l=i.progressTracking)[n]||(l[n]=[]),i.progressTracking[n]=i.progressTracking[n].concat(r.progressTracking[n]);c.ads.splice(s,0,a)}return delete r.nextWrapperURL,o()}))}(a);return o()}}(this))},e.childByName=function(e,t){var r,i,n,s;for(s=e.childNodes,i=0,n=s.length;n>i;i++)if(r=s[i],r.nodeName===t)return r},e.childsByName=function(e,t){var r,i,n,s,a;for(i=[],a=e.childNodes,n=0,s=a.length;s>n;n++)r=a[n],r.nodeName===t&&i.push(r);return i},e.parseAdElement=function(e){var t,r,i,n;for(n=e.childNodes,r=0,i=n.length;i>r;r++){if(t=n[r],"Wrapper"===t.nodeName)return this.parseWrapperElement(t);if("InLine"===t.nodeName)return this.parseInLineElement(t)}},e.parseWrapperElement=function(e){var t,r,i;return t=this.parseInLineElement(e),i=this.childByName(e,"VASTAdTagURI"),null!=i&&(t.nextWrapperURL=this.parseNodeText(i)),r=t.creatives[0],null!=r&&null!=r.trackingEvents&&(t.trackingEvents=r.trackingEvents),null!=r&&null!=r.progressTracking&&(t.progressTracking=r.progressTracking),null!=t.nextWrapperURL?t:void 0},e.parseInLineElement=function(e){var t,r,n,s,a,o,l,u,c,h,p,d,f,g,m;for(t=new i,t.id=e.parentNode.getAttribute("id")||0,t.sequence=e.getAttribute("sequence")||0,d=e.childNodes,o=0,c=d.length;c>o;o++)switch(a=d[o],a.nodeName){case"Error":t.errorURLTemplates.push(this.parseNodeText(a));break;case"AdTitle":t.adTitle=this.parseNodeText(a);break;case"AdSystem":t.adSystem=this.parseNodeText(a);break;case"Description":t.description=this.parseNodeText(a);break;case"Advertiser":t.advertiser=this.parseNodeText(a)||"";break;case"Survey":t.surveyURL.push(this.parseNodeText(a));break;case"Pricing":t.pricing.model=a.getAttribute("model")||0,t.pricing.currency=a.getAttribute("currency")||0;break;case"Impression":m=this.parseNodeText(a),null!=m&&void 0!=m&&t.impressionURLTemplates.push(m);break;case"Creatives":for(f=this.childsByName(a,"Creative"),l=0,h=f.length;h>l;l++)for(n=f[l],g=n.childNodes,u=0,p=g.length;p>u;u++)switch(s=g[u],s.nodeName){case"Linear":r=this.parseCreativeLinearElement(s),r&&t.creatives.push(r);break;case"NonLinearAds":r=this.parseCreativeNonLinearElement(s),r&&t.creatives.push(r);break;case"CompanionAds":r=this.parseCompanionAd(s),r&&t.creatives.push(r)}}return t},e.parseCreativeNonLinearElement=function(e){var t,r,i,n,a,o,l,u,h,p,d,g,m,v,T,k,y,L,R,x,A,N,E,b,w,U,C,_,D,O,B;for(t=new s,U=this.childsByName(e,"NonLinear"),v=0,L=U.length;L>v;v++){for(o=U[v],a=new f,a.width=o.getAttribute("width")||0,a.height=o.getAttribute("height")||0,a.expandedHeight=o.getAttribute("expandedHeight")||0,a.expandedWidth=o.getAttribute("expandedWidth")||0,a.scalable=o.getAttribute("scalable")||!1,a.maintainAspectRatio=o.getAttribute("maintainAspectRatio")||!1,a.minSuggestedDuration=o.getAttribute("minSuggestedDuration")||1e4,a.apiFramework=o.getAttribute("apiFramework")||"vast",C=this.childsByName(o,"StaticResource"),T=0,R=C.length;R>T;T++)h=C[T],a.creativeType=h.getAttribute("creativeType")||0,a.resourceType="static",a.resource=this.parseNodeText(h);for(_=this.childsByName(o,"IFrameResource"),k=0,x=_.length;x>k;k++)n=_[k],a.creativeType=n.getAttribute("creativeType")||0,a.resourceType="iframe",a.resource=this.parseNodeText(n);for(D=this.childsByName(o,"HTMLResource"),y=0,A=D.length;A>y;y++)i=D[y],a.creativeType=i.getAttribute("creativeType")||0,a.resourceType="html",a.resource=this.parseNodeText(i);for(O=this.childsByName(e,"TrackingEvents"),b=0,N=O.length;N>b;b++)for(d=O[b],B=this.childsByName(d,"Tracking"),w=0,E=B.length;E>w;w++)p=B[w],r=p.getAttribute("event"),g=this.parseNodeText(p),null!=r&&null!=g&&(null==(m=a.trackingEvents)[r]&&(m[r]=[]),a.trackingEvents[r].push(g));a.clickThroughURLTemplate=this.parseNodeText(this.childByName(o,"NonLinearClickThrough"))||"",a.clickTrackingURLTemplate=this.parseNodeText(this.childByName(o,"NonLinearClickTracking"))||"",t.variations.push(a),l=this.childByName(o,"AdParameters"),null!=l&&(u=new c,u.parameters=this.parseNodeText(l),u.xmlEncoded=l.getAttribute("xmlEncoded")||!1,a.adParameters=u)}return t},e.parseCreativeLinearElement=function(e){var t,r,i,n,s,a,h,p,d,f,g,m,v,T,k,y,L,R,x,A,N,E,b,w,U,C,_,D,O,B,I,S,M,W,F,P,V,q,H,j,X,G,Q,Y,z,J,K,Z,$,ee,te;if(r=new o,r.duration=this.parseDuration(this.parseNodeText(this.childByName(e,"Duration"))),-1===r.duration&&"Wrapper"!==e.parentNode.parentNode.parentNode.nodeName)return null;for(L=e.getAttribute("skipoffset"),null==L?r.skipDelay=null:"%"===L.charAt(L.length-1)?(T=parseInt(L,10),r.skipDelay=r.duration*(T/100)):r.skipDelay=this.parseDuration(L),E=this.childByName(e,"VideoClicks"),null!=E&&(r.videoClickThroughURLTemplate=this.parseNodeText(this.childByName(E,"ClickThrough")),r.videoClickTrackingURLTemplate=this.parseNodeText(this.childByName(E,"ClickTracking")),r.videoCustomClick=this.parseNodeText(this.childByName(E,"CustomClick"))),Q=this.childsByName(e,"TrackingEvents"),U=0,O=Q.length;O>U;U++)for(A=Q[U],Y=this.childsByName(A,"Tracking"),C=0,B=Y.length;B>C;C++)x=Y[C],i=x.getAttribute("event"),N=this.parseNodeText(x),null!=i&&null!=N&&"progress"===i?(y=x.getAttribute("offset"),null!=y&&"%"===y.charAt(y.length-1)?(T=parseInt(y,10),k=r.duration*(T/100)):k=this.parseDuration(y),null==(_base1=r.progressTracking)[k]&&(_base1[k]=[]),r.progressTracking[k].push(N)):null!=i&&null!=N&&(null==(w=r.trackingEvents)[i]&&(w[i]=[]),r.trackingEvents[i].push(N));for(z=this.childsByName(e,"MediaFiles"),_=0,I=z.length;I>_;_++)for(v=z[_],J=this.childsByName(v,"MediaFile"),D=0,S=J.length;S>D;D++)m=J[D],g=new l,g.fileURL=this.parseNodeText(m),g.deliveryType=m.getAttribute("delivery"),g.codec=m.getAttribute("codec"),g.mimeType=m.getAttribute("type"),g.bitrate=parseInt(m.getAttribute("bitrate")||0),g.minBitrate=parseInt(m.getAttribute("minBitrate")||0),g.maxBitrate=parseInt(m.getAttribute("maxBitrate")||0),g.width=parseInt(m.getAttribute("width")||0),g.height=parseInt(m.getAttribute("height")||0),g.maintainAspectRatio=m.getAttribute("maintainAspectRatio")||!1,g.apiFramework=m.getAttribute("apiFramework")||"vast",r.mediaFiles.push(g);for(K=this.childsByName(e,"Icons"),q=0,M=K.length;M>q;q++)for(d=K[q],Z=this.childsByName(d,"Icon"),H=0,W=Z.length;W>H;H++){for(a=Z[H],s=new u,s.program=a.getAttribute("program")||"",s.height=a.getAttribute("height")||0,s.width=a.getAttribute("width")||0,s.xPosition=a.getAttribute("xPosition")||0,s.yPosition=a.getAttribute("yPosition")||0,s.apiFramework=a.getAttribute("apiFramework")||"vast",s.offset=a.getAttribute("offset")||0,s.duration=a.getAttribute("duration")||0,t=this.childByName(a,"IconClicks"),null!=t&&(s.clickThroughTemplate=this.parseNodeText(this.childByName(t,"IconClickThrough"))||"",s.clickTrackingTemplate=this.parseNodeText(this.childByName(t,"IconClickTracking"))||""),b=this.childByName(a,"IconViewTracking")||"",null!=b&&(s.iconViewTracking=this.parseNodeText()||""),$=this.childsByName(a,"StaticResource"),j=0,F=$.length;F>j;j++)R=$[j],s.resourceType="static",s.creativeType=R.getAttribute("CreativeType")||0,s.resource=this.parseNodeText(R);for(ee=this.childsByName(a,"IFrameResource"),X=0,P=ee.length;P>X;X++)f=ee[X],s.resourceType="iframe",s.resource=this.parseNodeText(f);for(te=this.childsByName(a,"HTMLResource"),G=0,V=te.length;V>G;G++)n=te[G],s.resourceType="html",s.resource=this.parseNodeText(n);r.icons.push(s)}return h=this.childByName(e,"AdParameters"),null!=h&&(p=new c,p.parameters=this.parseNodeText(h),p.xmlEncoded=h.getAttribute("xmlEncoded")||!1,r.adParameters=p),r},e.parseCompanionAd=function(e){var t,r,i,s,o,l,u,h,p,d,f,g,m,v,T,k,y,L,R,x,A,N,E,b,w,U,C,_,D,O,B;for(i=new a,i.altText=e.getAttribute("AltText")||"",U=this.childsByName(e,"Companion"),v=0,L=U.length;L>v;v++){for(r=U[v],t=new n,t.id=r.getAttribute("id")||0,t.width=r.getAttribute("width"),t.height=r.getAttribute("height"),t.expandedHeight=r.getAttribute("expandedHeight")||0,t.expandedWidth=r.getAttribute("expandedWidth")||0,t.assetWidth=r.getAttribute("assetWidth")||0,t.assetHeight=r.getAttribute("assetHeight")||0,t.adSlotID=r.getAttribute("adSlotID")||0,t.required=r.getAttribute("required")||"",t.scalable=r.getAttribute("scalable")||!1,t.maintainAspectRatio=r.getAttribute("maintainAspectRatio")||!1,t.minSuggestedDuration=r.getAttribute("minSuggestedDuration")||1e3,t.apiFramework=r.getAttribute("apiFramework")||"vast",C=this.childsByName(r,"StaticResource"),T=0,R=C.length;R>T;T++)p=C[T],t.creativeType=p.getAttribute("creativeType")||0,t.resourceType="static",t.resource=this.parseNodeText(p);for(_=this.childsByName(r,"IFrameResource"),k=0,x=_.length;x>k;k++)h=_[k],t.creativeType=h.getAttribute("creativeType")||0,t.resourceType="iframe",t.resource=this.parseNodeText(h);for(D=this.childsByName(r,"HTMLResource"),y=0,A=D.length;A>y;y++)o=D[y],t.creativeType=o.getAttribute("creativeType")||0,t.resourceType="html",t.resource=this.parseNodeText(o);for(O=this.childsByName(r,"TrackingEvents"),b=0,N=O.length;N>b;b++)for(f=O[b],B=this.childsByName(f,"Tracking"),w=0,E=B.length;E>w;w++)d=B[w],s=d.getAttribute("event"),g=this.parseNodeText(d),null!=s&&null!=g&&(null==(m=t.trackingEvents)[s]&&(m[s]=[]),t.trackingEvents[s].push(g));for(_=this.childsByName(e,"TrackingEvents"),k=0,x=_.length;x>k;k++)for(f=_[k],D=this.childsByName(f,"Tracking"),y=0,A=D.length;A>y;y++)d=D[y],s=d.getAttribute("event"),g=this.parseNodeText(d),null!=s&&null!=g&&(null==(m=i.trackingEvents)[s]&&(m[s]=[]),i.trackingEvents[s].push(g));t.companionClickThroughURLTemplate=this.parseNodeText(this.childByName(r,"CompanionClickThrough")),i.variations.push(t),l=this.childByName(r,"AdParameters"),null!=l&&(u=new c,u.parameters=this.parseNodeText(l),u.xmlEncoded=l.getAttribute("xmlEncoded")||!1,t.adParameters=u)}return 0==i.variations.length&&(i=null),i},e.parseDuration=function(e){var t,r,i,n,s;return null==e?-1:(t=e.split(":"),3!==t.length?-1:(s=t[2].split("."),n=parseInt(s[0]),2===s.length&&(n+=parseFloat("0."+s[1])),i=parseInt(60*t[1]),r=parseInt(60*t[0]*60),isNaN(r||isNaN(i||isNaN(n||i>3600||n>60)))?-1:r+i+n))},e.parseNodeText=function(e){return e&&(e.textContent||e.text)},e}(),t.exports=h},{"./ad.coffee":2,"./companionad.coffee":4,"./creative.coffee":5,"./mediafile.coffee":7,"./response.coffee":9,"./urlhandler.coffee":11,"./util.coffee":14,"./nonlinearad.coffee":15,"./icon.coffee":16,"./adparameters.coffee":17}],9:[function(e,t){var r;r=function(){function e(){this.ads=[],this.adId="",this.errorURLTemplates=[],this.errorCode=0,this.errorMessage="Error loading ad tag"}return e}(),t.exports=r},{}],10:[function(e,t){var r,i,n,s,a,o={}.hasOwnProperty,l=function(e,t){function r(){this.constructor=e}for(var i in t)o.call(t,i)&&(e[i]=t[i]);return r.prototype=t.prototype,e.prototype=new r,e.__super__=t.prototype,e};i=e("./client.coffee"),a=e("./util.coffee"),n=e("./creative.coffee").VASTCreativeLinear,r=e("events").EventEmitter,s=function(e){function t(e,t){var r,s,a,o,l;this.ad=e,this.creative=t,this.replay=!1,this.muted=!1,this.impressed=!1,this.skipable=!1,this.skipDelayDefault=-1,this.trackingEvents={},this.progressTracking={},this.companions=[],this.nonlinear=[],this.emitAlwaysEvents=["creativeView","start","firstQuartile","midpoint","thirdQuartile","complete","rewind","skip","closeLinear","close"],a=t.trackingEvents;for(r in a)s=a[r],this.trackingEvents[r]=s.slice(0);o=t.progressTracking;for(l in o)s=o[l],this.progressTracking[l]=s.slice(0);t instanceof n?(this.assetDuration=t.duration,this.quartiles={firstQuartile:Math.round(25*this.assetDuration)/100,midpoint:Math.round(50*this.assetDuration)/100,thirdQuartile:Math.round(75*this.assetDuration)/100},this.skipDelay=t.skipDelay,this.linear=!0,this.clickThroughURLTemplate=t.videoClickThroughURLTemplate,this.clickTrackingURLTemplate=t.videoClickTrackingURLTemplate,this.customClickURLTemplate=t.videoCustomClick):(this.skipDelay=-1,this.linear=!1),this.on("start",function(){i.lastSuccessfullAd=+new Date})}return l(t,e),t.prototype.setProgress=function(e){var t,r,i,n,s,a,o,l,u,c;if(s=null===this.skipDelay?this.skipDelayDefault:this.skipDelay,-1===s||this.skipable||(s>e?this.emit("skip-countdown",s-e):(this.skipable=!0,this.emit("skip-countdown",0))),this.linear&&this.assetDuration>0){if(r=[],e>0){r.push("start"),i=Math.round(e/this.assetDuration*100),r.push("progress-"+i+"%"),u=this.quartiles;for(n in u)a=u[n],e>=a&&a+1>=e&&r.push(n);c=this.progressTracking;for(progresstrack in c)a=progresstrack,e>=a&&(this.trackURLs(this.progressTracking[progresstrack]),delete this.progressTracking[progresstrack])}for(o=0,l=r.length;l>o;o++)t=r[o],this.track(t,!0)}return this.progress=e},t.prototype.setAssetDuration=function(e){this.creative instanceof n&&(this.assetDuration=e,this.quartiles={firstQuartile:Math.round(25*this.assetDuration)/100,midpoint:Math.round(50*this.assetDuration)/100,thirdQuartile:Math.round(75*this.assetDuration)/100})},t.prototype.setMuted=function(e){return this.muted!==e&&this.track(e?"mute":"unmute"),this.muted=e},t.prototype.setPaused=function(e){return this.paused!==e&&this.track(e?"pause":"resume"),this.paused=e},t.prototype.setFullscreen=function(e){return this.fullscreen!==e&&(this.track(e?"fullscreen":"exitFullscreen"),this.track(e?"expand":"collapse")),this.fullscreen=e},t.prototype.setSkipDelay=function(e){return"number"==typeof e?this.skipDelay=e:void 0},t.prototype.load=function(){return this.impressed?void 0:(this.impressed=!0,this.trackURLs(this.ad.impressionURLTemplates),this.ad.surveyURL>0&&this.trackURLs(this.ad.surveyURL),this.track("creativeView"))},t.prototype.errorWithCode=function(e){return this.trackURLs(this.ad.errorURLTemplates,{ERRORCODE:e})},t.prototype.complete=function(){return this.track("complete")},t.prototype.stop=function(){return this.track(this.linear?"closeLinear":"close")},t.prototype.skip=function(){return this.track("skip"),this.trackingEvents=[]},t.prototype.click=function(){var e,t;return null!=this.clickTrackingURLTemplate&&this.trackURLs([this.clickTrackingURLTemplate]),null!=this.clickThroughURLTemplate?(this.linear&&(t={CONTENTPLAYHEAD:this.progressFormated()}),e=a.resolveURLTemplates([this.clickThroughURLTemplate],t)[0],this.emit("clickthrough",e)):void 0},t.prototype.track=function(e,t){var r,i;this.replay||(null==t&&(t=!1),"closeLinear"===e&&null==this.trackingEvents[e]&&null!=this.trackingEvents.close&&(e="close"),i=this.trackingEvents[e],r=this.emitAlwaysEvents.indexOf(e),null!=i?(this.emit(e,""),this.trackURLs(i)):-1!==r&&this.emit(e,""),t===!0&&(delete this.trackingEvents[e],r>-1&&this.emitAlwaysEvents.splice(r,1)))},t.prototype.trackURLs=function(e,t){return null==t&&(t={}),this.linear&&(t.CONTENTPLAYHEAD=this.progressFormated()),a.track(e,t)},t.prototype.progressFormated=function(){var e,t,r,i,n;return n=parseInt(this.progress),e=n/3600,e.length<2&&(e="0"+e),t=n/60%60,t.length<2&&(t="0"+t),i=n%60,i.length<2&&(i="0"+t),r=parseInt(100*(this.progress-n)),""+e+":"+t+":"+i+"."+r},t}(r),t.exports=s},{"./client.coffee":3,"./creative.coffee":5,"./util.coffee":14,events:1}],11:[function(e,t){var r,i,n;n=e("./urlhandlers/xmlhttprequest.coffee"),i=e("./urlhandlers/flash.coffee"),r=function(){function t(){}return t.get=function(t,r){return"undefined"==typeof window||null===window?e("./urlhandlers/node.coffee").get(t,r):n.supported()?n.get(t,r):i.supported()?i.get(t,r):r()},t}(),t.exports=r},{"./urlhandlers/flash.coffee":12,"./urlhandlers/xmlhttprequest.coffee":13}],12:[function(e,t){var r;r=function(){function e(){}return e.xdr=function(){var e;return window.XDomainRequest&&(e=new XDomainRequest),e},e.supported=function(){return!!this.xdr()},e.get=function(e,t){var r,i;return(i="function"==typeof window.ActiveXObject?new window.ActiveXObject("Microsoft.XMLDOM"):void 0)?(i.async=!1,r=this.xdr(),r.open("GET",e),r.send(),r.onload=function(){return i.loadXML(r.responseText),t(null,i)}):t()},e}(),t.exports=r},{}],13:[function(e,t){var r;r=function(){function e(){}return e.xhr=function(){var e;return e=new window.XMLHttpRequest,"withCredentials"in e?e:void 0},e.supported=function(){return!!this.xhr()},e.getWithoutCredentials=function(e,t){var r;return r=this.xhr(),r.open("GET",e,!0),r.send(),r.onreadystatechange=function(){return 4===r.readyState?t(null,r.responseXML):void 0}},e.onError=function(){},e.get=function(t,r){var i;i=this.xhr();try{return i.open("GET",t,!0),i.withCredentials=!0,i.send(),i.onError=function(){e.onError(t,r)},i.onreadystatechange=function(){return 4===i.readyState?i.responseXML?r(null,i.responseXML):e.getWithoutCredentials(t,r):void 0}}catch(n){return r("Error in getting url",null)}},e}(),t.exports=r},{}],15:[function(e,t){var r;r=function(){function e(){this.width=0,this.height=0,this.expandedHeight=0,this.expandedWidth=0,this.scalable=!1,this.maintainAspectRatio=!1,this.minSuggestedDuration=null,this.apiFramework=null,this.resourceType=null,this.creativeType=null,this.resource=null,this.clickThroughURLTemplate=null,this.clickTrackingURLTemplate=null,this.trackingEvents={},this.adParameters={}}return e}(),t.exports=r},{}],16:[function(e,t){var r;r=function(){function e(){this.program=null,this.height=0,this.width=null,this.xPosition=null,this.yPosition=0,this.apiFramework=0,this.offset=0,this.duration=0,this.clickThroughTemplate=null,this.clickTrackingTemplate=null,this.iconViewTracking=null,this.resource=null,this.resourceType=null,this.creativeType=0}return e}(),t.exports=r},{}],17:[function(e,t){var r;r=function(){function e(){this.parameters=null,this.xmlEncoded=!1}return e}(),t.exports=r},{}],14:[function(e,t){var r;r=function(){function e(){}return e.track=function(e,t){var r,i,n,s,a,o;for(i=this.resolveURLTemplates(e,t),o=[],s=0,a=i.length;a>s;s++)r=i[s],"undefined"!=typeof window&&null!==window&&(n=new Image,o.push(n.src=r));return o},e.resolveURLTemplates=function(e,t){var r,i,n,s,a,o,l,u,c,h;i=[],null==t&&(t={}),"CACHEBUSTING"in t||(t.CACHEBUSTING=Math.round(1e10*Math.random())),t.random=t.CACHEBUSTING;for(u=0,c=e.length;c>u;u++){r=e[u],o=r;for(n in t)l=t[n],s="["+n+"]",a="%%"+n+"%%",o=o.replace(s,l),o=o.replace(a,l);h=-1==o.indexOf("?")?"?":"&",o+=h+""+Math.round(1e10*Math.random()),i.push(o)}return i},e.storage=function(){var e,t,r,i;try{r="undefined"!=typeof window&&null!==window?window.localStorage||window.sessionStorage:null}catch(n){i=n,r=null}return t=function(e){var t,r;try{if(r="__VASTUtil__",e.setItem(r,r),e.getItem(r)!==r)return!0}catch(i){return t=i,!0}return!1},(null==r||t(r))&&(e={},r={length:0,getItem:function(t){return e[t]},setItem:function(t,r){e[t]=r,this.length=Object.keys(e).length},removeItem:function(t){delete e[t],this.length=Object.keys(e).length},clear:function(){e={},this.length=0}}),r}(),e}(),t.exports=r},{}]},{},[6])(6)});