/*! Raven.js 1.1.17 (759cfaf) | github.com/getsentry/raven-js */
;(function(Q,o){var f={remoteFetching:false,collectWindowErrors:true,linesOfContext:7};var u=[].slice;var b="?";f.wrap=function q(aa){function Z(){try{return aa.apply(this,arguments)}catch(ab){f.report(ab);throw ab}}return Z};f.report=(function s(){var Z=[],ae=null,ah=null,aj=null;function aa(ao){ac();Z.push(ao)}function ak(ap){for(var ao=Z.length-1;ao>=0;--ao){if(Z[ao]===ap){Z.splice(ao,1)}}}function af(){an();Z=[]}function ai(ao,at){var ar=null;if(at&&!f.collectWindowErrors){return}for(var aq in Z){if(y(Z,aq)){try{Z[aq].apply(null,[ao].concat(u.call(arguments,2)))}catch(ap){ar=ap}}}if(ar){throw ar}}var al,ad;function ag(au,aq,av,at,ar){var ao=null;if(aj){f.computeStackTrace.augmentStackTraceWithInitialElement(aj,aq,av,au);am()}else{if(ar){ao=f.computeStackTrace(ar);ai(ao,true)}else{var ap={url:aq,line:av,column:at};ap.func=f.computeStackTrace.guessFunctionName(ap.url,ap.line);ap.context=f.computeStackTrace.gatherContext(ap.url,ap.line);ao={message:au,url:document.location.href,stack:[ap]};ai(ao,true)}}if(al){return al.apply(this,arguments)}return false}function ac(){if(ad){return}al=Q.onerror;Q.onerror=ag;ad=true}function an(){if(!ad){return}Q.onerror=al;ad=false;al=o}function am(){var ap=aj,ao=ae;ae=null;aj=null;ah=null;ai.apply(null,[ap,false].concat(ao))}function ab(ar,ap){var aq=u.call(arguments,1);if(aj){if(ah===ar){return}else{am()}}var ao=f.computeStackTrace(ar);aj=ao;ah=ar;ae=aq;Q.setTimeout(function(){if(ah===ar){am()}},(ao.incomplete?2000:0));if(ap!==false){throw ar}}ab.subscribe=aa;ab.unsubscribe=ak;ab.uninstall=af;return ab}());f.computeStackTrace=(function J(){var ab=false,aa={};function ag(aq){if(!f.remoteFetching){return""}try{var au=function(){try{return new Q.XMLHttpRequest()}catch(av){return new Q.ActiveXObject("Microsoft.XMLHTTP")}};var ar=au();ar.open("GET",aq,false);ar.send("");return ar.responseText}catch(at){return""}}function ak(aq){if(!m(aq)){return[]}if(!y(aa,aq)){var ar="";if(aq.indexOf(document.domain)!==-1){ar=ag(aq)}aa[aq]=ar?ar.split("\n"):[]}return aa[aq]}function an(ar,au){var ay=/function ([^(]*)\(([^)]*)\)/,av=/['"]?([0-9A-Za-z$_]+)['"]?\s*[:=]\s*(function|eval|new Function)/,az="",ax=10,aq=ak(ar),at;if(!aq.length){return b}for(var aw=0;aw<ax;++aw){az=aq[au-aw]+az;if(!w(az)){if((at=av.exec(az))){return at[1]}else{if((at=ay.exec(az))){return at[1]}}}}return b}function al(at,az){var ar=ak(at);if(!ar.length){return null}var av=[],ay=Math.floor(f.linesOfContext/2),aq=ay+(f.linesOfContext%2),au=Math.max(0,az-ay-1),aw=Math.min(ar.length,az+aq-1);az-=1;for(var ax=au;ax<aw;++ax){if(!w(ar[ax])){av.push(ar[ax])}}return av.length>0?av:null}function ah(aq){return aq.replace(/[\-\[\]{}()*+?.,\\\^$|#]/g,"\\$&")}function ap(aq){return ah(aq).replace("<","(?:<|&lt;)").replace(">","(?:>|&gt;)").replace("&","(?:&|&amp;)").replace('"','(?:"|&quot;)').replace(/\s+/g,"\\s+")}function am(au,aw){var av,aq;for(var at=0,ar=aw.length;at<ar;++at){if((av=ak(aw[at])).length){av=av.join("\n");if((aq=au.exec(av))){return{url:aw[at],line:av.substring(0,aq.index).split("\n").length,column:aq.index-av.lastIndexOf("\n",aq.index)-1}}}}return null}function Z(au,at,ar){var aw=ak(at),av=new RegExp("\\b"+ah(au)+"\\b"),aq;ar-=1;if(aw&&aw.length>ar&&(aq=av.exec(aw[ar]))){return aq.index}return null}function ad(aw){var aC=[Q.location.href],ax=document.getElementsByTagName("script"),aA,au=""+aw,at=/^function(?:\s+([\w$]+))?\s*\(([\w\s,]*)\)\s*\{\s*(\S[\s\S]*\S)\s*\}\s*$/,av=/^function on([\w$]+)\s*\(event\)\s*\{\s*(\S[\s\S]*\S)\s*\}\s*$/,aE,ay,aF;for(var az=0;az<ax.length;++az){var aD=ax[az];if(aD.src){aC.push(aD.src)}}if(!(ay=at.exec(au))){aE=new RegExp(ah(au).replace(/\s+/g,"\\s+"))}else{var ar=ay[1]?"\\s+"+ay[1]:"",aB=ay[2].split(",").join("\\s*,\\s*");aA=ah(ay[3]).replace(/;$/,";?");aE=new RegExp("function"+ar+"\\s*\\(\\s*"+aB+"\\s*\\)\\s*{\\s*"+aA+"\\s*}")}if((aF=am(aE,aC))){return aF}if((ay=av.exec(au))){var aq=ay[1];aA=ap(ay[2]);aE=new RegExp("on"+aq+"=[\\'\"]\\s*"+aA+"\\s*[\\'\"]","i");if((aF=am(aE,aC[0]))){return aF}aE=new RegExp(aA);if((aF=am(aE,aC))){return aF}}return null}function ac(ay){if(!ay.stack){return null}var ax=/^\s*at (.*?) ?\(?((?:file|https?|chrome-extension):.*?):(\d+)(?::(\d+))?\)?\s*$/i,aq=/^\s*(.*?)(?:\((.*?)\))?@((?:file|https?|chrome).*?):(\d+)(?::(\d+))?\s*$/i,aA=ay.stack.split("\n"),az=[],au,aw,ar=/^(.*) is undefined$/.exec(ay.message);for(var av=0,at=aA.length;av<at;++av){if((au=aq.exec(aA[av]))){aw={url:au[3],func:au[1]||b,args:au[2]?au[2].split(","):"",line:+au[4],column:au[5]?+au[5]:null}}else{if((au=ax.exec(aA[av]))){aw={url:au[2],func:au[1]||b,line:+au[3],column:au[4]?+au[4]:null}}else{continue}}if(!aw.func&&aw.line){aw.func=an(aw.url,aw.line)}if(aw.line){aw.context=al(aw.url,aw.line)}az.push(aw)}if(!az.length){return null}if(az[0].line&&!az[0].column&&ar){az[0].column=Z(ar[1],az[0].url,az[0].line)}else{if(!az[0].column&&!w(ay.columnNumber)){az[0].column=ay.columnNumber+1}}return{name:ay.name,message:ay.message,url:document.location.href,stack:az}}function aj(aw){var ay=aw.stacktrace;var av=/ line (\d+), column (\d+) in (?:<anonymous function: ([^>]+)>|([^\)]+))\((.*)\) in (.*):\s*$/i,aA=ay.split("\n"),ax=[],aq;for(var au=0,ar=aA.length;au<ar;au+=2){if((aq=av.exec(aA[au]))){var at={line:+aq[1],column:+aq[2],func:aq[3]||aq[4],args:aq[5]?aq[5].split(","):[],url:aq[6]};if(!at.func&&at.line){at.func=an(at.url,at.line)}if(at.line){try{at.context=al(at.url,at.line)}catch(az){}}if(!at.context){at.context=[aA[au+1]]}ax.push(at)}}if(!ax.length){return null}return{name:aw.name,message:aw.message,url:document.location.href,stack:ax}}function af(aJ){var at=aJ.message.split("\n");if(at.length<4){return null}var av=/^\s*Line (\d+) of linked script ((?:file|https?)\S+)(?:: in function (\S+))?\s*$/i,au=/^\s*Line (\d+) of inline#(\d+) script in ((?:file|https?)\S+)(?:: in function (\S+))?\s*$/i,aq=/^\s*Line (\d+) of function script\s*$/i,aA=[],ax=document.getElementsByTagName("script"),aI=[],aE,aG,aH,aF;for(aG in ax){if(y(ax,aG)&&!ax[aG].src){aI.push(ax[aG])}}for(aG=2,aH=at.length;aG<aH;aG+=2){var aK=null;if((aE=av.exec(at[aG]))){aK={url:aE[2],func:aE[3],line:+aE[1]}}else{if((aE=au.exec(at[aG]))){aK={url:aE[3],func:aE[4]};var ar=(+aE[1]);var aL=aI[aE[2]-1];if(aL){aF=ak(aK.url);if(aF){aF=aF.join("\n");var az=aF.indexOf(aL.innerText);if(az>=0){aK.line=ar+aF.substring(0,az).split("\n").length}}}}else{if((aE=aq.exec(at[aG]))){var ay=Q.location.href.replace(/#.*$/,""),aB=aE[1];var aD=new RegExp(ap(at[aG+1]));aF=am(aD,[ay]);aK={url:ay,line:aF?aF.line:aB,func:""}}}}if(aK){if(!aK.func){aK.func=an(aK.url,aK.line)}var aw=al(aK.url,aK.line);var aC=(aw?aw[Math.floor(aw.length/2)]:null);if(aw&&aC.replace(/^\s*/,"")===at[aG+1].replace(/^\s*/,"")){aK.context=aw}else{aK.context=[at[aG+1]]}aA.push(aK)}}if(!aA.length){return null}return{name:aJ.name,message:at[0],url:document.location.href,stack:aA}}function ai(av,at,aw,au){var ar={url:at,line:aw};if(ar.url&&ar.line){av.incomplete=false;if(!ar.func){ar.func=an(ar.url,ar.line)}if(!ar.context){ar.context=al(ar.url,ar.line)}var aq=/ '([^']+)' /.exec(au);if(aq){ar.column=Z(aq[1],ar.url,ar.line)}if(av.stack.length>0){if(av.stack[0].url===ar.url){if(av.stack[0].line===ar.line){return false}else{if(!av.stack[0].line&&av.stack[0].func===ar.func){av.stack[0].line=ar.line;av.stack[0].context=ar.context;return false}}}}av.stack.unshift(ar);av.partial=true;return true}else{av.incomplete=true}return false}function ae(ay,aw){var ax=/function\s+([_$a-zA-Z\xA0-\uFFFF][_$a-zA-Z0-9\xA0-\uFFFF]*)?\s*\(/i,az=[],ar={},au=false,av,aA,aq;for(var aC=ae.caller;aC&&!au;aC=aC.caller){if(aC===ao||aC===f.report){continue}aA={url:null,func:b,line:null,column:null};if(aC.name){aA.func=aC.name}else{if((av=ax.exec(aC.toString()))){aA.func=av[1]}}if((aq=ad(aC))){aA.url=aq.url;aA.line=aq.line;if(aA.func===b){aA.func=an(aA.url,aA.line)}var at=/ '([^']+)' /.exec(ay.message||ay.description);if(at){aA.column=Z(at[1],aq.url,aq.line)}}if(ar[""+aC]){au=true}else{ar[""+aC]=true}az.push(aA)}if(aw){az.splice(0,aw)}var aB={name:ay.name,message:ay.message,url:document.location.href,stack:az};ai(aB,ay.sourceURL||ay.fileName,ay.line||ay.lineNumber,ay.message||ay.description);return aB}function ao(ar,au){var aq=null;au=(au==null?0:+au);try{aq=aj(ar);if(aq){return aq}}catch(at){if(ab){throw at}}try{aq=ac(ar);if(aq){return aq}}catch(at){if(ab){throw at}}try{aq=af(ar);if(aq){return aq}}catch(at){if(ab){throw at}}try{aq=ae(ar,au+1);if(aq){return aq}}catch(at){if(ab){throw at}}return{}}ao.augmentStackTraceWithInitialElement=ai;ao.computeStackTraceFromStackProp=ac;ao.guessFunctionName=an;ao.gatherContext=al;return ao}());"use strict";var H=Q.Raven,a=!!(typeof JSON==="object"&&JSON.stringify),U,L,A,n,d,Y,v={logger:"javascript",ignoreErrors:[],ignoreUrls:[],whitelistUrls:[],includePaths:[],collectWindowErrors:true,tags:{},maxMessageLength:100,extra:{}},N,M=false,k=Object.prototype,g=R();var F={VERSION:"1.1.17",debug:true,noConflict:function(){Q.Raven=H;return F},config:function(ab,aa){if(A){e("error","Error: Raven has already been configured");return F}if(!ab){return F}var ac=c(ab),Z=ac.path.lastIndexOf("/"),ad=ac.path.substr(1,Z);if(aa){T(aa,function(ae,af){v[ae]=af})}v.ignoreErrors.push(/^Script error\.?$/);v.ignoreErrors.push(/^Javascript error: Script error\.? on line 0$/);v.ignoreErrors=x(v.ignoreErrors);v.ignoreUrls=v.ignoreUrls.length?x(v.ignoreUrls):false;v.whitelistUrls=v.whitelistUrls.length?x(v.whitelistUrls):false;v.includePaths=x(v.includePaths);d=ac.user;Y=ac.path.substr(Z+1);A="//"+ac.host+(ac.port?":"+ac.port:"")+"/"+ad+"api/"+Y+"/store/";if(ac.protocol){A=ac.protocol+":"+A}if(v.fetchContext){f.remoteFetching=true}if(v.linesOfContext){f.linesOfContext=v.linesOfContext}f.collectWindowErrors=!!v.collectWindowErrors;E();return F},install:function(){if(C()&&!M){f.report.subscribe(P);M=true}return F},context:function(aa,ab,Z){if(t(aa)){Z=ab||[];ab=aa;aa=o}return F.wrap(aa,ab).apply(this,Z)},wrap:function(aa,ab){if(w(ab)&&!t(aa)){return aa}if(t(aa)){ab=aa;aa=o}if(!t(ab)){return ab}if(ab.__raven__){return ab}function Z(){var ae=[],af=arguments.length,ad=!aa||aa&&aa.deep!==false;while(af--){ae[af]=ad?F.wrap(aa,arguments[af]):arguments[af]}try{return ab.apply(this,ae)}catch(ag){F.captureException(ag,aa);throw ag}}for(var ac in ab){if(y(ab,ac)){Z[ac]=ab[ac]}}Z.__raven__=true;Z.__inner__=ab;return Z},uninstall:function(){f.report.uninstall();M=false;return F},captureException:function(aa,Z){if(!X(aa)){return F.captureMessage(aa,Z)}U=aa;try{f.report(aa,Z)}catch(ab){if(aa!==ab){throw ab}}return F},captureMessage:function(aa,Z){if(!!v.ignoreErrors.test&&v.ignoreErrors.test(aa)){return}D(B({message:aa+""},Z));return F},setUserContext:function(Z){n=Z;return F},setExtraContext:function(Z){v.extra=Z||{};return F},setTagsContext:function(Z){v.tags=Z||{};return F},setReleaseContext:function(Z){v.release=Z;return F},lastException:function(){return U},lastEventId:function(){return L},isSetup:function(){return C()}};F.setUser=F.setUserContext;function V(ab,Z){var ac,aa;Z=Z||{};ab="raven"+ab.substr(0,1).toUpperCase()+ab.substr(1);if(document.createEvent){ac=document.createEvent("HTMLEvents");ac.initEvent(ab,true,true)}else{ac=document.createEventObject();ac.eventType=ab}for(aa in Z){if(y(Z,aa)){ac[aa]=Z[aa]}}if(document.createEvent){document.dispatchEvent(ac)}else{try{document.fireEvent("on"+ac.eventType.toLowerCase(),ac)}catch(ad){}}}var W="source protocol user pass host port path".split(" "),z=/^(?:(\w+):)?\/\/(\w+)(:\w+)?@([\w\.-]+)(?::(\d+))?(\/.*)/;function i(Z){this.name="RavenConfigError";this.message=Z}i.prototype=new Error();i.prototype.constructor=i;function c(ad){var Z=z.exec(ad),ab={},aa=7;try{while(aa--){ab[W[aa]]=Z[aa]||""}}catch(ac){throw new i("Invalid DSN: "+ad)}if(ab.pass){throw new i("Do not specify your private key in the DSN!")}return ab}function w(Z){return typeof Z==="undefined"}function t(Z){return typeof Z==="function"}function m(Z){return typeof Z==="string"}function O(Z){return typeof Z==="object"&&Z!==null}function I(aa){for(var Z in aa){return false}return true}function X(Z){return O(Z)&&k.toString.call(Z)==="[object Error]"||Z instanceof Error}function y(Z,aa){return k.hasOwnProperty.call(Z,aa)}function T(ab,ac){var aa,Z;if(w(ab.length)){for(aa in ab){if(y(ab,aa)){ac.call(null,aa,ab[aa])}}}else{Z=ab.length;if(Z){for(aa=0;aa<Z;aa++){ac.call(null,aa,ab[aa])}}}}function E(){N="?sentry_version=4&sentry_client=raven-js/"+F.VERSION+"&sentry_key="+d}function P(aa,Z){var ab=[];if(aa.stack&&aa.stack.length){T(aa.stack,function(ad,ac){var ae=G(ac);if(ae){ab.push(ae)}})}V("handle",{stackInfo:aa,options:Z});S(aa.name,aa.message,aa.url,aa.lineno,ab,Z)}function G(ad){if(!ad.url){return}var ac={filename:ad.url,lineno:ad.line,colno:ad.column,"function":ad.func||"?"},aa=p(ad),Z;if(aa){var ab=["pre_context","context_line","post_context"];Z=3;while(Z--){ac[ab[Z]]=aa[Z]}}ac.in_app=!(!v.includePaths.test(ac.filename)||/(Raven|TraceKit)\./.test(ac["function"])||/raven\.(min\.)?js$/.test(ac.filename));return ac}function p(ad){if(!ad.context||!v.fetchContext){return}var ab=ad.context,Z=~~(ab.length/2),aa=ab.length,ac=false;while(aa--){if(ab[aa].length>300){ac=true;break}}if(ac){if(w(ad.column)){return}return[[],ab[Z].substr(ad.column,50),[]]}return[ab.slice(0,Z),ab[Z],ab.slice(Z+1)]}function S(ac,ag,ae,Z,ab,ah){var af,ad,aa;ag+="";if(ac==="Error"&&!ag){return}if(v.ignoreErrors.test(ag)){return}if(ab&&ab.length){ae=ab[0].filename||ae;ab.reverse();af={frames:ab}}else{if(ae){af={frames:[{filename:ae,lineno:Z,in_app:true}]}}}ag=h(ag,v.maxMessageLength);if(v.ignoreUrls&&v.ignoreUrls.test(ae)){return}if(v.whitelistUrls&&!v.whitelistUrls.test(ae)){return}ad=Z?ag+" at "+Z:ag;D(B({exception:{type:ac,value:ag},stacktrace:af,culprit:ae,message:ad},ah))}function B(aa,Z){if(!Z){return aa}T(Z,function(ab,ac){aa[ab]=ac});return aa}function h(aa,Z){return aa.length<=Z?aa:aa.substr(0,Z)+"\u2026"}function R(){return +new Date()}function r(){var Z={url:document.location.href,headers:{"User-Agent":navigator.userAgent}};if(document.referrer){Z.headers.Referer=document.referrer}return Z}function D(Z){if(!C()){return}Z=B({project:Y,logger:v.logger,platform:"javascript",request:r()},Z);Z.tags=B(B({},v.tags),Z.tags);Z.extra=B(B({},v.extra),Z.extra);Z.extra=B({"session:duration":R()-g},Z.extra);if(I(Z.tags)){delete Z.tags}if(n){Z.user=n}if(v.release){Z.release=v.release}if(t(v.dataCallback)){Z=v.dataCallback(Z)}if(t(v.shouldSendCallback)&&!v.shouldSendCallback(Z)){return}L=Z.event_id||(Z.event_id=K());l(Z)}function l(ab){var Z=new Image(),ad=A+N+"&sentry_data="+encodeURIComponent(JSON.stringify(ab));Z.crossOrigin="anonymous";Z.onload=function ac(){V("success",{data:ab,src:ad})};Z.onerror=Z.onabort=function aa(){V("failure",{data:ab,src:ad})};Z.src=ad}function C(){if(!a){return false}if(!A){e("error","Error: Raven has not been configured.");return false}return true}function x(ac){var aa=[],ab=0,Z=ac.length,ad;for(;ab<Z;ab++){ad=ac[ab];if(m(ad)){aa.push(ad.replace(/([.*+?^=!:${}()|\[\]\/\\])/g,"\\$1"))}else{if(ad&&ad.source){aa.push(ad.source)}}}return new RegExp(aa.join("|"),"i")}function K(){return"xxxxxxxxxxxx4xxxyxxxxxxxxxxxxxxx".replace(/[xy]/g,function(ab){var aa=Math.random()*16|0,Z=ab=="x"?aa:(aa&3|8);return Z.toString(16)})}function e(aa,Z){if(Q.console&&console[aa]&&F.debug){console[aa](Z)}}function j(){var Z=Q.RavenConfig;if(Z){F.config(Z.dsn,Z.config).install()}}j();if(typeof define==="function"&&define.amd){Q.Raven=F;define("raven",[],function(){return F})}else{if(typeof module==="object"){module.exports=F}else{if(typeof exports==="object"){exports=F}else{Q.Raven=F}}}})(window);(function(g,c,f){if(!f){return}var d=f.event.add;f.event.add=function b(n,l,m,o,j){var k;if(m&&m.handler){k=m.handler;m.handler=c.wrap(m.handler)}else{k=m;m=c.wrap(m)}if(k.guid){m.guid=k.guid}else{m.guid=k.guid=f.guid++}return d.call(this,n,l,m,o,j)};var a=f.fn.ready;f.fn.ready=function i(j){return a.call(this,c.wrap(j))};var h=f.ajax;f.ajax=function e(k,j){var m=["complete","error","success"],l;if(typeof k==="object"){j=k;k=undefined}j=j||{};while(l=m.pop()){if(f.isFunction(j[l])){j[l]=c.wrap(j[l])}}try{return h.call(this,k,j)}catch(n){c.captureException(n);throw n}}}(window,window.Raven,window.jQuery));(function extendToAsynchronousCallbacks(a,b){var c=function c(f){var d=a[f];a[f]=function e(){var g=[].slice.call(arguments);var h=g[0];if(typeof(h)==="function"){g[0]=b.wrap(h)}if(d.apply){return d.apply(this,g)}else{return d(g[0],g[1])}}};c("setTimeout");c("setInterval")}(window,window.Raven));(function(a){var b=false;if(a._SENTRY_URL){Raven.config(_SENTRY_URL,{tags:{release:a._VERSION||"unknown"},ignoreErrors:["[object Event]"],shouldSendCallback:function(c){return(b)?false:(b=true)},dataCallback:function(e){var c,d;if(a._DEBUG){e.extra=e.extra||{};for(c in _DEBUG){d=_DEBUG[c];if(typeof(d)==="string"&&/^https?:\/\//.test(d)){e.extra[c]=d.split("?")[0].replace(/^.*\/\/[^\/]+/,"")}else{e.extra[c]=d}}}if(e.user){e.user.uuid=a._UUID||"";e.user.user_id=a._USER_ID||"";e.user.session_id=a._SESSION_ID||""}return e}});Raven.setUserContext({uuid:a._UUID||"",user_id:a._USER_ID||"",session_id:a._SESSION_ID||""});Raven.install()}})(self);"use strict";var $={};$.releaseVersion="20150603163024-cor23.9.5-13";$.cache={parseDate:{}};$.mimeTypes={script:"text/javascript, application/javascript",xml:"application/xml, text/xml",json:"application/json",text:"text/plain",html:"text/html"};$.ajax=function(b){var a=Object.prototype.hasOwnProperty,c,d;if(!b.url||!b.type||!b.store||$.cache.failLock){return}b.headers=b.headers||{};b.type=(b.type||"").toUpperCase();c=new XMLHttpRequest();c.open(b.type,$.addDebugParams(b.url,b.store),true);if($.supportsCORS()){c.withCredentials=true}if(b.type=="POST"){b.headers["Content-type"]="application/x-www-form-urlencoded"}if(b.dataType){b.headers.Accept=$.mimeTypes[b.dataType]}for(d in b.headers){if(a.call(b.headers,d)){c.setRequestHeader(d,b.headers[d])}}$.setCookielessSessionHeaders(c,b.store);c.onreadystatechange=function(){if(c.readyState==4){if(c.status>=200||c.status<=204){$.storeCookielessSession(c,b.store);if(b.success){b.success(JSON.parse(c.responseText||"{}"),b.type,c)}}else{if(c.status===500){$.shutdownWidget()}}}};c.send(b.data||"")};$.shutdownWidget=function(){$.cache.failLock=true;window.addEventListener("beforeunload",function(){sessionStorage.clear()})};$.toQuery=function(f,e){var a=Object.prototype.hasOwnProperty,c=encodeURIComponent,d=[],g,b;for(g in f){if(a.call(f,g)){b=(e)?e+"["+g+"]":g;if(typeof(f[g])==="object"){d.push($.toQuery(f[g],b))}else{d.push(c(b)+"="+c(f[g]))}}}return d.join("&")};$.addDebugParams=function(b,a){if(!$.supportsCORS()){b=$.addParamToUrl(b,"supports_cors","false")}if($.getCookielessSession(a)){b=$.addParamToUrl(b,"cookieless_session","true")}return b};$.addParamToUrl=function(d,c,f){var b=$.cache.anchor||($.cache.anchor=document.createElement("a")),a=new RegExp("([&?])"+c+"=.*?(&|$)"),e,g;b.href=d;if((e=b.search.match(a))){g=e[1]+c+"="+f+e[2];b.search=b.search.replace(e[0],g)}else{b.search+=((b.search)?"&":"?")+c+"="+encodeURIComponent(f)}return b.href};$.setCookielessSessionHeaders=function(c,a){var b=$.getCookielessSession(a);if(!$.cookiesEnabled()){c.setRequestHeader("X-Mpoints-Get-Headers","true");if(b){c.setRequestHeader("X-Mpoints-Session",b.session);c.setRequestHeader("X-Mpoints-Data",b.data)}}if($.isBrokenSession()){c.setRequestHeader("X-Mpoints-Clean-Session","true")}};$.setCookielessSessionParams=function(c,a){var b=$.getCookielessSession(a);if(b){c.x_mpoints_session=b.session;c.x_mpoints_data=b.data}if($.isBrokenSession()){c.x_mpoints_clean_session="true"}};$.storeCookielessSession=function(c,a){var d,b;if(!$.cookiesEnabled()){if((d=c.getResponseHeader("X-Mpoints-Session"))){a.set("session",encodeURIComponent(d))}if((b=c.getResponseHeader("X-Mpoints-Data"))){a.set("data",encodeURIComponent(b))}}else{if(a.get("session")){a.set("session","")}if(a.get("data")){a.set("data","")}}};$.getCookielessSession=function(a){var c,b;if(!$.cookiesEnabled()){if((c=a.get("session"))&&(b=a.get("data"))){return{session:c,data:b}}}};$.isBrokenSession=function(){return(($.readCookie("cluster")||"").length>0)&&(($.readCookie("enabled")||"").length===0)};$.readCookie=function(b){var a=new RegExp("(?:^|; )"+encodeURIComponent(b)+"=([^;]*)");return(a.exec(document.cookie)||[])[1]||null};$.cookiesEnabled=function(){return(($.readCookie("enabled")||"").length>0)};$.parseDate=function(e){var b=$.cache.parseDate,g,h,a,f,c;if(b[(g=e||"")]===undefined){if(/^[0-9]{8}$/.test(e||"")){h=parseInt(e.substr(0,4),10)||0;a=(parseInt(e.substr(4,2),10)||0)-1;f=parseInt(e.substr(6,2),10)||0;c=new Date(h,a,f);if(c.getFullYear()===h&&c.getMonth()===a&&c.getDate()===f){return(b[g]=c.getTime())}}return(b[g]=null)}return b[g]};$.bind=function(e,d){var c=Array.prototype.slice,b=c.call(arguments,2);return function(){return e.apply(d,b.concat(c.call(arguments)))}};$.getEl=function(a){return document.getElementById(a)};$.getIOSVersion=function(){var a;if(!$.iosVersion){if(/iP(ad|hone|od)/.test((a=navigator.userAgent))){$.iosVersion=parseFloat(a.replace(/.*OS\s(\d+)_(\d+).*/,"$1.$2"))||-1}else{$.iosVersion=-1}}return $.iosVersion};$.getIEVersion=function(){var a;if(!$.ieVersion){if((a=navigator).appName==="Microsoft Internet Explorer"){if(new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(a.userAgent)){$.ieVersion=parseFloat(RegExp.$1)}}$.ieVersion=($.ieVersion>5)?$.ieVersion:-1}return $.ieVersion};$.isDesktop=function(){return !$.isMobile()};$.isMobile=function(){return("ontouchstart" in window)};$.supportsCORS=function(){if($.cache.supportsCORS===undefined){$.cache.supportsCORS=!!("withCredentials" in new XMLHttpRequest());if($.getIEVersion()>0&&$.getIEVersion()<10){$.cache.supportsCORS=false}}return $.cache.supportsCORS};$.hasLocalStorageRoom=function(){try{localStorage.setItem("enabled","1");localStorage.removeItem("enabled");sessionStorage.setItem("enabled","1");sessionStorage.removeItem("enabled");return true}catch(a){return false}};$.hasClass=function(a,b){return(" "+(a||"")+" ").indexOf(" "+b+" ")>-1};(function(a){var b=a.onerror;a.onerror=function(g,d,c,f,e){var i=document.body.getAttribute("data-api-key")||"",h;a._DEBUG={javascript_release_version:$.releaseVersion,supports_cors:$.supportsCORS(),cookies_enabled:$.cookiesEnabled(),is_broken_session:$.isBrokenSession()};if(i&&a.XMLHttpRequest){h=new XMLHttpRequest();h.open("POST","/v6/apps/"+i+"/errors",true);h.setRequestHeader("Content-type","application/x-www-form-urlencoded");h.setRequestHeader("Connnection","close");h.setRequestHeader("Accept",$.mimeTypes.json);h.send($.toQuery({error:{message:"Web API Error: "+(g||""),filename:d,line:c,column:f,stack:(e||{}).stack,url:a.location.href,agent:navigator.userAgent,debug:_DEBUG}}))}if(b){return b.apply(this,arguments)}};if(a._PORTAL_DEEP_LINKS){_PORTAL_DEEP_LINKS=_PORTAL_DEEP_LINKS[$.isMobile()?"mobile":"desktop"]}})(self);"use strict";var SMApi=function(b,a){this.cache={};this.widget=b;this.apiKey=a.apiKey;this.style=a.style;this.stage=a.stage;this.apiVersion="v6";this.currentHost=window.location.protocol+"//"+window.location.host};SMApi.prototype.getVisitorId=function(b){var a=this.widget.storage.get("visitorId")||this.widget.sessionStorage.get("visitorId");if(b&&!a){throw new Error("Missing required visitor id")}return a};SMApi.prototype.setVisitorId=function(a){this.widget.storage.set("visitorId",a);this.widget.sessionStorage.set("visitorId",a)};SMApi.prototype.startSessionIfRequired=function(b){var a;if(this.startSessionRequired()){if(!this.widget.sessionStorage.get("sessionStartingState")){a=this.getVisitorId();this.widget.sessionStorage.set("sessionStartingState","requested");this.widget.sessionStorage.set("newVisitor",!a);this.startSession(a,b)}else{if(b){this.monitorSessionStartingState(b)}}}else{if(this.widget.isNewApiKey()){this.getUpdatedForecast(b)}else{if(b){b.call(this)}}}};SMApi.prototype.startSessionRequired=function(){var a=false;if(!this.getVisitorId()||!this.widget.sessionStorage.get("userId")){a=true}else{if(!$.cookiesEnabled()&&!$.getCookielessSession(this.widget.storage)){a=true}}if(a&&(this.widget.getIndex()+"")==="0"){if(this.widget.sessionStorage.get("sessionStartingState")==="completed"){this.widget.sessionStorage.removeItem("sessionStartingState")}}return a};SMApi.prototype.startSession=function(c,d){var a="/"+this.apiVersion+"/apps/"+this.apiKey+"/session.json",b={device:{platform:"browser"}};if(c){b.device.login=this.widget.storage.get("uuid")||c}$.ajax({url:this.getHost("sessions")+a,type:"POST",dataType:"json",data:$.toQuery(b),store:this.widget.storage,success:$.bind(function(f,e,g){this.handleSessionStart(f||{},d)},this)})};SMApi.prototype.handleSessionStart=function(b,d){var a,c;window._UUID=b.uuid;window._SESSION_ID=b.id;window._USER_ID=(b.ad_forecast_global||{}).user_id;if((a=(b.uuid||"").split(":")).length&&(c=a[0])){this.widget.storage.set("uuid",b.uuid);this.setVisitorId(c)}if($.supportsCORS()){this.storeHosts(b.hosts)}this.updateUserData(b,false);this.storeOffersData(b.offers||[]);this.cache.visitAchievement=b.earned_achievement;this.widget.sessionStorage.set("sessionTimeout",b.session_timeout);this.widget.sessionStorage.set("sessionStartingState","completed");if(d){d.call(this)}};SMApi.prototype.monitorSessionStartingState=function(b){var a;if(this.widget.sessionStorage.get("sessionStartingState")==="completed"){b.call(this)}else{a=$.bind(this.monitorSessionStartingState,this,b);window.setTimeout(a,50)}};SMApi.prototype.updateUserData=function(d,h){var a=JSON.parse(this.widget.sessionStorage.get("userData")||"null"),g=(d=d||{}).player,c=!a,b=false,f,i,e={};a=a||{};if(c||g){g=g||{};a.newUser=this.widget.sessionStorage.getBoolean("newVisitor");a.registered=(g.registered===true);a.loggedIn=(g.logged_in===true);a.optedOut=(g.opted_out===true);a.points=g.point_balance||0;a.unclaimedCount=g.unclaimed_achievement_count||0;a.unclaimedValue=g.unclaimed_achievement_value||0;a.achievementHistory=this.getUserAchievementHistoryData(g.achievements);b=true}if(c||d.ad_forecast){a.achievements=this.getUserAchievementData(d);b=true}if((f=(d.ad_forecast_global||{}).user_id)){e.userId=f}if(b){e.userData=a;e.optedOut=!!a.optedOut;e.unclaimed=a.unclaimedCount;e.points=a.points}e.lastUpdated=(new Date()).getTime();this.widget.sessionStorage.setMany(e);i=(b&&h)?"userUpdated":"dataUpdated";this.widget.network.sendMessage(i);return a};SMApi.prototype.getUserAchievementData=function(b){var d=this.getAchievementDataDefaults(),c=b.ad_forecast||[],a,e,g,f,h=[];for(f=0;e=c[f];f++){g=e.ad||{};a={};a.achievementIconUrl=g.achievement_icon_url||d.achievementIconUrl;a.action=e.event_name||d.action;a.distance=e.distance||d.distance;a.fullDistance=e.total_distance||d.fullDistance;a.instructions=g.instructions||d.instructions;a.lastEarnedDate=$.parseDate(e.last_event_time)||d.lastEarnedDate;a.message=g.unlocked_message||d.message;a.name=g.achievement_name||d.name;a.points=g.points||d.points;h[f]=a}return h};SMApi.prototype.getAchievementDataDefaults=function(){if(!this.cache.achievementDataDefaults){this.cache.achievementDataDefaults={achievementIconUrl:"",action:"",distance:-1,fullDistance:-1,instructions:"",lastEarnedDate:null,message:"Achievement Unlocked!",name:"",points:0}}return this.cache.achievementDataDefaults};SMApi.prototype.getUserAchievementHistoryData=function(e){var a,c,b,d=[];e=e||[];for(b=0;a=e[b];b++){c={};c.name=a.name||"";c.action=a.event_name||"";c.state=a.state||"unearned";c.points=a.points||0;c.timesEarned=a.times_earned||0;c.unclaimedCount=a.unclaimed_count||0;c.lastEarnedDate=$.parseDate(a.last_earned_at)||null;c.instructions=a.instructions||"";c.limitText=a.limit_text||"";d[b]=c}return d};SMApi.prototype.storeOffersData=function(b){var d,c,a,e=[];for(a=0;d=b[a];a++){c={};c.id=d.id||-1;c.name=d.name||"";c.points=d.points||0;c.imageSrc=d.image||"";c.type=d.type||"";c.expiresAt=$.parseDate(d.expires_at)||null;c.url=d.url||"";e[a]=c}this.widget.sessionStorage.set("offers",e)};SMApi.prototype.getLastUpdated=function(){return this.widget.storage.getNumber(this.apiKey+":lastUpdated")};SMApi.prototype.setLastUpdated=function(){var a=(new Date()).getTime();this.widget.storage.set(this.apiKey+":lastUpdated",a)};SMApi.prototype.submitEvent=function(d,a,c){var b="/"+this.apiVersion+"/apps/"+this.apiKey+"/widgets/"+this.style+"/events.json",f={},e;f.visitor_id=this.getVisitorId(true);f.event=d;f.index=this.widget.getIndex();if(c.initial){f.delivered=true;f.new_user=this.widget.sessionStorage.getBoolean("newVisitor");f.user_id=this.widget.sessionStorage.get("userId")||"";e=this.widget.sessionStorage.getNumber("unclaimed");f.unclaimed_achievement_count=(f.new_user)?"new":e;this.widget.addContextParams(f)}if(a){f.visited=a}$.ajax({url:this.getHost("events")+b+"?"+$.toQuery(f),type:"GET",dataType:"json",store:this.widget.storage,success:$.bind(function(h,g,i){h=h||{};if(d==="visit"&&this.cache.visitAchievement){h.earned_achievement=this.cache.visitAchievement;delete this.cache.visitAchievement}this.handleSubmitEvent(d,h,c)},this)})};SMApi.prototype.handleSubmitEvent=function(e,f,d){var a,b,c;this.updateUserData(f,true);a=!!f.earned_achievement;c={action:e,earned:a};if(a){this.widget.update(true);c.achievement=f.earned_achievement;c.achievement.action=e;c.achievement.distance=0;c.achievement.fullDistance=f.earned_achievement.total_distance;c.achievement.lastEarnedDate=(new Date()).getTime();delete c.achievement.total_distance;if(d.alertStyle!=="custom"){b=($.getEl(d.alertStyle+"Alert")||{}).innerHTML||"";b=this.fillInAchievementAlert(c.achievement,b);c.achievementAlertStyle=d.alertStyle;c.achievementAlertHtml=b}this.widget.network.sendMessage("earned",c)}if(d.callback){d.callback.call(this,c)}};SMApi.prototype.fillInAchievementAlert=function(a,c){var g=document.createElement("div"),f,d,e,b;g.innerHTML=c;if((d=a.achievement_icon_url)){if((f=g.querySelector("#smAA_Icon"))){f.src=d}}if((e=a.message)){if((f=g.querySelector("#smAA_Msg"))){f.innerHTML=e}}if((b=a.instructions)){if((f=g.querySelector("#smAA_Instr"))){f.innerHTML=b}}return g.innerHTML};SMApi.prototype.refreshWidgetIfRequired=function(c){var a=this.widget.sessionStorage.getNumber("sessionTimeout"),b=(new Date()).getTime()-this.getLastUpdated();if(b>=((a||600)*1000)){this.setLastUpdated();this.widget.sessionStorage.resetClient();this.widget.network.sendMessage("reload")}else{if(b>=10000&&$.cookiesEnabled()){this.setLastUpdated();this.getUpdatedForecast(c)}}};SMApi.prototype.getUpdatedForecast=function(b){var a="/"+this.apiVersion+"/apps/"+this.apiKey+"/session/forecast.json";$.ajax({url:this.getHost("sessions")+a,type:"GET",dataType:"json",store:this.widget.storage,success:$.bind(function(d,c,e){this.updateUserData(d,true);if(b){b.call(this)}},this)})};SMApi.prototype.getEngageUrl=function(d,c,f,a,e){var b="/"+this.apiVersion+"/apps/"+this.apiKey+"/widgets/engage",e=e||{};e.visitor_id=this.getVisitorId()||"";e.redir_path=c;e.return_url=f;e.widget=this.style;e.index=this.widget.getIndex();e.z=(new Date()).getTime();this.widget.addContextParams(e);$.setCookielessSessionParams(e,this.widget.storage);return this.getHost(d)+b+"?"+$.toQuery(e)+(a||"")};SMApi.prototype.getFeedUrl=function(c,a){var b=_PORTAL_DEEP_LINKS.home;return this.getEngageUrl("portal",b,c,a)};SMApi.prototype.getDeepLinkUrl=function(b,d,a){var c=_PORTAL_DEEP_LINKS[b]||_PORTAL_DEEP_LINKS.home;return this.getEngageUrl("portal",c,d,a)};SMApi.prototype.getAdUrl=function(c,a){var b="/"+this.apiVersion+"/apps/"+this.apiKey+"/widgets/"+this.style+"/ad";b+="?z="+(new Date()).getTime();return this.getEngageUrl("ads-web",b,c,a,{request_ad:true})};SMApi.prototype.getOptInUrl=function(b){var a="/apps/"+this.apiKey+"/optin?platform=mobile_web";return this.getEngageUrl("portal",a,b)};SMApi.prototype.setOptedOut=function(a,c){var b={_method:"put",member:{opted_out:a}};$.ajax({url:this.getHost("optout")+"/apps/"+this.apiKey+"/optout.json",type:"POST",dataType:"json",data:$.toQuery(b),store:this.widget.storage,success:$.bind(function(e,d,f){this.updateUserData(e,true);if(c){c.call(this)}},this)})};SMApi.prototype.resetClient=function(){$.ajax({url:this.getHost("sessions")+"/apps/"+this.apiKey+"/members/logout.json",type:"GET",dataType:"json",store:this.widget.storage,success:$.bind(function(b,a,c){this.widget.sessionStorage.resetClient();this.widget.storage.resetClient();this.widget.network.sendMessage("reload")},this)})};SMApi.prototype.storeHosts=function(b){var a=Object.prototype.hasOwnProperty,c={},d;b=b||{};for(d in b){if(a.call(b,d)){if((b[d]||"").indexOf("http")===0){c[d]=b[d]}}}this.widget.sessionStorage.set("hosts",c)};SMApi.prototype.getHost=function(b){var a;if($.supportsCORS()){a=JSON.parse(this.widget.sessionStorage.get("hosts")||"{}");if(a[b]){return a[b]}else{if(b==="sessions"&&this.stage==="production"){return"https://api.sessionm.com"}else{if(b==="ads-web"&&this.stage==="production"){return"https://m.sessionm.com"}}}}return this.currentHost};"use strict";var SMWidget=function(a){this.ready=false;this.returnUrl=null;this.api=new SMApi(this,a);this.network=new SMMessages(this);this.storage=new SMStorage(this,a);this.sessionStorage=new SMSessionStorage(this,a);this.params=new SMParams(this,window.location.hash.substring(1))};SMWidget.prototype.init=function(a){this.addClickListener();this.api.startSessionIfRequired($.bind(function(){var b=(!$.isBrokenSession()||$.getCookielessSession(this.storage));if(b&&this.api.getVisitorId()){this.api.setLastUpdated();this.sendEvent(this.getEvent(),{initial:true,callback:$.bind(function(c){a.call(this,$.bind(this.sendReadyMessage,this,c))},this)})}else{document.body.style.display="none"}},this))};SMWidget.prototype.sendReadyMessage=function(a){a.cssText=this.getFrameStyles();this.ready=true;this.network.sendMessage("ready",a)};SMWidget.prototype.addClickListener=function(){var a;if((a=$.getEl("widgetScreen"))){a.addEventListener("click",$.bind(this.openPortal,this))}};SMWidget.prototype.getEvent=function(){return this.params.get(SMParams.constants.ACTION)||""};SMWidget.prototype.getIndex=function(){return this.params.get(SMParams.constants.INDEX)||""};SMWidget.prototype.getOrigin=function(){return this.params.get(SMParams.constants.ORIGIN)||""};SMWidget.prototype.getTitle=function(){return this.params.get(SMParams.constants.TITLE)||""};SMWidget.prototype.getDescription=function(){return this.params.get(SMParams.constants.DESCRIPTION)||""};SMWidget.prototype.getTimestamp=function(){return this.params.get(SMParams.constants.Z)||""};SMWidget.prototype.getMode=function(){return this.params.get(SMParams.constants.MODE)||""};SMWidget.prototype.isNewApiKey=function(){return((this.params.get(SMParams.constants.ISNEWAPIKEY)||"")==="true")};SMWidget.prototype.opensToHome=function(a){if((a||{}).home===true){return true}return((this.params.get(SMParams.constants.OPENSTOHOME)||"")==="true")};SMWidget.prototype.getReturnUrl=function(){this.returnUrl=this.returnUrl||this.params.get(SMParams.constants.URL)||"";return this.returnUrl};SMWidget.prototype.getUserData=function(){return this.params.getUserData()};SMWidget.prototype.addContextParams=function(a){a.origin=this.getOrigin();a.title=this.getTitle();a.description=this.getDescription()};SMWidget.prototype.sendEvent=function(d,c){var b=this.sessionStorage.getBoolean("optedOut"),c=c||{},a;if(b||!this.shouldSubmitEvent(d,c)){if(c.callback){c.callback.call(this,{action:d,earned:false})}return}if((a=$.cookiesEnabled())){a="1"+this.getUserData()}this.api.submitEvent(d,a,c)};SMWidget.prototype.shouldSubmitEvent=function(b,a){if(!b||b==="undefined"){return false}else{if(a.throttleByUrlUniqueness){return this.storage.isFreshEventForUrl(b,a.url)}}return true};SMWidget.prototype.getPortalUrls=function(){var c=this.getReturnUrl(),b={},a;if(!this.sessionStorage.getBoolean("optedOut")){a=this.getUserData();b.feedUrl=this.api.getFeedUrl(c,a);b.rewardsUrl=this.api.getDeepLinkUrl("rewards",c,a);b.achievementsUrl=this.api.getDeepLinkUrl("achievements",c,a);if(this.sessionStorage.getNumber("unclaimed")){b.defaultUrl=this.api.getAdUrl(c,a)}else{b.defaultUrl=b.feedUrl}}else{b.defaultUrl=this.api.getOptInUrl(c)}return b};SMWidget.prototype.openPortal=function(f,e){var d=(this.opensToHome(e))?"feedUrl":"defaultUrl",g=this.getPortalUrls(),c,a,b;b=g[d]||g.defaultUrl;if($.getIOSVersion()>=8){window.top.location=b}else{if($.getIOSVersion()>=5){a=document.createEvent("HTMLEvents");a.initEvent("click",true,true);c=document.createElement("a");c.setAttribute("href",b);c.setAttribute("target","_blank");c.dispatchEvent(a)}else{window.open(b,"_blank")}}};SMWidget.prototype.openPortalHome=function(a){return this.openPortal(a,{home:true})};var SMWidgetCreator=function(){};SMWidgetCreator.prototype=SMWidget.prototype;(function(c,a,e){var b=a.readyState;var d=function(){var f,i,h,g={};c.removeEventListener("load",d);a.removeEventListener("DOMContentLoaded",d);g.apiKey=(f=a.body).getAttribute("data-api-key");g.style=f.getAttribute("data-widget-style");if(g.apiKey&&g.style&&$.hasLocalStorageRoom()){g.stage=f.getAttribute("data-stage")||"";i={bar:"BarWidget",box:"BoxWidget",button:"ButtonWidget",custom:"CustomWidget"}[g.style];h=new c[i](g);h.init()}else{f.style.display="none"}};if((b==="complete"||b==="interactive")&&(a.body||{}).getAttribute){d()}else{a.addEventListener("DOMContentLoaded",d);c.addEventListener("load",d)}})(self,self.document);"use strict";var SMStorage=function(c,b){var a=b.stage;this.prefix=(a&&a!=="production")?a+":":"";this.store=localStorage;this.widget=c;this.cache={}};SMStorage.prototype.set=function(a,b){if(b===null||b===undefined){return this.removeItem(a)}b=(typeof(b)!=="string")?JSON.stringify(b):b;this.store.setItem(this.getKey(a),b)};SMStorage.prototype.setMany=function(c){var a=Object.prototype.hasOwnProperty,b;for(b in c){if(a.call(c,b)){this.set(b,c[b])}}};SMStorage.prototype.get=function(a){return this.store.getItem(this.getKey(a))};SMStorage.prototype.getNumber=function(a){return parseInt(this.get(a)||0,10)||0};SMStorage.prototype.getBoolean=function(a){return(this.get(a)==="true")?true:false};SMStorage.prototype.removeItem=function(a){this.store.removeItem(this.getKey(a))};SMStorage.prototype.getKey=function(a){return this.prefix+a};SMStorage.prototype.isFreshEventForUrl=function(f,a){var e=JSON.parse(this.get("recentEvents")||"[]"),d,g,c,b=true;for(c=0;d=e[c];c++){if(d[0]===f&&d[1]===a){b=((new Date()).getTime()-d[2]>300000);break}}if(b){e.unshift([f,a,(new Date()).getTime()]);e.splice(100,e.length);this.set("recentEvents",e)}return !!b};SMStorage.prototype.resetClient=function(){var b=this.store.length,a;while((--b)>=0){if((a=this.store.key(b))){if(a.indexOf(this.prefix)===0){this.store.setItem(a,"")}}}};var SMSessionStorage=function(b,a){SMStorage.call(this,b,a);this.prefix="";this.store=sessionStorage};var SMStorageCreator=function(){};SMStorageCreator.prototype=SMStorage.prototype;SMSessionStorage.prototype=new SMStorageCreator();SMSessionStorage.prototype.constructor=SMSessionStorage;"use strict";var SMParams=function(a,b){this.widget=a;this.params={};if((this.queryString=b)){this.parse(this.queryString)}};SMParams.constants={URL:"url",ACTION:"action",ORIGIN:"origin",TITLE:"title",DESCRIPTION:"description",INDEX:"index",BGCOLOR:"bgColor",FGCOLOR:"fgColor",ISNEWAPIKEY:"isNewApiKey",OPENSTOHOME:"opensToHome",MODE:"mode",Z:"z"};SMParams.prototype.get=function(a){return this.params[a]};SMParams.prototype.parse=function(f){var h=decodeURIComponent,e=f.split("&"),g,a,d,c,b;for(d=0;g=e[d];d++){if((g=g.split("=")).length){this.params[h(g[0])]=h(g[1]||"")}}};SMParams.prototype.getUserData=function(){var a,b,c;if(this.userData===undefined){this.userData="";a=SMParams.constants;b=encodeURIComponent;for(c in this.params){if(!a[(c||"").toUpperCase()]){this.userData+="&user[data]["+b(c)+"]="+b(this.params[c])}}}return this.userData};"use strict";var SMMessages=function(a){this.widget=a;window.addEventListener("message",$.bind(this.receiveMessage,this))};SMMessages.prototype.sendMessage=function(a,c,b){if((this.targetOrigin=this.widget.params.get("origin")||document.referrer)){c=c||{};c.handler=a;c.index=this.widget.getIndex();c.mode=this.widget.getMode();c.urls=this.widget.getPortalUrls();c.newUser=this.widget.sessionStorage.getBoolean("newVisitor");c.unclaimed=this.widget.storage.getNumber("unclaimed");c.userData=this.widget.sessionStorage.get("userData")||"{}";c.offers=this.widget.sessionStorage.get("offers")||"[]";c.callbackId=(b)?b:undefined;parent.postMessage(JSON.stringify(c),this.targetOrigin)}};SMMessages.prototype.receiveMessage=function(a){var d=this.widget.ready,c,g,b;if(!d||(this.targetOrigin||"").search(a.origin)!==0){return}try{c=JSON.parse(a.data)}catch(f){return}b=(c.callback||{}).callbackId;switch(c.handler){case"action":g=$.bind(function(e){this.sendMessage("callback",e,b)},this);this.widget.sendEvent(c.action,{throttleByUrlUniqueness:c.throttleByUrlUniqueness,alertStyle:c.alertStyle,callback:g,url:c.url});break;case"toggleMode":if(this.widget.toggleModeSafe){this.widget.toggleModeSafe(c.mode)}break;case"updateUser":this.widget.api.setOptedOut(c.optedOut,$.bind(function(e){this.sendMessage("callback",e,b)},this));break;case"updateWidget":if(c.updateData){this.widget.api.refreshWidgetIfRequired($.bind(this.sendMessage,this,"updateWidget"))}else{if(c.resetClient){this.widget.api.resetClient()}else{if(c.reload){window.location.reload(true)}else{this.widget.update(true)}}}break}};"use strict";var BarWidget=function(a){SMWidget.call(this,a)};BarWidget.mode={MAXIMIZED:"maximized",MINIMIZED:"minimized"};BarWidget.prototype=new SMWidgetCreator();BarWidget.prototype.constructor=BarWidget;BarWidget.prototype.init=function(){SMWidget.prototype.init.call(this,function(b){var a=SMWidget.prototype.getMode.call(this);this.setColorTheme();this.update();this.addEvents();this.toggleMode(this.getModeSanitized(a,BarWidget.mode.MAXIMIZED));b.call(this)})};BarWidget.prototype.addEvents=function(){var b,a;$.getEl("bar-app-name-home").addEventListener("click",$.bind(this.openPortalHome,this));$.getEl("bar-achievements").addEventListener("click",$.bind(this.openPortal,this));if($.getIEVersion()<0||$.getIEVersion()>9){b=$.bind(this.toggleMode,this,BarWidget.mode.MINIMIZED);a=$.bind(this.toggleMode,this,BarWidget.mode.MAXIMIZED);$.getEl("bar-minimize-icon").addEventListener("click",b);$.getEl("bar-minimized-mode").addEventListener("click",a)}else{$.getEl("bar-minimize-icon").style.display="none"}};BarWidget.prototype.toggleModeSafe=function(a){a=this.getModeSanitized(a,this.mode);if(a!==this.mode){this.toggleMode(a)}};BarWidget.prototype.toggleMode=function(d){var b=$.getEl("bar-minimized-mode"),a=$.getEl("bar-maximized-mode"),c;if((this.mode=d)===BarWidget.mode.MINIMIZED){if($.hasClass(a.className,"bar-maximized-mode-show")){a.className="bar-maximized-mode-hide";c=true}b.className="bar-minimized-mode-show"}else{if($.hasClass(b.className,"bar-minimized-mode-show")){b.className="bar-minimized-mode-hide";c=true}a.className="bar-maximized-mode-show"}if(c){window.setTimeout($.bind(function(){this.network.sendMessage("toggleMode",{cssText:this.getFrameStyles()})},this),250)}};BarWidget.prototype.getMode=function(){return this.mode};BarWidget.prototype.getModeSanitized=function(b,a){if(b!==BarWidget.mode.MAXIMIZED&&b!==BarWidget.mode.MINIMIZED){b=a}return b};BarWidget.prototype.update=function(){var b=this.sessionStorage.getNumber("unclaimed"),e=$.getEl("bar-badge"),c=$.getEl("bar-achievements-badge"),d=$.getEl("bar-achievements"),a;if(b>0){e.innerHTML=b;c.innerHTML=b;e.className="";c.className=""}else{a=this.sessionStorage.getNumber("points");if(!a&&this.sessionStorage.getBoolean("newVisitor")){e.innerHTML="NEW";c.innerHTML="NEW";e.className="";c.className=""}else{e.className="hidden-badge";c.className="hidden-badge"}}d.style.display=(b>0)?"":"none";this.fixLegacyIEDisplayBug()};BarWidget.prototype.getFrameStyles=function(){var a="position:fixed;z-index:2147483647;bottom:0px;display:block;";if(this.mode===BarWidget.mode.MINIMIZED){a+="right:20px;width:160px;height:58px;"}else{a+="left:0px;right:0px;width:100%;height:40px;"}return a};BarWidget.prototype.setColorTheme=function(){var a=this.params.get(SMParams.constants.FGCOLOR)||"",b=$.getEl("bar-content");if((a=a||b.getAttribute("data-bg-color")||"")){$.getEl("bar-min-icon-container").style.backgroundColor=a;$.getEl("bar-maximized-mode").style.borderTopColor=a}};BarWidget.prototype.fixLegacyIEDisplayBug=function(){if(this.ready&&!this.ieBugFixed&&$.getIEVersion()<11){this.ieBugFixed=true;if(this.mode===BarWidget.mode.MINIMIZED){$.getEl("bar-minimized-mode").style.msTransform="translateY(0px)"}else{$.getEl("bar-maximized-mode").style.msTransform="translateY(0px)"}}};"use strict";var BoxWidget=function(a){SMWidget.call(this,a)};BoxWidget.prototype=new SMWidgetCreator();BoxWidget.prototype.constructor=BoxWidget;BoxWidget.prototype.init=function(){SMWidget.prototype.init.call(this,function(a){this.setColorTheme();this.update(false);a.call(this)})};BoxWidget.prototype.update=function(c){var d=this.sessionStorage.getNumber("unclaimed"),a=document.getElementById("box-badge"),b;if(d>0){a.innerHTML=d;a.className=""}else{b=this.sessionStorage.getNumber("points");if(!b&&this.sessionStorage.getBoolean("newVisitor")){a.innerHTML="NEW";a.className=""}else{a.className="hidden-badge"}}};BoxWidget.prototype.getFrameStyles=function(){return"width:55px;height:55px;display:block;"};BoxWidget.prototype.setColorTheme=function(){var c=this.params.get(SMParams.constants.BGCOLOR)||"",b=document.getElementById("box-content"),a=document.getElementById("box-icon-container");if((c=c||b.getAttribute("data-bg-color")||"")){a.style.backgroundColor=c}};"use strict";var ButtonWidget=function(a){SMWidget.call(this,a)};ButtonWidget.prototype=new SMWidgetCreator();ButtonWidget.prototype.constructor=ButtonWidget;ButtonWidget.prototype.init=function(){SMWidget.prototype.init.call(this,function(a){this.setColorTheme();this.update(false);a.call(this)})};ButtonWidget.prototype.update=function(c){var d=this.sessionStorage.getNumber("unclaimed"),a=document.getElementById("button-badge"),b;if(d>0){a.innerHTML=d;a.className=""}else{b=this.sessionStorage.getNumber("points");if(!b&&this.sessionStorage.getBoolean("newVisitor")){a.innerHTML="NEW";a.className=""}else{a.className="hidden-badge"}}};ButtonWidget.prototype.getFrameStyles=function(){return"width:100%;height:55px;display:block;"};ButtonWidget.prototype.setColorTheme=function(){var b=this.params.get(SMParams.constants.BGCOLOR)||"",c=this.params.get(SMParams.constants.FGCOLOR)||"",a=document.getElementById("button-content");if((b=b||a.getAttribute("data-bg-color")||"")){a.style.backgroundColor=b}if((c=c||a.getAttribute("data-fg-color")||"")){a.style.color=c}};"use strict";var CustomWidget=function(a){SMWidget.call(this,a)};CustomWidget.prototype=new SMWidgetCreator();CustomWidget.prototype.constructor=CustomWidget;CustomWidget.prototype.init=function(){SMWidget.prototype.init.call(this,function(a){a.call(this)})};CustomWidget.prototype.update=function(a){};CustomWidget.prototype.getFrameStyles=function(){};