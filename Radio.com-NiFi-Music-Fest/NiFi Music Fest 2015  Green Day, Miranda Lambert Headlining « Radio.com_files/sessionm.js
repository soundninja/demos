(function(T,h,y){var J={bar:"bar",box:"box",button:"button",custom:"custom"},i={topFadeIn:"topFadeIn",custom:"custom"},l="https://m.sessionm.com",f="https://api.sessionm.com",ab={embed:{}},L=0,m=0,O=[],A={},v={};A.test=false;A.serverUrl=l;A.achievementData={deprecated:true,unclaimed:0,earned:false,newUser:false};A.isSupported=function(){return A.test||p};var R=T;var q=(new Date())+"";var p=((R.JSON||{}).parse&&R.addEventListener&&R.localStorage&&R.sessionStorage&&R.postMessage)&&(/(Atlantic|Eastern|Central|Mountain|Pacific|Alaska|Hawaii)/i.test(q)||/(A|AK|H|E|C|M|P)[SD]T/.test(q));var e=function(){if(A.serverUrl!==l||k()){return A.serverUrl}else{return f}};var b=function(ad){var ae,w;ad=ad||{};ad.handler="updateWidget";for(w=0;ae=O[w];w++){ae.messagesQueue.push(ad)}X()};var t=function(ad,w){if(ad&&A.appID&&a(ad)!==a(A.appID)){return true}else{if((w||A.siteID)&&a(w)!==a(A.siteID)){return true}}return false};var g=function(){var ad,w;for(w=0;ad=O[w];w++){if(ad.iframe){try{ad.iframe.parentNode.removeChild(ad.iframe)}catch(ae){}ad.iframe=null}}m=0;O=[]};var X=function(){var ae,ad,w;for(w=0;ae=O[w];w++){while((ad=ae.messagesQueue[0])){if(V.call(ae,ad)){ae.messagesQueue.shift()}else{break}}}};var V=function(ag){var ae,af,ad;if(this.ready&&(ad=(this.iframe||{}).contentWindow)&&ad.postMessage){if((af=JSON.stringify(ag))){ad.postMessage(af,e())}return true}return false};var c=function(w){var ad;if((w||{}).origin===e()){ad=JSON.parse(w.data||"{}");z(ad);P(ad)}};var P=function(ad){var w=(ad.index)?O[parseInt(ad.index)]:y,ae;v.userData=JSON.parse(ad.userData||"{}");v.offers=JSON.parse(ad.offers||"[]");v.urls=JSON.parse(JSON.stringify(ad.urls));if(w){w.mode=ad.mode}switch(ad.handler){case"callback":if(ad.callbackId&&(ae=ab[ad.callbackId])){delete ab[ad.callbackId];ae(ad.action,ad.earned,E(ad))}break;case"earned":case"reload":case"updateWidget":b({reload:(ad.handler==="reload")});break;case"ready":if(ad.index&&(ae=ab.embed[ad.index])){ae(ad)}break;case"toggleMode":if(w&&ad.cssText){w.iframe.style.cssText=ad.cssText;s.call(w,"widget"+w.widgetId,"modeChanged",w.mode)}break;case"userUpdated":s.call(A,"sessionm","userUpdated",A.getUser());break}};var E=function(w){if(w.achievement){w.achievement=new W(w.achievement);if(w.achievementAlertHtml&&w.achievementAlertStyle){Z(w)}}return w.achievement};A.widget=function(ad){var ae,w;ad=(typeof(ad)==="string")?{appID:ad}:ad;if(O[0]&&t(ad.appID,ad.siteID)){this.isNewApiKey=true;g()}ad.appID=ad.appID||A.appID;ad.siteID=ad.siteID||A.siteID;if(!(this instanceof A.widget)){throw ("Not using the new operator!")}if(!ad.appID){throw ("Missing appID!")}this.appID=(A.appID=a(ad.appID));this.siteID=(A.siteID=a(ad.siteID));this.style=J[ad.style||""]||J.box;this.action=ad.action||"visit";this.returnURL=U(ad.returnURL||T.location.href);this.opensToHome=(ad.opensToHome===true);this.data=ad.data||{};this.widgetId=m++;this.mode=ad.mode||"";this.bgColor=ad.bgColor||"";this.fgColor=ad.fgColor||"";ae=this.appID;if((this.siteID||"").length){w=v.siteIDRgx||(v.siteIDRgx=/[^a-zA-Z0-9_]/g);ae+="-"+(this.siteID||"").replace(w,"_")}this.url=e()+"/v6/apps/"+ae+"/widgets/"+this.style+".html";this.checkUrl=e()+"/v6/apps/"+ae+"/widgets/check_exists.png";this.messagesQueue=[]};A.widget.prototype.sendAction=function(af,ad){var w,ae;if(A.isSupported()&&this.appID&&typeof(af)==="string"&&af){ad=(typeof(ad)==="function")?{callback:ad}:ad||{};w={handler:"action",action:af,url:T.location.href};w.throttleByUrlUniqueness=!!ad.throttleByUrlUniqueness;w.alertStyle=i[ad.alertStyle||""]||i.custom;ae=S();ab[ae]=j(ad.callback||function(){},this);w.callback={callbackId:ae};this.messagesQueue.push(w);X()}};A.widget.prototype.init=function(w){this.embed(h.body,w)};A.widget.prototype.embed=function(w,ad){if(A.isSupported()&&this.appID){O.push(this);ab.embed[this.widgetId+""]=j(function(ae){if(!v.initialInitRun){F();N();v.initialInitRun=true}if(ae.cssText){this.iframe.style.cssText=ae.cssText}this.ready=true;X();if(ad){ad.call(this,ae.action,ae.earned,E(ae))}},this);o.call(this);if(this.widgetId===0||v.initialInitRun){u.call(this,w)}else{this.parentElement=w}}};A.widget.prototype.openPortal=function(af){var w=v.openUrlRgx||(v.openUrlRgx=/&z=[0-9]{12}/),ag=((af||{}).home===true||this.opensToHome),ae,ad;Q();if(A.isSupported()&&this.appID&&v.urls){af=af||{};ad=(ag)?"feedUrl":(af.rewards===true)?"rewardsUrl":(af.achievements===true)?"achievementsUrl":"defaultUrl";ae=v.urls[ad]||v.urls.defaultUrl||A.serverUrl;ae=ae.replace(w,"&z="+(new Date()).getTime());if(B()>=8){T.location.href=ae}else{T.open(ae,"_blank")}}};A.widget.prototype.addEventListener=function(w,ad){M("widget"+this.widgetId,w,ad)};A.widget.prototype.setMode=function(w){if(A.isSupported()&&this.appID&&typeof(w)==="string"&&w){if(w!==this.mode){this.messagesQueue.push({handler:"toggleMode",mode:w});X()}}};A.widget.prototype.getMode=function(){return this.mode};A.openPortal=function(w){if(O[0]){O[0].openPortal(w)}};A.addEventListener=function(w,ad){M("sessionm",w,ad)};A.resetClient=function(){var w;Q();if(O[0]){w={handler:"updateWidget",resetClient:true};O[0].messagesQueue.push(w);X()}};var o=function(){this.iframe=h.createElement("iframe");this.iframe.setAttribute("name","sessionm");this.iframe.setAttribute("frameborder","0");this.iframe.setAttribute("marginheight","0");this.iframe.setAttribute("marginwidth","0");this.iframe.setAttribute("scrolling","no");this.iframe.setAttribute("seamless","seamless");this.iframe.setAttribute("allowtransparency","true");this.iframe.style.cssText="width:0px;height:0px;display:none;";this.data.url=this.returnURL;this.data.action=this.action;this.data.origin=T.location.href;this.data.title=h.title;this.data.description=Y();this.data.index=this.widgetId;this.data.opensToHome=this.opensToHome;this.data.bgColor=this.bgColor;this.data.fgColor=this.fgColor;this.data.mode=this.mode;if(this.isNewApiKey){this.data.isNewApiKey=this.isNewApiKey}this.data.z=(new Date()).getTime();this.iframe.src=this.url+"#"+x(this.data)};var u=function(ad){var w,ae,af;if(!A.isSupported()){return}ae=j(function(){if(!w){w=true;af=j(K,this,ad);if(C("sessionm","configError")){aa.call(this,af)}else{af()}}},this);if(h.readyState==="complete"||h.readyState==="interactive"){ae()}else{h.addEventListener("DOMContentLoaded",ae);T.addEventListener("load",ae)}};var aa=function(ae){var ad=h.createElement("img"),w="appID not found!";if(A.siteID){w="appID/siteID pair not found!"}ad.onload=ae;ad.onerror=j(s,A,"sessionm","configError",w);ad.src=this.checkUrl};var K=function(w){w=(typeof(w)==="string")?h.getElementById(w):w;(w||h.body).appendChild(this.iframe)};var F=function(){var ad,w;for(w=1;ad=O[w];w++){u.call(ad,ad.parentElement)}};var N=function(){var ae=["hidden","webkitHidden","mozHidden","msHiddden"],af=["","webkit","moz","ms"],w,ad;for(w=af.length,ad=0;ad<w;ad++){if((af[ad]+"visibilitychange") in h){v.hiddenProp=ae[ad];h.addEventListener(af[ad]+"visibilitychange",I);return}}T.addEventListener("focus",I);T.addEventListener("focusin",I);T.addEventListener("pageshow",I)};var I=function(af){var ae={focus:1,focusin:1,pageshow:1},ad=(af||{}).type,w=false;if(v.hiddenProp){w=(h[v.hiddenProp]===false)}else{if(ae[(ad||"").toLowerCase()]){w=true}}if(w){b({updateData:true})}};var Z=function(af){var w=Object.prototype.hasOwnProperty,ad,ah,ae,ag;if(!h.getElementById("smAA")){h.body.insertAdjacentHTML("beforeend",af.achievementAlertHtml);ah=function(){if((ad=h.getElementById("smAA"))){if((ae=ad.getAttribute("data-styles"))){ae=JSON.parse(ae);for(ag in ae){if(w.call(ae,ag)){ad.style[ag]=ae[ag]}}}}};if(T.requestAnimationFrame){T.requestAnimationFrame(function(){T.requestAnimationFrame(ah)})}else{ah()}}};var Q=function(){var w=h.getElementById("smAA");if(w){w.parentNode.removeChild(w)}};var x=function(af){var w=Object.prototype.hasOwnProperty,ad=encodeURIComponent,ae=[],ag;for(ag in af){if(w.call(af,ag)){ae.push(ad(ag)+"="+ad(af[ag]))}}return ae.join("&")};A.getUser=function(){return(new H(v.userData||{}))};var H=function(ae){var w,ad;D(this,ae);if((w=(this.achievements||[]).length)){for(ad=0;ad<w;ad++){this.achievements[ad]=new W(this.achievements[ad])}}if((w=(this.achievementHistory||[]).length)){for(ad=0;ad<w;ad++){this.achievementHistory[ad]=new n(this.achievementHistory[ad])}}};H.prototype.getAchievements=function(){return this.achievements};H.prototype.getAchievementHistory=function(){return this.achievementHistory};H.prototype.getPointBalance=function(){return this.points};H.prototype.getUnclaimedAchievementCount=function(){return this.unclaimedCount};H.prototype.getUnclaimedAchievementValue=function(){return this.unclaimedValue};H.prototype.isLoggedIn=function(){return this.loggedIn};H.prototype.isNewUser=function(){return this.newUser};H.prototype.isOptedOut=function(){return this.optedOut};H.prototype.isRegistered=function(){return this.registered};H.prototype.setOptedOut=function(w,af){var ad,ae;if(O[0]){ad={handler:"updateUser",optedOut:!!w};if(af){ae=S();ab[ae]=j(af,this);ad.callback={callbackId:ae}}O[0].messagesQueue.push(ad);X()}};var W=function(w){D(this,w)};W.prototype.getAchievementIconURL=function(){return this.achievementIconUrl};W.prototype.getAction=function(){return this.action};W.prototype.getDistance=function(){return this.distance};W.prototype.getFullDistance=function(){return this.fullDistance};W.prototype.getInstructions=function(){return this.instructions};W.prototype.getLastEarnedDate=function(){if(this.lastEarnedDate){return(new Date(this.lastEarnedDate))}return this.lastEarnedDate};W.prototype.getMessage=function(){return this.message};W.prototype.getName=function(){return this.name};W.prototype.getPointValue=function(){return this.points};var n=function(w){D(this,w)};n.prototype.getAction=function(){return this.action};n.prototype.getName=function(){return this.name};n.prototype.getPointValue=function(){return this.points};n.prototype.getState=function(){return this.state};n.prototype.getTimesEarned=function(){return this.timesEarned};n.prototype.getUnclaimedCount=function(){return this.unclaimedCount};n.prototype.getInstructions=function(){return this.instructions};n.prototype.getLimitText=function(){return this.limitText};n.prototype.getLastEarnedDate=function(){if(this.lastEarnedDate){return(new Date(this.lastEarnedDate))}return this.lastEarnedDate};A.getRewards=function(){var ae=[],ad,w;for(w=0;ad=(v.offers||[])[w];w++){ae[w]=new G(ad)}return ae};var G=function(w){D(this,w)};G.prototype.getId=function(){return this.id};G.prototype.getName=function(){return this.name};G.prototype.getPointValue=function(){return this.points};G.prototype.getImageSrc=function(){return this.imageSrc};G.prototype.getType=function(){return this.type};G.prototype.getExpiresAtDate=function(){if(this.expiresAt){return(new Date(this.expiresAt))}return this.expiresAt};G.prototype.getUrl=function(){return this.url};var D=function(w,af){var ad=Object.prototype.hasOwnProperty,ag,ae;for(ag in af){if(ad.call(af,ag)){if((ae=af[ag])!==y&&ae!==null){w[ag]=ae}}}};var z=function(ad){var w=A.achievementData;w.newUser=ad.newUser||false;w.unclaimed=ad.unclaimed||0;w.earned=ad.earned||false};var B=function(){var w;if(!v.iosVersion){if(/iP(ad|hone|od)/.test((w=navigator.userAgent))){v.iosVersion=parseFloat(w.replace(/.*OS\s(\d+)_(\d+).*/,"$1.$2"))||-1}else{v.iosVersion=-1}}return v.iosVersion};var ac=function(){var w;if(!v.ieVersion){if((w=navigator).appName==="Microsoft Internet Explorer"){if(new RegExp("MSIE ([0-9]{1,}[.0-9]{0,})").exec(w.userAgent)){v.ieVersion=parseFloat(RegExp.$1)}}v.ieVersion=(v.ieVersion>5)?v.ieVersion:-1}return v.ieVersion};var k=function(){if(v.supportsCORS===y){v.supportsCORS=!!("withCredentials" in new XMLHttpRequest());if(ac()>0&&ac()<10){v.supportsCORS=false}}return v.supportsCORS};var j=function(af,ae){var ad=Array.prototype.slice,w=ad.call(arguments,2);return function(){return af.apply(ae,w.concat(ad.call(arguments)))}};v.trimRgx=/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g;var a=function(w){return((w||"")+"").replace(v.trimRgx,"")};var S=function(){return"cb"+(L++)};var U=function(ad){var w=v.anchor||(v.anchor=h.createElement("a"));w.href=ad;w.hash="";return w.href.replace(/#$/,"")};var Y=function(){var ae,w,af,ad;if(v.documentDescription===y){v.documentDescription="";ae=h.getElementsByTagName("meta");for(ad=0;w=ae[ad];ad++){af=(w.getAttribute("name")||"").toLowerCase();af=af||(w.getAttribute("property")||"").toLowerCase();if(af==="description"){v.documentDescription=w.getAttribute("content")||"";break}}}return v.documentDescription};var M=function(ad,w,ae){if(typeof(w)!=="string"||!w){throw ("Invalid event string.")}if(typeof(ae)!=="function"){throw ("Invalid listener function.")}d(ad,w).push(ae)};var d=function(ad,w){if(!v.listeners){v.listeners={}}if(!v.listeners[ad]){v.listeners[ad]={}}if(!v.listeners[ad][w]){v.listeners[ad][w]=[]}return v.listeners[ad][w]};var C=function(ad,w){return !!d(ad,w).length};var s=function(ag,w){var af=d(ag,w),ad=[].slice.call(arguments,2),ah,ae;for(ae=0;ah=af[ae];ae++){ah.apply(this,ad)}};var r=function(af,w){var ad;try{ad=new Event(w)}catch(ae){if(h.createEvent){ad=h.createEvent("Event");ad.initEvent(w,true,true)}}if(af.dispatchEvent){af.dispatchEvent(ad)}};if(T.addEventListener){T.addEventListener("message",c)}T.sessionm=A;r(T,"sessionm.loaded")})(self,self.document);