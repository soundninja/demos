(function(){if(typeof(CTVKwWidget)==="undefined"){CTVKwWidget={};CTVKwWidget=function(){this.sourceURL="";this.pId="38600c725ef34fe1b221b8d103dad841";this.adSetCode="";this.siteName="complex";this.keywords="";this.xmlhttp="";this.esEndpoint="http://apps.complex.com/tv/search/getRelatedVideos/";this.embedScript="";this.bestCId="";this.cIdToExclude="";this.playerParams={};this.tagsDiv=document.getElementsByClassName("article-tags__tag");this.init=function(){this.SetKeywordsFoundOnPage();if(this.keywords){this.setScriptSourceURL();this.getPlayerData();this.getCIdFromLeadIfExists();this.sendAjaxRequest();this.retrieveResponseAndGenerateEmbed()}else{this.hideWatchNowBlock()}};this.setScriptSourceURL=function(){var a,b;a=document.getElementById("cmplx-kw-widget-js");b=a.src.replace(/^http\:\/\/|^https\:\/\//i,"").split(".")[0];if(b==="complextv"){this.sourceURL="http://"+b+".local"}else{this.sourceURL="http://"+b+".complex.com"}};this.getPlayerData=function(){var c=document.getElementById("cmplx-kw-widget");var a=c.getAttribute("data-pid");var b=c.getAttribute("data-adsetcode");var d=c.getAttribute("data-sitename");this.setCorrectPId(a);this.adSetCode=b?b:this.adSetCode;this.siteName=d?d:this.siteName};this.getCIdFromLeadIfExists=function(){var a="";if(window.lead_carousel&&window.lead_carousel[0]){a=window.lead_carousel[0].ooyalaId;if(a){this.cIdToExclude=a}}};this.setCorrectPId=function(a){if(a!="556f8260656c47a4ab49bf6f2dde85f3"&&a){this.pId=a}};this.SetKeywordsFoundOnPage=function(){if(this.tagsDivExist()){this.getKwFromTags()}else{this.getKwFromMeta()}this.processKeywords()};this.processKeywords=function(){var a=this.keywords.replace(/\s*,\s*/g,",");this.keywords=encodeURIComponent(a.toLowerCase())};this.tagsDivExist=function(){return this.tagsDiv.length>0};this.getKwFromTags=function(){for(var a=0;a<this.tagsDiv.length;a++){this.keywords+=this.tagsDiv[a].innerHTML.trim()+","}this.keywords=this.keywords.replace(/,\s*$/,"")};this.getKwFromMeta=function(){var b=document.getElementsByTagName("meta");for(var a=0;a<b.length;a++){if(b[a].getAttribute("name")=="keywords"){this.keywords=b[a].getAttribute("content");return}}};this.sendAjaxRequest=function(){if(window.XMLHttpRequest){this.xmlhttp=new XMLHttpRequest()}else{this.xmlhttp=new ActiveXObject("Microsoft.XMLHTTP")}this.xmlhttp.open("GET",this.esEndpoint+this.keywords,true);this.xmlhttp.send()};this.retrieveResponseAndGenerateEmbed=function(){var a="";var b=this;this.xmlhttp.onreadystatechange=function(){if(b.xmlhttp.readyState==4){if(b.xmlhttp.status==200){a=JSON.parse(b.xmlhttp.response);b.processAndSetCid(a);if(b.bestCId){b.loadCTVEmbedScriptIfNotExist();b.generateEmbed()}else{b.hideWatchNowBlock();console.log("No ELS Search Results Found")}}else{console.log("Something else other than 200 was returned.")}}}};this.processAndSetCid=function(a){var b="";if(typeof a==="string"){this.bestCId=(a===this.cIdToExclude)?"":a}else{b=a.indexOf(this.cIdToExclude);if(b!==-1){a.splice(b,1)}this.bestCId=a[0]}};this.hideWatchNowBlock=function(){document.getElementsByClassName("relevancy-widget")[0].style.display="none"};this.loadCTVEmbedScriptIfNotExist=function(){if(!this.ctvEmbedScriptExists()){this.embedScript=document.createElement("script");this.embedScript.type="text/javascript";this.embedScript.src=this.sourceURL+"/tv/js/embed.js";this.embedScript.className="cmplx-embed";document.getElementsByTagName("head")[0].appendChild(this.embedScript)}};this.ctvEmbedScriptExists=function(){return typeof(window.CTVEmbed)!="undefined"};this.generateEmbed=function(){var a=this;if(!this.ctvEmbedScriptExists()){this.embedScript.onload=function(){a.initializeEmbed()}}else{this.initializeEmbed()}};this.initializeEmbed=function(){var a;this.playerParams={cId:this.bestCId,pId:this.pId,adSetCode:this.adSetCode,site:this.siteName,divId:"cmplx-kw-widget",embedType:"Keyword Embed"};a=new CTVEmbed();a.init(this.playerParams)}}}})();