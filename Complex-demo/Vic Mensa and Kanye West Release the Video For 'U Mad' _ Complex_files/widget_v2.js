(function(){if(typeof(document.documentElement.hasOwnProperty==="undefined")){document.documentElement.hasOwnProperty=function(property){Object.prototype.hasOwnProperty.call(document.documentElement,property)}}if(typeof(Date.now)==="undefined"){Date.now=function(){return new Date.getTime()}}function initializejQueryColorbox(jQuery){
/*!
		Colorbox v1.5.5 - 2014-03-13
		jQuery lightbox and modal window plugin
		(c) 2014 Jack Moore - http://www.jacklmoore.com/colorbox
		license: http://www.opensource.org/licenses/mit-license.php
	*/
(function(t,e,i){function n(i,n,o){var r=e.createElement(i);return n&&(r.id=Z+n),o&&(r.style.cssText=o),t(r)}function o(){return i.innerHeight?i.innerHeight:t(i).height()}function r(e,i){i!==Object(i)&&(i={}),this.cache={},this.el=e,this.value=function(e){var n;return void 0===this.cache[e]&&(n=t(this.el).attr("data-cbox-"+e),void 0!==n?this.cache[e]=n:void 0!==i[e]?this.cache[e]=i[e]:void 0!==X[e]&&(this.cache[e]=X[e])),this.cache[e]},this.get=function(e){var i=this.value(e);return t.isFunction(i)?i.call(this.el,this):i}}function h(t){var e=E.length,i=(z+t)%e;return 0>i?e+i:i}function s(t,e){return Math.round((/%/.test(t)?("x"===e?W.width():o())/100:1)*parseInt(t,10))}function a(t,e){return t.get("photo")||t.get("photoRegex").test(e)}function l(t,e){return t.get("retinaUrl")&&i.devicePixelRatio>1?e.replace(t.get("photoRegex"),t.get("retinaSuffix")):e}function d(t){"contains" in x[0]&&!x[0].contains(t.target)&&t.target!==v[0]&&(t.stopPropagation(),x.focus())}function c(t){c.str!==t&&(x.add(v).removeClass(c.str).addClass(t),c.str=t)}function g(){z=0,rel&&"nofollow"!==rel?(E=t("."+te).filter(function(){var e=t.data(this,Y),i=new r(this,e);return i.get("rel")===rel}),z=E.index(_.el),-1===z&&(E=E.add(_.el),z=E.length-1)):E=t(_.el)}function u(i){t(e).trigger(i),se.triggerHandler(i)}function f(i){var o;G||(o=t(i).data("colorbox"),_=new r(i,o),rel=_.get("rel"),g(),$||($=q=!0,c(_.get("className")),x.css({visibility:"hidden",display:"block",opacity:""}),L=n(ae,"LoadedContent","width:0; height:0; overflow:hidden; visibility:hidden"),b.css({width:"",height:""}).append(L),D=T.height()+k.height()+b.outerHeight(!0)-b.height(),j=C.width()+H.width()+b.outerWidth(!0)-b.width(),A=L.outerHeight(!0),N=L.outerWidth(!0),_.w=s(_.get("initialWidth"),"x"),_.h=s(_.get("initialHeight"),"y"),L.css({width:"",height:_.h}),J.position(),u(ee),_.get("onOpen"),O.add(R).hide(),x.focus(),_.get("trapFocus")&&e.addEventListener&&(e.addEventListener("focus",d,!0),se.one(re,function(){e.removeEventListener("focus",d,!0)})),_.get("returnFocus")&&se.one(re,function(){t(_.el).focus()})),v.css({opacity:parseFloat(_.get("opacity"))||"",cursor:_.get("overlayClose")?"pointer":"",visibility:"visible"}).show(),_.get("closeButton")?B.html(_.get("close")).appendTo(b):B.appendTo("<div/>"),w())}function p(){!x&&e.body&&(V=!1,W=t(i),x=n(ae).attr({id:Y,"class":t.support.opacity===!1?Z+"IE":"",role:"dialog",tabindex:"-1"}).hide(),v=n(ae,"Overlay").hide(),M=t([n(ae,"LoadingOverlay")[0],n(ae,"LoadingGraphic")[0]]),y=n(ae,"Wrapper"),b=n(ae,"Content").append(R=n(ae,"Title"),F=n(ae,"Current"),P=t('<button type="button"/>').attr({id:Z+"Previous"}),K=t('<button type="button"/>').attr({id:Z+"Next"}),I=n("button","Slideshow"),M),B=t('<button type="button"/>').attr({id:Z+"Close"}),y.append(n(ae).append(n(ae,"TopLeft"),T=n(ae,"TopCenter"),n(ae,"TopRight")),n(ae,!1,"clear:left").append(C=n(ae,"MiddleLeft"),b,H=n(ae,"MiddleRight")),n(ae,!1,"clear:left").append(n(ae,"BottomLeft"),k=n(ae,"BottomCenter"),n(ae,"BottomRight"))).find("div div").css({"float":"left"}),S=n(ae,!1,"position:absolute; width:9999px; visibility:hidden; display:none; max-width:none;"),O=K.add(P).add(F).add(I),t(e.body).append(v,x.append(y,S)))}function m(){function i(t){t.which>1||t.shiftKey||t.altKey||t.metaKey||t.ctrlKey||(t.preventDefault(),f(this))}return x?(V||(V=!0,K.click(function(){J.next()}),P.click(function(){J.prev()}),B.click(function(){J.close()}),v.click(function(){_.get("overlayClose")&&J.close()}),t(e).bind("keydown."+Z,function(t){var e=t.keyCode;$&&_.get("escKey")&&27===e&&(t.preventDefault(),J.close()),$&&_.get("arrowKey")&&E[1]&&!t.altKey&&(37===e?(t.preventDefault(),P.click()):39===e&&(t.preventDefault(),K.click()))}),t.isFunction(t.fn.on)?t(e).on("click."+Z,"."+te,i):t("."+te).live("click."+Z,i)),!0):!1}function w(){var o,r,h,d=J.prep,c=++le;q=!0,U=!1,u(he),u(ie),_.get("onLoad"),_.h=_.get("height")?s(_.get("height"),"y")-A-D:_.get("innerHeight")&&s(_.get("innerHeight"),"y"),_.w=_.get("width")?s(_.get("width"),"x")-N-j:_.get("innerWidth")&&s(_.get("innerWidth"),"x"),_.mw=_.w,_.mh=_.h,_.get("maxWidth")&&(_.mw=s(_.get("maxWidth"),"x")-N-j,_.mw=_.w&&_.w<_.mw?_.w:_.mw),_.get("maxHeight")&&(_.mh=s(_.get("maxHeight"),"y")-A-D,_.mh=_.h&&_.h<_.mh?_.h:_.mh),o=_.get("href"),Q=setTimeout(function(){M.show()},100),_.get("inline")?(h=n(ae).hide().insertBefore(t(o)[0]),se.one(he,function(){h.replaceWith(L.children())}),d(t(o))):_.get("iframe")?d(" "):_.get("html")?d(_.get("html")):a(_,o)?(o=l(_,o),U=e.createElement("img"),t(U).addClass(Z+"Photo").bind("error",function(){d(n(ae,"Error").html(_.get("imgError")))}).one("load",function(){var e;c===le&&(t.each(["alt","longdesc","aria-describedby"],function(e,i){var n=t(_.el).attr(i)||t(_.el).attr("data-"+i);n&&U.setAttribute(i,n)}),_.get("retinaImage")&&i.devicePixelRatio>1&&(U.height=U.height/i.devicePixelRatio,U.width=U.width/i.devicePixelRatio),_.get("scalePhotos")&&(r=function(){U.height-=U.height*e,U.width-=U.width*e},_.mw&&U.width>_.mw&&(e=(U.width-_.mw)/U.width,r()),_.mh&&U.height>_.mh&&(e=(U.height-_.mh)/U.height,r())),_.h&&(U.style.marginTop=Math.max(_.mh-U.height,0)/2+"px"),E[1]&&(_.get("loop")||E[z+1])&&(U.style.cursor="pointer",U.onclick=function(){J.next()}),U.style.width=U.width+"px",U.style.height=U.height+"px",setTimeout(function(){d(U)},1))}),setTimeout(function(){U.src=o},1)):o&&S.load(o,_.get("data"),function(e,i){c===le&&d("error"===i?n(ae,"Error").html(_.get("xhrError")):t(this).contents())})}var v,x,y,b,T,C,H,k,E,W,L,S,M,R,F,I,K,P,B,O,_,D,j,A,N,z,U,$,q,G,Q,J,V,X={html:!1,photo:!1,iframe:!1,inline:!1,transition:"elastic",speed:300,fadeOut:300,width:!1,initialWidth:"600",innerWidth:!1,maxWidth:!1,height:!1,initialHeight:"450",innerHeight:!1,maxHeight:!1,scalePhotos:!0,scrolling:!0,opacity:0.9,preloading:!0,className:!1,overlayClose:!0,escKey:!0,arrowKey:!0,top:!1,bottom:!1,left:!1,right:!1,fixed:!1,data:void 0,closeButton:!0,fastIframe:!0,open:!1,reposition:!0,loop:!0,slideshow:!1,slideshowAuto:!0,slideshowSpeed:2500,slideshowStart:"start slideshow",slideshowStop:"stop slideshow",photoRegex:/\.(gif|png|jp(e|g|eg)|bmp|ico|webp|jxr|svg)((#|\?).*)?$/i,retinaImage:!1,retinaUrl:!1,retinaSuffix:"@2x.$1",current:"image {current} of {total}",previous:"previous",next:"next",close:"close",xhrError:"This content failed to load.",imgError:"This image failed to load.",returnFocus:!0,trapFocus:!0,onOpen:!1,onLoad:!1,onComplete:!1,onCleanup:!1,onClosed:!1,rel:function(){return this.rel},href:function(){return t(this).attr("href")},title:function(){return this.title}},Y="colorbox",Z="cbox",te=Z+"Element",ee=Z+"_open",ie=Z+"_load",ne=Z+"_complete",oe=Z+"_cleanup",re=Z+"_closed",he=Z+"_purge",se=t("<a/>"),ae="div",le=0,de={},ce=function(){function t(){clearTimeout(h)}function e(){(_.get("loop")||E[z+1])&&(t(),h=setTimeout(J.next,_.get("slideshowSpeed")))}function i(){I.html(_.get("slideshowStop")).unbind(a).one(a,n),se.bind(ne,e).bind(ie,t),x.removeClass(s+"off").addClass(s+"on")}function n(){t(),se.unbind(ne,e).unbind(ie,t),I.html(_.get("slideshowStart")).unbind(a).one(a,function(){J.next(),i()}),x.removeClass(s+"on").addClass(s+"off")}function o(){r=!1,I.hide(),t(),se.unbind(ne,e).unbind(ie,t),x.removeClass(s+"off "+s+"on")}var r,h,s=Z+"Slideshow_",a="click."+Z;return function(){r?_.get("slideshow")||(se.unbind(oe,o),o()):_.get("slideshow")&&E[1]&&(r=!0,se.one(oe,o),_.get("slideshowAuto")?i():n(),I.show())}}();t.colorbox||(t(p),J=t.fn[Y]=t[Y]=function(e,i){var n,o=this;if(e=e||{},t.isFunction(o)){o=t("<a/>"),e.open=!0}else{if(!o[0]){return o}}return o[0]?(p(),m()&&(i&&(e.onComplete=i),o.each(function(){var i=t.data(this,Y)||{};t.data(this,Y,t.extend(i,e))}).addClass(te),n=new r(o[0],e),n.get("open")&&f(o[0])),o):o},J.position=function(e,i){function n(){T[0].style.width=k[0].style.width=b[0].style.width=parseInt(x[0].style.width,10)-j+"px",b[0].style.height=C[0].style.height=H[0].style.height=parseInt(x[0].style.height,10)-D+"px"}var r,h,a,l=0,d=0,c=x.offset();if(W.unbind("resize."+Z),x.css({top:-90000,left:-90000}),h=W.scrollTop(),a=W.scrollLeft(),_.get("fixed")?(c.top-=h,c.left-=a,x.css({position:"fixed"})):(l=h,d=a,x.css({position:"absolute"})),d+=_.get("right")!==!1?Math.max(W.width()-_.w-N-j-s(_.get("right"),"x"),0):_.get("left")!==!1?s(_.get("left"),"x"):Math.round(Math.max(W.width()-_.w-N-j,0)/2),l+=_.get("bottom")!==!1?Math.max(o()-_.h-A-D-s(_.get("bottom"),"y"),0):_.get("top")!==!1?s(_.get("top"),"y"):Math.round(Math.max(o()-_.h-A-D,0)/2),x.css({top:c.top,left:c.left,visibility:"visible"}),y[0].style.width=y[0].style.height="9999px",r={width:_.w+N+j,height:_.h+A+D,top:l,left:d},e){var g=0;t.each(r,function(t){return r[t]!==de[t]?(g=e,void 0):void 0}),e=g}de=r,e||x.css(r),x.dequeue().animate(r,{duration:e||0,complete:function(){n(),q=!1,y[0].style.width=_.w+N+j+"px",y[0].style.height=_.h+A+D+"px",_.get("reposition")&&setTimeout(function(){W.bind("resize."+Z,J.position)},1),i&&i()},step:n})},J.resize=function(t){var e;$&&(t=t||{},t.width&&(_.w=s(t.width,"x")-N-j),t.innerWidth&&(_.w=s(t.innerWidth,"x")),L.css({width:_.w}),t.height&&(_.h=s(t.height,"y")-A-D),t.innerHeight&&(_.h=s(t.innerHeight,"y")),t.innerHeight||t.height||(e=L.scrollTop(),L.css({height:"auto"}),_.h=L.height()),L.css({height:_.h}),e&&L.scrollTop(e),J.position("none"===_.get("transition")?0:_.get("speed")))},J.prep=function(i){function o(){return _.w=_.w||L.width(),_.w=_.mw&&_.mw<_.w?_.mw:_.w,_.w}function s(){return _.h=_.h||L.height(),_.h=_.mh&&_.mh<_.h?_.mh:_.h,_.h}if($){var d,g="none"===_.get("transition")?0:_.get("speed");L.remove(),L=n(ae,"LoadedContent").append(i),L.hide().appendTo(S.show()).css({width:o(),overflow:_.get("scrolling")?"auto":"hidden"}).css({height:s()}).prependTo(b),S.hide(),t(U).css({"float":"none"}),c(_.get("className")),d=function(){function i(){t.support.opacity===!1&&x[0].style.removeAttribute("filter")}var n,o,s=E.length;$&&(o=function(){clearTimeout(Q),M.hide(),u(ne),_.get("onComplete")},R.html(_.get("title")).show(),L.show(),s>1?("string"==typeof _.get("current")&&F.html(_.get("current").replace("{current}",z+1).replace("{total}",s)).show(),K[_.get("loop")||s-1>z?"show":"hide"]().html(_.get("next")),P[_.get("loop")||z?"show":"hide"]().html(_.get("previous")),ce(),_.get("preloading")&&t.each([h(-1),h(1)],function(){var i,n=E[this],o=new r(n,t.data(n,Y)),h=o.get("href");h&&a(o,h)&&(h=l(o,h),i=e.createElement("img"),i.src=h)})):O.hide(),_.get("iframe")?(n=e.createElement("iframe"),"frameBorder" in n&&(n.frameBorder=0),"allowTransparency" in n&&(n.allowTransparency="true"),_.get("scrolling")||(n.scrolling="no"),t(n).attr({src:_.get("href"),name:(new Date).getTime(),"class":Z+"Iframe",allowFullScreen:!0}).one("load",o).appendTo(L),se.one(he,function(){n.src="//about:blank"}),_.get("fastIframe")&&t(n).trigger("load")):o(),"fade"===_.get("transition")?x.fadeTo(g,1,i):i())},"fade"===_.get("transition")?x.fadeTo(g,0,function(){J.position(0,d)}):J.position(g,d)}},J.next=function(){!q&&E[1]&&(_.get("loop")||E[z+1])&&(z=h(1),f(E[z]))},J.prev=function(){!q&&E[1]&&(_.get("loop")||z)&&(z=h(-1),f(E[z]))},J.close=function(){$&&!G&&(G=!0,$=!1,u(oe),_.get("onCleanup"),W.unbind("."+Z),v.fadeTo(_.get("fadeOut")||0,0),x.stop().fadeTo(_.get("fadeOut")||0,0,function(){x.hide(),v.hide(),u(he),L.remove(),setTimeout(function(){G=!1,u(re),_.get("onClosed")},1)}))},J.remove=function(){x&&(x.stop(),t.colorbox.close(),x.stop().remove(),v.remove(),G=!1,x=null,t("."+te).removeData(Y).removeClass(te),t(e).unbind("click."+Z))},J.element=function(){return t(_.el)},J.settings=X)})(jQuery,document,window)}function initializeUnderscore(){var environment={};var exports=undefined;(function(){var n=this,t=n._,r={},e=Array.prototype,u=Object.prototype,i=Function.prototype,a=e.push,o=e.slice,c=e.concat,l=u.toString,f=u.hasOwnProperty,s=e.forEach,p=e.map,v=e.reduce,h=e.reduceRight,g=e.filter,d=e.every,m=e.some,y=e.indexOf,b=e.lastIndexOf,x=Array.isArray,_=Object.keys,j=i.bind,w=function(n){return n instanceof w?n:this instanceof w?(this._wrapped=n,void 0):new w(n)};"undefined"!=typeof exports?("undefined"!=typeof module&&module.exports&&(exports=module.exports=w),exports._=w):n._=w,w.VERSION="1.4.3";var A=w.each=w.forEach=function(n,t,e){if(null!=n){if(s&&n.forEach===s){n.forEach(t,e)}else{if(n.length===+n.length){for(var u=0,i=n.length;i>u;u++){if(t.call(e,n[u],u,n)===r){return}}}else{for(var a in n){if(w.has(n,a)&&t.call(e,n[a],a,n)===r){return}}}}}};w.map=w.collect=function(n,t,r){var e=[];return null==n?e:p&&n.map===p?n.map(t,r):(A(n,function(n,u,i){e[e.length]=t.call(r,n,u,i)}),e)};var O="Reduce of empty array with no initial value";w.reduce=w.foldl=w.inject=function(n,t,r,e){var u=arguments.length>2;if(null==n&&(n=[]),v&&n.reduce===v){return e&&(t=w.bind(t,e)),u?n.reduce(t,r):n.reduce(t)}if(A(n,function(n,i,a){u?r=t.call(e,r,n,i,a):(r=n,u=!0)}),!u){throw new TypeError(O)}return r},w.reduceRight=w.foldr=function(n,t,r,e){var u=arguments.length>2;if(null==n&&(n=[]),h&&n.reduceRight===h){return e&&(t=w.bind(t,e)),u?n.reduceRight(t,r):n.reduceRight(t)}var i=n.length;if(i!==+i){var a=w.keys(n);i=a.length}if(A(n,function(o,c,l){c=a?a[--i]:--i,u?r=t.call(e,r,n[c],c,l):(r=n[c],u=!0)}),!u){throw new TypeError(O)}return r},w.find=w.detect=function(n,t,r){var e;return E(n,function(n,u,i){return t.call(r,n,u,i)?(e=n,!0):void 0}),e},w.filter=w.select=function(n,t,r){var e=[];return null==n?e:g&&n.filter===g?n.filter(t,r):(A(n,function(n,u,i){t.call(r,n,u,i)&&(e[e.length]=n)}),e)},w.reject=function(n,t,r){return w.filter(n,function(n,e,u){return !t.call(r,n,e,u)},r)},w.every=w.all=function(n,t,e){t||(t=w.identity);var u=!0;return null==n?u:d&&n.every===d?n.every(t,e):(A(n,function(n,i,a){return(u=u&&t.call(e,n,i,a))?void 0:r}),!!u)};var E=w.some=w.any=function(n,t,e){t||(t=w.identity);var u=!1;return null==n?u:m&&n.some===m?n.some(t,e):(A(n,function(n,i,a){return u||(u=t.call(e,n,i,a))?r:void 0}),!!u)};w.contains=w.include=function(n,t){return null==n?!1:y&&n.indexOf===y?-1!=n.indexOf(t):E(n,function(n){return n===t})},w.invoke=function(n,t){var r=o.call(arguments,2);return w.map(n,function(n){return(w.isFunction(t)?t:n[t]).apply(n,r)})},w.pluck=function(n,t){return w.map(n,function(n){return n[t]})},w.where=function(n,t){return w.isEmpty(t)?[]:w.filter(n,function(n){for(var r in t){if(t[r]!==n[r]){return !1}}return !0})},w.max=function(n,t,r){if(!t&&w.isArray(n)&&n[0]===+n[0]&&65535>n.length){return Math.max.apply(Math,n)}if(!t&&w.isEmpty(n)){return -1/0}var e={computed:-1/0,value:-1/0};return A(n,function(n,u,i){var a=t?t.call(r,n,u,i):n;a>=e.computed&&(e={value:n,computed:a})}),e.value},w.min=function(n,t,r){if(!t&&w.isArray(n)&&n[0]===+n[0]&&65535>n.length){return Math.min.apply(Math,n)}if(!t&&w.isEmpty(n)){return 1/0}var e={computed:1/0,value:1/0};return A(n,function(n,u,i){var a=t?t.call(r,n,u,i):n;e.computed>a&&(e={value:n,computed:a})}),e.value},w.shuffle=function(n){var t,r=0,e=[];return A(n,function(n){t=w.random(r++),e[r-1]=e[t],e[t]=n}),e};var F=function(n){return w.isFunction(n)?n:function(t){return t[n]}};w.sortBy=function(n,t,r){var e=F(t);return w.pluck(w.map(n,function(n,t,u){return{value:n,index:t,criteria:e.call(r,n,t,u)}}).sort(function(n,t){var r=n.criteria,e=t.criteria;if(r!==e){if(r>e||void 0===r){return 1}if(e>r||void 0===e){return -1}}return n.index<t.index?-1:1}),"value")};var k=function(n,t,r,e){var u={},i=F(t||w.identity);return A(n,function(t,a){var o=i.call(r,t,a,n);e(u,o,t)}),u};w.groupBy=function(n,t,r){return k(n,t,r,function(n,t,r){(w.has(n,t)?n[t]:n[t]=[]).push(r)})},w.countBy=function(n,t,r){return k(n,t,r,function(n,t){w.has(n,t)||(n[t]=0),n[t]++})},w.sortedIndex=function(n,t,r,e){r=null==r?w.identity:F(r);for(var u=r.call(e,t),i=0,a=n.length;a>i;){var o=i+a>>>1;u>r.call(e,n[o])?i=o+1:a=o}return i},w.toArray=function(n){return n?w.isArray(n)?o.call(n):n.length===+n.length?w.map(n,w.identity):w.values(n):[]},w.size=function(n){return null==n?0:n.length===+n.length?n.length:w.keys(n).length},w.first=w.head=w.take=function(n,t,r){return null==n?void 0:null==t||r?n[0]:o.call(n,0,t)},w.initial=function(n,t,r){return o.call(n,0,n.length-(null==t||r?1:t))},w.last=function(n,t,r){return null==n?void 0:null==t||r?n[n.length-1]:o.call(n,Math.max(n.length-t,0))},w.rest=w.tail=w.drop=function(n,t,r){return o.call(n,null==t||r?1:t)},w.compact=function(n){return w.filter(n,w.identity)};var R=function(n,t,r){return A(n,function(n){w.isArray(n)?t?a.apply(r,n):R(n,t,r):r.push(n)}),r};w.flatten=function(n,t){return R(n,t,[])},w.without=function(n){return w.difference(n,o.call(arguments,1))},w.uniq=w.unique=function(n,t,r,e){w.isFunction(t)&&(e=r,r=t,t=!1);var u=r?w.map(n,r,e):n,i=[],a=[];return A(u,function(r,e){(t?e&&a[a.length-1]===r:w.contains(a,r))||(a.push(r),i.push(n[e]))}),i},w.union=function(){return w.uniq(c.apply(e,arguments))},w.intersection=function(n){var t=o.call(arguments,1);return w.filter(w.uniq(n),function(n){return w.every(t,function(t){return w.indexOf(t,n)>=0})})},w.difference=function(n){var t=c.apply(e,o.call(arguments,1));return w.filter(n,function(n){return !w.contains(t,n)})},w.zip=function(){for(var n=o.call(arguments),t=w.max(w.pluck(n,"length")),r=Array(t),e=0;t>e;e++){r[e]=w.pluck(n,""+e)}return r},w.object=function(n,t){if(null==n){return{}}for(var r={},e=0,u=n.length;u>e;e++){t?r[n[e]]=t[e]:r[n[e][0]]=n[e][1]}return r},w.indexOf=function(n,t,r){if(null==n){return -1}var e=0,u=n.length;if(r){if("number"!=typeof r){return e=w.sortedIndex(n,t),n[e]===t?e:-1}e=0>r?Math.max(0,u+r):r}if(y&&n.indexOf===y){return n.indexOf(t,r)}for(;u>e;e++){if(n[e]===t){return e}}return -1},w.lastIndexOf=function(n,t,r){if(null==n){return -1}var e=null!=r;if(b&&n.lastIndexOf===b){return e?n.lastIndexOf(t,r):n.lastIndexOf(t)}for(var u=e?r:n.length;u--;){if(n[u]===t){return u}}return -1},w.range=function(n,t,r){1>=arguments.length&&(t=n||0,n=0),r=arguments[2]||1;for(var e=Math.max(Math.ceil((t-n)/r),0),u=0,i=Array(e);e>u;){i[u++]=n,n+=r}return i};var I=function(){};w.bind=function(n,t){var r,e;if(n.bind===j&&j){return j.apply(n,o.call(arguments,1))}if(!w.isFunction(n)){throw new TypeError}return r=o.call(arguments,2),e=function(){if(!(this instanceof e)){return n.apply(t,r.concat(o.call(arguments)))}I.prototype=n.prototype;var u=new I;I.prototype=null;var i=n.apply(u,r.concat(o.call(arguments)));return Object(i)===i?i:u}},w.bindAll=function(n){var t=o.call(arguments,1);return 0==t.length&&(t=w.functions(n)),A(t,function(t){n[t]=w.bind(n[t],n)}),n},w.memoize=function(n,t){var r={};return t||(t=w.identity),function(){var e=t.apply(this,arguments);return w.has(r,e)?r[e]:r[e]=n.apply(this,arguments)}},w.delay=function(n,t){var r=o.call(arguments,2);return setTimeout(function(){return n.apply(null,r)},t)},w.defer=function(n){return w.delay.apply(w,[n,1].concat(o.call(arguments,1)))},w.throttle=function(n,t){var r,e,u,i,a=0,o=function(){a=new Date,u=null,i=n.apply(r,e)};return function(){var c=new Date,l=t-(c-a);return r=this,e=arguments,0>=l?(clearTimeout(u),u=null,a=c,i=n.apply(r,e)):u||(u=setTimeout(o,l)),i}},w.debounce=function(n,t,r){var e,u;return function(){var i=this,a=arguments,o=function(){e=null,r||(u=n.apply(i,a))},c=r&&!e;return clearTimeout(e),e=setTimeout(o,t),c&&(u=n.apply(i,a)),u}},w.once=function(n){var t,r=!1;return function(){return r?t:(r=!0,t=n.apply(this,arguments),n=null,t)}},w.wrap=function(n,t){return function(){var r=[n];return a.apply(r,arguments),t.apply(this,r)}},w.compose=function(){var n=arguments;return function(){for(var t=arguments,r=n.length-1;r>=0;r--){t=[n[r].apply(this,t)]}return t[0]}},w.after=function(n,t){return 0>=n?t():function(){return 1>--n?t.apply(this,arguments):void 0}},w.keys=_||function(n){if(n!==Object(n)){throw new TypeError("Invalid object")}var t=[];for(var r in n){w.has(n,r)&&(t[t.length]=r)}return t},w.values=function(n){var t=[];for(var r in n){w.has(n,r)&&t.push(n[r])}return t},w.pairs=function(n){var t=[];for(var r in n){w.has(n,r)&&t.push([r,n[r]])}return t},w.invert=function(n){var t={};for(var r in n){w.has(n,r)&&(t[n[r]]=r)}return t},w.functions=w.methods=function(n){var t=[];for(var r in n){w.isFunction(n[r])&&t.push(r)}return t.sort()},w.extend=function(n){return A(o.call(arguments,1),function(t){if(t){for(var r in t){n[r]=t[r]}}}),n},w.pick=function(n){var t={},r=c.apply(e,o.call(arguments,1));return A(r,function(r){r in n&&(t[r]=n[r])}),t},w.omit=function(n){var t={},r=c.apply(e,o.call(arguments,1));for(var u in n){w.contains(r,u)||(t[u]=n[u])}return t},w.defaults=function(n){return A(o.call(arguments,1),function(t){if(t){for(var r in t){null==n[r]&&(n[r]=t[r])}}}),n},w.clone=function(n){return w.isObject(n)?w.isArray(n)?n.slice():w.extend({},n):n},w.tap=function(n,t){return t(n),n};var S=function(n,t,r,e){if(n===t){return 0!==n||1/n==1/t}if(null==n||null==t){return n===t}n instanceof w&&(n=n._wrapped),t instanceof w&&(t=t._wrapped);var u=l.call(n);if(u!=l.call(t)){return !1}switch(u){case"[object String]":return n==t+"";case"[object Number]":return n!=+n?t!=+t:0==n?1/n==1/t:n==+t;case"[object Date]":case"[object Boolean]":return +n==+t;case"[object RegExp]":return n.source==t.source&&n.global==t.global&&n.multiline==t.multiline&&n.ignoreCase==t.ignoreCase}if("object"!=typeof n||"object"!=typeof t){return !1}for(var i=r.length;i--;){if(r[i]==n){return e[i]==t}}r.push(n),e.push(t);var a=0,o=!0;if("[object Array]"==u){if(a=n.length,o=a==t.length){for(;a--&&(o=S(n[a],t[a],r,e));){}}}else{var c=n.constructor,f=t.constructor;if(c!==f&&!(w.isFunction(c)&&c instanceof c&&w.isFunction(f)&&f instanceof f)){return !1}for(var s in n){if(w.has(n,s)&&(a++,!(o=w.has(t,s)&&S(n[s],t[s],r,e)))){break}}if(o){for(s in t){if(w.has(t,s)&&!a--){break}}o=!a}}return r.pop(),e.pop(),o};w.isEqual=function(n,t){return S(n,t,[],[])},w.isEmpty=function(n){if(null==n){return !0}if(w.isArray(n)||w.isString(n)){return 0===n.length}for(var t in n){if(w.has(n,t)){return !1}}return !0},w.isElement=function(n){return !(!n||1!==n.nodeType)},w.isArray=x||function(n){return"[object Array]"==l.call(n)},w.isObject=function(n){return n===Object(n)},A(["Arguments","Function","String","Number","Date","RegExp"],function(n){w["is"+n]=function(t){return l.call(t)=="[object "+n+"]"}}),w.isArguments(arguments)||(w.isArguments=function(n){return !(!n||!w.has(n,"callee"))}),w.isFunction=function(n){return"function"==typeof n},w.isFinite=function(n){return isFinite(n)&&!isNaN(parseFloat(n))},w.isNaN=function(n){return w.isNumber(n)&&n!=+n},w.isBoolean=function(n){return n===!0||n===!1||"[object Boolean]"==l.call(n)},w.isNull=function(n){return null===n},w.isUndefined=function(n){return void 0===n},w.has=function(n,t){return f.call(n,t)},w.noConflict=function(){return n._=t,this},w.identity=function(n){return n},w.times=function(n,t,r){for(var e=Array(n),u=0;n>u;u++){e[u]=t.call(r,u)}return e},w.random=function(n,t){return null==t&&(t=n,n=0),n+(0|Math.random()*(t-n+1))};var T={escape:{"&":"&amp;","<":"&lt;",">":"&gt;",'"':"&quot;","'":"&#x27;","/":"&#x2F;"}};T.unescape=w.invert(T.escape);var M={escape:RegExp("["+w.keys(T.escape).join("")+"]","g"),unescape:RegExp("("+w.keys(T.unescape).join("|")+")","g")};w.each(["escape","unescape"],function(n){w[n]=function(t){return null==t?"":(""+t).replace(M[n],function(t){return T[n][t]})}}),w.result=function(n,t){if(null==n){return null}var r=n[t];return w.isFunction(r)?r.call(n):r},w.mixin=function(n){A(w.functions(n),function(t){var r=w[t]=n[t];w.prototype[t]=function(){var n=[this._wrapped];return a.apply(n,arguments),z.call(this,r.apply(w,n))}})};var N=0;w.uniqueId=function(n){var t=""+ ++N;return n?n+t:t},w.templateSettings={evaluate:/<%([\s\S]+?)%>/g,interpolate:/<%=([\s\S]+?)%>/g,escape:/<%-([\s\S]+?)%>/g};var q=/(.)^/,B={"'":"'","\\":"\\","\r":"r","\n":"n"," ":"t","\u2028":"u2028","\u2029":"u2029"},D=/\\|'|\r|\n|\t|\u2028|\u2029/g;w.template=function(n,t,r){r=w.defaults({},r,w.templateSettings);var e=RegExp([(r.escape||q).source,(r.interpolate||q).source,(r.evaluate||q).source].join("|")+"|$","g"),u=0,i="__p+='";n.replace(e,function(t,r,e,a,o){return i+=n.slice(u,o).replace(D,function(n){return"\\"+B[n]}),r&&(i+="'+\n((__t=("+r+"))==null?'':_.escape(__t))+\n'"),e&&(i+="'+\n((__t=("+e+"))==null?'':__t)+\n'"),a&&(i+="';\n"+a+"\n__p+='"),u=o+t.length,t}),i+="';\n",r.variable||(i="with(obj||{}){\n"+i+"}\n"),i="var __t,__p='',__j=Array.prototype.join,print=function(){__p+=__j.call(arguments,'');};\n"+i+"return __p;\n";try{var a=Function(r.variable||"obj","_",i)}catch(o){throw o.source=i,o}if(t){return a(t,w)}var c=function(n){return a.call(this,n,w)};return c.source="function("+(r.variable||"obj")+"){\n"+i+"}",c},w.chain=function(n){return w(n).chain()};var z=function(n){return this._chain?w(n).chain():n};w.mixin(w),A(["pop","push","reverse","shift","sort","splice","unshift"],function(n){var t=e[n];w.prototype[n]=function(){var r=this._wrapped;return t.apply(r,arguments),"shift"!=n&&"splice"!=n||0!==r.length||delete r[0],z.call(this,r)}}),A(["concat","join","slice"],function(n){var t=e[n];w.prototype[n]=function(){return z.call(this,t.apply(this._wrapped,arguments))}}),w.extend(w.prototype,{chain:function(){return this._chain=!0,this},value:function(){return this._wrapped}})}).call(environment);return environment._}function initializeBackbone(jQuery,underscore){var environment={jQuery:jQuery,_:underscore};var exports=undefined;(function(){var k=this,y=k.Backbone,h=[],z=h.push,r=h.slice,A=h.splice,g;g="undefined"!==typeof exports?exports:k.Backbone={};g.VERSION="0.9.9";var e=k._;!e&&"undefined"!==typeof require&&(e=require("underscore"));g.$=k.jQuery||k.Zepto||k.ender;g.noConflict=function(){k.Backbone=y;return this};g.emulateHTTP=!1;g.emulateJSON=!1;var s=/\s+/,n=function(a,b,c,d){if(!c){return !0}if("object"===typeof c){for(var f in c){a[b].apply(a,[f,c[f]].concat(d))}}else{if(s.test(c)){c=c.split(s);f=0;for(var e=c.length;f<e;f++){a[b].apply(a,[c[f]].concat(d))}}else{return !0}}},t=function(a,b,c){var d,a=-1,f=b.length;switch(c.length){case 0:for(;++a<f;){(d=b[a]).callback.call(d.ctx)}break;case 1:for(;++a<f;){(d=b[a]).callback.call(d.ctx,c[0])}break;case 2:for(;++a<f;){(d=b[a]).callback.call(d.ctx,c[0],c[1])}break;case 3:for(;++a<f;){(d=b[a]).callback.call(d.ctx,c[0],c[1],c[2])}break;default:for(;++a<f;){(d=b[a]).callback.apply(d.ctx,c)}}},h=g.Events={on:function(a,b,c){if(!n(this,"on",a,[b,c])||!b){return this}this._events||(this._events={});(this._events[a]||(this._events[a]=[])).push({callback:b,context:c,ctx:c||this});return this},once:function(a,b,c){if(!n(this,"once",a,[b,c])||!b){return this}var d=this,f=e.once(function(){d.off(a,f);b.apply(this,arguments)});f._callback=b;this.on(a,f,c);return this},off:function(a,b,c){var d,f,l,g,i,m,h,j;if(!this._events||!n(this,"off",a,[b,c])){return this}if(!a&&!b&&!c){return this._events={},this}g=a?[a]:e.keys(this._events);i=0;for(m=g.length;i<m;i++){if(a=g[i],d=this._events[a]){l=[];if(b||c){h=0;for(j=d.length;h<j;h++){f=d[h],(b&&b!==(f.callback._callback||f.callback)||c&&c!==f.context)&&l.push(f)}}this._events[a]=l}}return this},trigger:function(a){if(!this._events){return this}var b=r.call(arguments,1);if(!n(this,"trigger",a,b)){return this}var c=this._events[a],d=this._events.all;c&&t(this,c,b);d&&t(this,d,arguments);return this},listenTo:function(a,b,c){var d=this._listeners||(this._listeners={}),f=a._listenerId||(a._listenerId=e.uniqueId("l"));d[f]=a;a.on(b,c||this,this);return this},stopListening:function(a,b,c){var d=this._listeners;if(d){if(a){a.off(b,c,this),!b&&!c&&delete d[a._listenerId]}else{for(var f in d){d[f].off(null,null,this)}this._listeners={}}return this}}};h.bind=h.on;h.unbind=h.off;e.extend(g,h);var o=g.Model=function(a,b){var c,d=a||{};this.cid=e.uniqueId("c");this.changed={};this.attributes={};this._changes=[];b&&b.collection&&(this.collection=b.collection);b&&b.parse&&(d=this.parse(d));(c=e.result(this,"defaults"))&&e.defaults(d,c);this.set(d,{silent:!0});this._currentAttributes=e.clone(this.attributes);this._previousAttributes=e.clone(this.attributes);this.initialize.apply(this,arguments)};e.extend(o.prototype,h,{changed:null,idAttribute:"id",initialize:function(){},toJSON:function(){return e.clone(this.attributes)},sync:function(){return g.sync.apply(this,arguments)},get:function(a){return this.attributes[a]},escape:function(a){return e.escape(this.get(a))},has:function(a){return null!=this.get(a)},set:function(a,b,c){var d,f;if(null==a){return this}e.isObject(a)?(f=a,c=b):(f={})[a]=b;var a=c&&c.silent,l=c&&c.unset;if(!this._validate(f,c)){return !1}this.idAttribute in f&&(this.id=f[this.idAttribute]);var g=this.attributes;for(d in f){b=f[d],l?delete g[d]:g[d]=b,this._changes.push(d,b)}this._hasComputed=!1;a||this.change(c);return this},unset:function(a,b){return this.set(a,void 0,e.extend({},b,{unset:!0}))},clear:function(a){var b={},c;for(c in this.attributes){b[c]=void 0}return this.set(b,e.extend({},a,{unset:!0}))},fetch:function(a){a=a?e.clone(a):{};void 0===a.parse&&(a.parse=!0);var b=this,c=a.success;a.success=function(d){if(!b.set(b.parse(d),a)){return false}c&&c(b,d,a)};return this.sync("read",this,a)},save:function(a,b,c){var d,f,g;null==a||e.isObject(a)?(d=a,c=b):null!=a&&((d={})[a]=b);c=c?e.clone(c):{};if(c.wait){if(d&&!this._validate(d,c)){return !1}f=e.clone(this.attributes)}a=e.extend({},c,{silent:!0});if(d&&!this.set(d,c.wait?a:c)||!d&&!this._validate(null,c)){return !1}var q=this,i=c.success;c.success=function(a){g=true;var b=q.parse(a);c.wait&&(b=e.extend(d||{},b));if(!q.set(b,c)){return false}i&&i(q,a,c)};b=this.isNew()?"create":c.patch?"patch":"update";"patch"==b&&(c.attrs=d);b=this.sync(b,this,c);!g&&c.wait&&(this.clear(a),this.set(f,a));return b},destroy:function(a){var a=a?e.clone(a):{},b=this,c=a.success,d=function(){b.trigger("destroy",b,b.collection,a)};a.success=function(f){(a.wait||b.isNew())&&d();c&&c(b,f,a)};if(this.isNew()){return a.success(),!1}var f=this.sync("delete",this,a);a.wait||d();return f},url:function(){var a=e.result(this,"urlRoot")||e.result(this.collection,"url")||u();return this.isNew()?a:a+("/"===a.charAt(a.length-1)?"":"/")+encodeURIComponent(this.id)},parse:function(a){return a},clone:function(){return new this.constructor(this.attributes)},isNew:function(){return null==this.id},change:function(a){var b=this._changing;this._changing=!0;var c=this._computeChanges(!0);this._pending=!!c.length;for(var d=c.length-2;0<=d;d-=2){this.trigger("change:"+c[d],this,c[d+1],a)}if(b){return this}for(;this._pending;){this._pending=!1,this.trigger("change",this,a),this._previousAttributes=e.clone(this.attributes)}this._changing=!1;return this},hasChanged:function(a){this._hasComputed||this._computeChanges();return null==a?!e.isEmpty(this.changed):e.has(this.changed,a)},changedAttributes:function(a){if(!a){return this.hasChanged()?e.clone(this.changed):!1}var b,c=!1,d=this._previousAttributes,f;for(f in a){if(!e.isEqual(d[f],b=a[f])){(c||(c={}))[f]=b}}return c},_computeChanges:function(a){this.changed={};for(var b={},c=[],d=this._currentAttributes,f=this._changes,e=f.length-2;0<=e;e-=2){var g=f[e],i=f[e+1];b[g]||(b[g]=!0,d[g]!==i&&(this.changed[g]=i,a&&(c.push(g,i),d[g]=i)))}a&&(this._changes=[]);this._hasComputed=!0;return c},previous:function(a){return null==a||!this._previousAttributes?null:this._previousAttributes[a]},previousAttributes:function(){return e.clone(this._previousAttributes)},_validate:function(a,b){if(!this.validate){return !0}var a=e.extend({},this.attributes,a),c=this.validate(a,b);if(!c){return !0}b&&b.error&&b.error(this,c,b);this.trigger("error",this,c,b);return !1}});var p=g.Collection=function(a,b){b||(b={});b.model&&(this.model=b.model);void 0!==b.comparator&&(this.comparator=b.comparator);this._reset();this.initialize.apply(this,arguments);a&&this.reset(a,e.extend({silent:!0},b))};e.extend(p.prototype,h,{model:o,initialize:function(){},toJSON:function(a){return this.map(function(b){return b.toJSON(a)})},sync:function(){return g.sync.apply(this,arguments)},add:function(a,b){var c,d,f,g,h=b&&b.at,i=null==(b&&b.sort)?!0:b.sort,a=e.isArray(a)?a.slice():[a];for(c=a.length-1;0<=c;c--){(d=this._prepareModel(a[c],b))?(a[c]=d,(f=null!=d.id&&this._byId[d.id])||this._byCid[d.cid]?(b&&(b.merge&&f)&&(f.set(d.attributes,b),g=i),a.splice(c,1)):(d.on("all",this._onModelEvent,this),this._byCid[d.cid]=d,null!=d.id&&(this._byId[d.id]=d))):(this.trigger("error",this,a[c],b),a.splice(c,1))}a.length&&(g=i);this.length+=a.length;c=[null!=h?h:this.models.length,0];z.apply(c,a);A.apply(this.models,c);g&&(this.comparator&&null==h)&&this.sort({silent:!0});if(b&&b.silent){return this}for(;d=a.shift();){d.trigger("add",d,this,b)}return this},remove:function(a,b){var c,d,f,g;b||(b={});a=e.isArray(a)?a.slice():[a];c=0;for(d=a.length;c<d;c++){if(g=this.get(a[c])){delete this._byId[g.id],delete this._byCid[g.cid],f=this.indexOf(g),this.models.splice(f,1),this.length--,b.silent||(b.index=f,g.trigger("remove",g,this,b)),this._removeReference(g)}}return this},push:function(a,b){a=this._prepareModel(a,b);this.add(a,e.extend({at:this.length},b));return a},pop:function(a){var b=this.at(this.length-1);this.remove(b,a);return b},unshift:function(a,b){a=this._prepareModel(a,b);this.add(a,e.extend({at:0},b));return a},shift:function(a){var b=this.at(0);this.remove(b,a);return b},slice:function(a,b){return this.models.slice(a,b)},get:function(a){return null==a?void 0:this._byId[null!=a.id?a.id:a]||this._byCid[a.cid||a]},at:function(a){return this.models[a]},where:function(a){return e.isEmpty(a)?[]:this.filter(function(b){for(var c in a){if(a[c]!==b.get(c)){return !1}}return !0})},sort:function(a){if(!this.comparator){throw Error("Cannot sort a set without a comparator")}e.isString(this.comparator)||1===this.comparator.length?this.models=this.sortBy(this.comparator,this):this.models.sort(e.bind(this.comparator,this));(!a||!a.silent)&&this.trigger("sort",this,a);return this},pluck:function(a){return e.invoke(this.models,"get",a)},update:function(a,b){var c,d,f,g,h=[],i=[],m={},j=this.model.prototype.idAttribute,b=e.extend({add:!0,merge:!0,remove:!0},b);b.parse&&(a=this.parse(a));e.isArray(a)||(a=a?[a]:[]);if(b.add&&!b.remove){return this.add(a,b)}d=0;for(f=a.length;d<f;d++){c=a[d],g=this.get(c.id||c.cid||c[j]),b.remove&&g&&(m[g.cid]=!0),(b.add&&!g||b.merge&&g)&&h.push(c)}if(b.remove){d=0;for(f=this.models.length;d<f;d++){c=this.models[d],m[c.cid]||i.push(c)}}i.length&&this.remove(i,b);h.length&&this.add(h,b);return this},reset:function(a,b){b||(b={});b.parse&&(a=this.parse(a));for(var c=0,d=this.models.length;c<d;c++){this._removeReference(this.models[c])}b.previousModels=this.models;this._reset();a&&this.add(a,e.extend({silent:!0},b));b.silent||this.trigger("reset",this,b);return this},fetch:function(a){a=a?e.clone(a):{};void 0===a.parse&&(a.parse=!0);var b=this,c=a.success;a.success=function(d){b[a.update?"update":"reset"](d,a);c&&c(b,d,a)};return this.sync("read",this,a)},create:function(a,b){var c=this,b=b?e.clone(b):{},a=this._prepareModel(a,b);if(!a){return !1}b.wait||c.add(a,b);var d=b.success;b.success=function(a,b,e){e.wait&&c.add(a,e);d&&d(a,b,e)};a.save(null,b);return a},parse:function(a){return a},clone:function(){return new this.constructor(this.models)},chain:function(){return e(this.models).chain()},_reset:function(){this.length=0;this.models=[];this._byId={};this._byCid={}},_prepareModel:function(a,b){if(a instanceof o){return a.collection||(a.collection=this),a}b||(b={});b.collection=this;var c=new this.model(a,b);return !c._validate(a,b)?!1:c},_removeReference:function(a){this===a.collection&&delete a.collection;a.off("all",this._onModelEvent,this)},_onModelEvent:function(a,b,c,d){("add"===a||"remove"===a)&&c!==this||("destroy"===a&&this.remove(b,d),b&&a==="change:"+b.idAttribute&&(delete this._byId[b.previous(b.idAttribute)],null!=b.id&&(this._byId[b.id]=b)),this.trigger.apply(this,arguments))}});e.each("forEach each map collect reduce foldl inject reduceRight foldr find detect filter select reject every all some any include contains invoke max min sortedIndex toArray size first head take initial rest tail last without indexOf shuffle lastIndexOf isEmpty".split(" "),function(a){p.prototype[a]=function(){var b=r.call(arguments);b.unshift(this.models);return e[a].apply(e,b)}});e.each(["groupBy","countBy","sortBy"],function(a){p.prototype[a]=function(b,c){var d=e.isFunction(b)?b:function(a){return a.get(b)};return e[a](this.models,d,c)}});var v=g.Router=function(a){a||(a={});a.routes&&(this.routes=a.routes);this._bindRoutes();this.initialize.apply(this,arguments)},B=/\((.*?)\)/g,C=/:\w+/g,D=/\*\w+/g,E=/[\-{}\[\]+?.,\\\^$|#\s]/g;e.extend(v.prototype,h,{initialize:function(){},route:function(a,b,c){e.isRegExp(a)||(a=this._routeToRegExp(a));c||(c=this[b]);g.history.route(a,e.bind(function(d){d=this._extractParameters(a,d);c&&c.apply(this,d);this.trigger.apply(this,["route:"+b].concat(d));g.history.trigger("route",this,b,d)},this));return this},navigate:function(a,b){g.history.navigate(a,b);return this},_bindRoutes:function(){if(this.routes){for(var a,b=e.keys(this.routes);null!=(a=b.pop());){this.route(a,this.routes[a])}}},_routeToRegExp:function(a){a=a.replace(E,"\\$&").replace(B,"(?:$1)?").replace(C,"([^/]+)").replace(D,"(.*?)");return RegExp("^"+a+"$")},_extractParameters:function(a,b){return a.exec(b).slice(1)}});var j=g.History=function(){this.handlers=[];e.bindAll(this,"checkUrl");"undefined"!==typeof window&&(this.location=window.location,this.history=window.history)},w=/^[#\/]|\s+$/g,F=/^\/+|\/+$/g,G=/msie [\w.]+/,H=/\/$/;j.started=!1;e.extend(j.prototype,h,{interval:50,getHash:function(a){return(a=(a||this).location.href.match(/#(.*)$/))?a[1]:""},getFragment:function(a,b){if(null==a){if(this._hasPushState||!this._wantsHashChange||b){var a=this.location.pathname,c=this.root.replace(H,"");a.indexOf(c)||(a=a.substr(c.length))}else{a=this.getHash()}}return a.replace(w,"")},start:function(a){if(j.started){throw Error("Backbone.history has already been started")}j.started=!0;this.options=e.extend({},{root:"/"},this.options,a);this.root=this.options.root;this._wantsHashChange=!1!==this.options.hashChange;this._wantsPushState=!!this.options.pushState;this._hasPushState=!(!this.options.pushState||!this.history||!this.history.pushState);var a=this.getFragment(),b=document.documentMode,b=G.exec(navigator.userAgent.toLowerCase())&&(!b||7>=b);this.root=("/"+this.root+"/").replace(F,"/");b&&this._wantsHashChange&&(this.iframe=g.$('<iframe src="javascript:0" tabindex="-1" />').hide().appendTo("body")[0].contentWindow,this.navigate(a));this._hasPushState?g.$(window).bind("popstate",this.checkUrl):this._wantsHashChange&&"onhashchange" in window&&!b?g.$(window).bind("hashchange",this.checkUrl):this._wantsHashChange&&(this._checkUrlInterval=setInterval(this.checkUrl,this.interval));this.fragment=a;a=this.location;b=a.pathname.replace(/[^\/]$/,"$&/")===this.root;if(this._wantsHashChange&&this._wantsPushState&&!this._hasPushState&&!b){return this.fragment=this.getFragment(null,!0),this.location.replace(this.root+this.location.search+"#"+this.fragment),!0}this._wantsPushState&&(this._hasPushState&&b&&a.hash)&&(this.fragment=this.getHash().replace(w,""),this.history.replaceState({},document.title,this.root+this.fragment+a.search));if(!this.options.silent){return this.loadUrl()}},stop:function(){g.$(window).unbind("popstate",this.checkUrl).unbind("hashchange",this.checkUrl);clearInterval(this._checkUrlInterval);j.started=!1},route:function(a,b){this.handlers.unshift({route:a,callback:b})},checkUrl:function(){var a=this.getFragment();a===this.fragment&&this.iframe&&(a=this.getFragment(this.getHash(this.iframe)));if(a===this.fragment){return !1}this.iframe&&this.navigate(a);this.loadUrl()||this.loadUrl(this.getHash())},loadUrl:function(a){var b=this.fragment=this.getFragment(a);return e.any(this.handlers,function(a){if(a.route.test(b)){return a.callback(b),!0}})},navigate:function(a,b){if(!j.started){return !1}if(!b||!0===b){b={trigger:b}}a=this.getFragment(a||"");if(this.fragment!==a){this.fragment=a;var c=this.root+a;if(this._hasPushState){this.history[b.replace?"replaceState":"pushState"]({},document.title,c)}else{if(this._wantsHashChange){this._updateHash(this.location,a,b.replace),this.iframe&&a!==this.getFragment(this.getHash(this.iframe))&&(b.replace||this.iframe.document.open().close(),this._updateHash(this.iframe.location,a,b.replace))}else{return this.location.assign(c)}}b.trigger&&this.loadUrl(a)}},_updateHash:function(a,b,c){c?(c=a.href.replace(/(javascript:|#).*$/,""),a.replace(c+"#"+b)):a.hash="#"+b}});g.history=new j;var x=g.View=function(a){this.cid=e.uniqueId("view");this._configure(a||{});this._ensureElement();this.initialize.apply(this,arguments);this.delegateEvents()},I=/^(\S+)\s*(.*)$/,J="model collection el id attributes className tagName events".split(" ");e.extend(x.prototype,h,{tagName:"div",$:function(a){return this.$el.find(a)},initialize:function(){},render:function(){return this},remove:function(){this.$el.remove();this.stopListening();return this},make:function(a,b,c){a=document.createElement(a);b&&g.$(a).attr(b);null!=c&&g.$(a).html(c);return a},setElement:function(a,b){this.$el&&this.undelegateEvents();this.$el=a instanceof g.$?a:g.$(a);this.el=this.$el[0];!1!==b&&this.delegateEvents();return this},delegateEvents:function(a){if(a||(a=e.result(this,"events"))){this.undelegateEvents();for(var b in a){var c=a[b];e.isFunction(c)||(c=this[a[b]]);if(!c){throw Error('Method "'+a[b]+'" does not exist')}var d=b.match(I),f=d[1],d=d[2],c=e.bind(c,this),f=f+(".delegateEvents"+this.cid);""===d?this.$el.bind(f,c):this.$el.delegate(d,f,c)}}},undelegateEvents:function(){this.$el.unbind(".delegateEvents"+this.cid)},_configure:function(a){this.options&&(a=e.extend({},e.result(this,"options"),a));e.extend(this,e.pick(a,J));this.options=a},_ensureElement:function(){if(this.el){this.setElement(e.result(this,"el"),!1)}else{var a=e.extend({},e.result(this,"attributes"));this.id&&(a.id=e.result(this,"id"));this.className&&(a["class"]=e.result(this,"className"));this.setElement(this.make(e.result(this,"tagName"),a),!1)}}});var K={create:"POST",update:"PUT",patch:"PATCH","delete":"DELETE",read:"GET"};g.sync=function(a,b,c){var d=K[a];e.defaults(c||(c={}),{emulateHTTP:g.emulateHTTP,emulateJSON:g.emulateJSON});var f={type:d,dataType:"json"};c.url||(f.url=e.result(b,"url")||u());if(null==c.data&&b&&("create"===a||"update"===a||"patch"===a)){f.contentType="application/json",f.data=JSON.stringify(c.attrs||b.toJSON(c))}c.emulateJSON&&(f.contentType="application/x-www-form-urlencoded",f.data=f.data?{model:f.data}:{});if(c.emulateHTTP&&("PUT"===d||"DELETE"===d||"PATCH"===d)){f.type="POST";c.emulateJSON&&(f.data._method=d);var h=c.beforeSend;c.beforeSend=function(a){a.setRequestHeader("X-HTTP-Method-Override",d);if(h){return h.apply(this,arguments)}}}"GET"!==f.type&&!c.emulateJSON&&(f.processData=!1);var j=c.success;c.success=function(a,d,e){j&&j(a,d,e);b.trigger("sync",b,a,c)};var i=c.error;c.error=function(a){i&&i(b,a,c);b.trigger("error",b,a,c)};a=g.ajax(e.extend(f,c));b.trigger("request",b,a,c);return a};g.ajax=function(){return g.$.ajax.apply(g.$,arguments)};o.extend=p.extend=v.extend=x.extend=j.extend=function(a,b){var c=this,d;d=a&&e.has(a,"constructor")?a.constructor:function(){c.apply(this,arguments)};e.extend(d,c,b);var f=function(){this.constructor=d};f.prototype=c.prototype;d.prototype=new f;a&&e.extend(d.prototype,a);d.__super__=c.prototype;return d};var u=function(){throw Error('A "url" property or function must be specified')}}).call(environment);return environment.Backbone}function initializeEasyXDM(){(function(N,d,p,K,k,H){var b=this;var n=Math.floor(Math.random()*10000);var q=Function.prototype;var Q=/^((http.?:)\/\/([^:\/\s]+)(:\d+)*)/;var R=/[\-\w]+\/\.\.\//;var F=/([^:])\/\//g;var I="";var o={};var M=N.easyXDM;var U="easyXDM_";var E;var y=false;var i;var h;function C(X,Z){var Y=typeof X[Z];return Y=="function"||(!!(Y=="object"&&X[Z]))||Y=="unknown"}function u(X,Y){return !!(typeof(X[Y])=="object"&&X[Y])}function r(X){return Object.prototype.toString.call(X)==="[object Array]"}function c(){var Z="Shockwave Flash",ad="application/x-shockwave-flash";if(!t(navigator.plugins)&&typeof navigator.plugins[Z]=="object"){var ab=navigator.plugins[Z].description;if(ab&&!t(navigator.mimeTypes)&&navigator.mimeTypes[ad]&&navigator.mimeTypes[ad].enabledPlugin){i=ab.match(/\d+/g)}}if(!i){var Y;try{Y=new ActiveXObject("ShockwaveFlash.ShockwaveFlash");i=Array.prototype.slice.call(Y.GetVariable("$version").match(/(\d+),(\d+),(\d+),(\d+)/),1);Y=null}catch(ac){}}if(!i){return false}var X=parseInt(i[0],10),aa=parseInt(i[1],10);h=X>9&&aa>0;return true}var v,x;if(C(N,"addEventListener")){v=function(Z,X,Y){Z.addEventListener(X,Y,false)};x=function(Z,X,Y){Z.removeEventListener(X,Y,false)}}else{if(C(N,"attachEvent")){v=function(X,Z,Y){X.attachEvent("on"+Z,Y)};x=function(X,Z,Y){X.detachEvent("on"+Z,Y)}}else{throw new Error("Browser not supported")}}var W=false,J=[],L;if("readyState" in d){L=d.readyState;W=L=="complete"||(~navigator.userAgent.indexOf("AppleWebKit/")&&(L=="loaded"||L=="interactive"))}else{W=!!d.body}function s(){if(W){return}W=true;for(var X=0;X<J.length;X++){J[X]()}J.length=0}if(!W){if(C(N,"addEventListener")){v(d,"DOMContentLoaded",s)}else{v(d,"readystatechange",function(){if(d.readyState=="complete"){s()}});if(d.documentElement.doScroll&&N===top){var g=function(){if(W){return}try{d.documentElement.doScroll("left")}catch(X){K(g,1);return}s()};g()}}v(N,"load",s)}function G(Y,X){if(W){Y.call(X);return}J.push(function(){Y.call(X)})}function m(){var Z=parent;if(I!==""){for(var X=0,Y=I.split(".");X<Y.length;X++){Z=Z[Y[X]]}}return Z.easyXDM}function e(X){N.easyXDM=M;I=X;if(I){U="easyXDM_"+I.replace(".","_")+"_"}return o}function z(X){return X.match(Q)[3]}function f(X){return X.match(Q)[4]||""}function j(Z){var X=Z.toLowerCase().match(Q);var aa=X[2],ab=X[3],Y=X[4]||"";if((aa=="http:"&&Y==":80")||(aa=="https:"&&Y==":443")){Y=""}return aa+"//"+ab+Y}function B(X){X=X.replace(F,"$1/");if(!X.match(/^(http||https):\/\//)){var Y=(X.substring(0,1)==="/")?"":p.pathname;if(Y.substring(Y.length-1)!=="/"){Y=Y.substring(0,Y.lastIndexOf("/")+1)}X=p.protocol+"//"+p.host+Y+X}while(R.test(X)){X=X.replace(R,"")}return X}function P(X,aa){var ac="",Z=X.indexOf("#");if(Z!==-1){ac=X.substring(Z);X=X.substring(0,Z)}var ab=[];for(var Y in aa){if(aa.hasOwnProperty(Y)){ab.push(Y+"="+H(aa[Y]))}}return X+(y?"#":(X.indexOf("?")==-1?"?":"&"))+ab.join("&")+ac}var S=(function(X){X=X.substring(1).split("&");var Z={},aa,Y=X.length;while(Y--){aa=X[Y].split("=");Z[aa[0]]=k(aa[1])}return Z}(/xdm_e=/.test(p.search)?p.search:p.hash));function t(X){return typeof X==="undefined"}var O=function(){var Y={};var Z={a:[1,2,3]},X='{"a":[1,2,3]}';if(typeof JSON!="undefined"&&typeof JSON.stringify==="function"&&JSON.stringify(Z).replace((/\s/g),"")===X){return JSON}if(Object.toJSON){if(Object.toJSON(Z).replace((/\s/g),"")===X){Y.stringify=Object.toJSON}}if(typeof String.prototype.evalJSON==="function"){Z=X.evalJSON();if(Z.a&&Z.a.length===3&&Z.a[2]===3){Y.parse=function(aa){return aa.evalJSON()}}}if(Y.stringify&&Y.parse){O=function(){return Y};return Y}return null};function T(X,Y,Z){var ab;for(var aa in Y){if(Y.hasOwnProperty(aa)){if(aa in X){ab=Y[aa];if(typeof ab==="object"){T(X[aa],ab,Z)}else{if(!Z){X[aa]=Y[aa]}}}else{X[aa]=Y[aa]}}}return X}function a(){var Y=d.body.appendChild(d.createElement("form")),X=Y.appendChild(d.createElement("input"));X.name=U+"TEST"+n;E=X!==Y.elements[X.name];d.body.removeChild(Y)}function A(Y){if(t(E)){a()}var ac;if(E){ac=d.createElement('<iframe name="'+Y.props.name+'"/>')}else{ac=d.createElement("IFRAME");ac.name=Y.props.name}ac.id=ac.name=Y.props.name;delete Y.props.name;if(typeof Y.container=="string"){Y.container=d.getElementById(Y.container)}if(!Y.container){T(ac.style,{position:"absolute",top:"-2000px",left:"0px"});Y.container=d.body}var ab=Y.props.src;Y.props.src="javascript:false";T(ac,Y.props);ac.border=ac.frameBorder=0;ac.allowTransparency=true;Y.container.appendChild(ac);if(Y.onLoad){v(ac,"load",Y.onLoad)}if(Y.usePost){var aa=Y.container.appendChild(d.createElement("form")),X;aa.target=ac.name;aa.action=ab;aa.method="POST";if(typeof(Y.usePost)==="object"){for(var Z in Y.usePost){if(Y.usePost.hasOwnProperty(Z)){if(E){X=d.createElement('<input name="'+Z+'"/>')}else{X=d.createElement("INPUT");X.name=Z}X.value=Y.usePost[Z];aa.appendChild(X)}}}aa.submit();aa.parentNode.removeChild(aa)}else{ac.src=ab}Y.props.src=ab;return ac}function V(aa,Z){if(typeof aa=="string"){aa=[aa]}var Y,X=aa.length;while(X--){Y=aa[X];Y=new RegExp(Y.substr(0,1)=="^"?Y:("^"+Y.replace(/(\*)/g,".$1").replace(/\?/g,".")+"$"));if(Y.test(Z)){return true}}return false}function l(Z){var ae=Z.protocol,Y;Z.isHost=Z.isHost||t(S.xdm_p);y=Z.hash||false;if(!Z.props){Z.props={}}if(!Z.isHost){Z.channel=S.xdm_c.replace(/["'<>\\]/g,"");Z.secret=S.xdm_s;Z.remote=S.xdm_e.replace(/["'<>\\]/g,"");ae=S.xdm_p;if(Z.acl&&!V(Z.acl,Z.remote)){throw new Error("Access denied for "+Z.remote)}}else{Z.remote=B(Z.remote);Z.channel=Z.channel||"default"+n++;Z.secret=Math.random().toString(16).substring(2);if(t(ae)){if(j(p.href)==j(Z.remote)){ae="4"}else{if(C(N,"postMessage")||C(d,"postMessage")){ae="1"}else{if(Z.swf&&C(N,"ActiveXObject")&&c()){ae="6"}else{if(navigator.product==="Gecko"&&"frameElement" in N&&navigator.userAgent.indexOf("WebKit")==-1){ae="5"}else{if(Z.remoteHelper){ae="2"}else{ae="0"}}}}}}}Z.protocol=ae;switch(ae){case"0":T(Z,{interval:100,delay:2000,useResize:true,useParent:false,usePolling:false},true);if(Z.isHost){if(!Z.local){var ac=p.protocol+"//"+p.host,X=d.body.getElementsByTagName("img"),ad;var aa=X.length;while(aa--){ad=X[aa];if(ad.src.substring(0,ac.length)===ac){Z.local=ad.src;break}}if(!Z.local){Z.local=N}}var ab={xdm_c:Z.channel,xdm_p:0};if(Z.local===N){Z.usePolling=true;Z.useParent=true;Z.local=p.protocol+"//"+p.host+p.pathname+p.search;ab.xdm_e=Z.local;ab.xdm_pa=1}else{ab.xdm_e=B(Z.local)}if(Z.container){Z.useResize=false;ab.xdm_po=1}Z.remote=P(Z.remote,ab)}else{T(Z,{channel:S.xdm_c,remote:S.xdm_e,useParent:!t(S.xdm_pa),usePolling:!t(S.xdm_po),useResize:Z.useParent?false:Z.useResize})}Y=[new o.stack.HashTransport(Z),new o.stack.ReliableBehavior({}),new o.stack.QueueBehavior({encode:true,maxLength:4000-Z.remote.length}),new o.stack.VerifyBehavior({initiate:Z.isHost})];break;case"1":Y=[new o.stack.PostMessageTransport(Z)];break;case"2":Z.remoteHelper=B(Z.remoteHelper);Y=[new o.stack.NameTransport(Z),new o.stack.QueueBehavior(),new o.stack.VerifyBehavior({initiate:Z.isHost})];break;case"3":Y=[new o.stack.NixTransport(Z)];break;case"4":Y=[new o.stack.SameOriginTransport(Z)];break;case"5":Y=[new o.stack.FrameElementTransport(Z)];break;case"6":if(!i){c()}Y=[new o.stack.FlashTransport(Z)];break}Y.push(new o.stack.QueueBehavior({lazy:Z.lazy,remove:true}));return Y}function D(aa){var ab,Z={incoming:function(ad,ac){this.up.incoming(ad,ac)},outgoing:function(ac,ad){this.down.outgoing(ac,ad)},callback:function(ac){this.up.callback(ac)},init:function(){this.down.init()},destroy:function(){this.down.destroy()}};for(var Y=0,X=aa.length;Y<X;Y++){ab=aa[Y];T(ab,Z,true);if(Y!==0){ab.down=aa[Y-1]}if(Y!==X-1){ab.up=aa[Y+1]}}return ab}function w(X){X.up.down=X.down;X.down.up=X.up;X.up=X.down=null}T(o,{version:"2.4.17.1",query:S,stack:{},apply:T,getJSONObject:O,whenReady:G,noConflict:e});o.DomHelper={on:v,un:x,requiresJSON:function(X){if(!u(N,"JSON")){d.write('<script type="text/javascript" src="'+X+'"><\/script>')}}};(function(){var X={};o.Fn={set:function(Y,Z){X[Y]=Z},get:function(Z,Y){var aa=X[Z];if(Y){delete X[Z]}return aa}}}());o.Socket=function(Y){var X=D(l(Y).concat([{incoming:function(ab,aa){Y.onMessage(ab,aa)},callback:function(aa){if(Y.onReady){Y.onReady(aa)}}}])),Z=j(Y.remote);this.origin=j(Y.remote);this.destroy=function(){X.destroy()};this.postMessage=function(aa){X.outgoing(aa,Z)};X.init()};o.Rpc=function(Z,Y){if(Y.local){for(var ab in Y.local){if(Y.local.hasOwnProperty(ab)){var aa=Y.local[ab];if(typeof aa==="function"){Y.local[ab]={method:aa}}}}}var X=D(l(Z).concat([new o.stack.RpcBehavior(this,Y),{callback:function(ac){if(Z.onReady){Z.onReady(ac)}}}]));this.origin=j(Z.remote);this.destroy=function(){X.destroy()};X.init()};o.stack.SameOriginTransport=function(Y){var Z,ab,aa,X;return(Z={outgoing:function(ad,ae,ac){aa(ad);if(ac){ac()}},destroy:function(){if(ab){ab.parentNode.removeChild(ab);ab=null}},onDOMReady:function(){X=j(Y.remote);if(Y.isHost){T(Y.props,{src:P(Y.remote,{xdm_e:p.protocol+"//"+p.host+p.pathname,xdm_c:Y.channel,xdm_p:4}),name:U+Y.channel+"_provider"});ab=A(Y);o.Fn.set(Y.channel,function(ac){aa=ac;K(function(){Z.up.callback(true)},0);return function(ad){Z.up.incoming(ad,X)}})}else{aa=m().Fn.get(Y.channel,true)(function(ac){Z.up.incoming(ac,X)});K(function(){Z.up.callback(true)},0)}},init:function(){G(Z.onDOMReady,Z)}})};o.stack.FlashTransport=function(aa){var ac,X,ab,ad,Y,ae;function af(ah,ag){K(function(){ac.up.incoming(ah,ad)},0)}function Z(ah){var ag=aa.swf+"?host="+aa.isHost;var aj="easyXDM_swf_"+Math.floor(Math.random()*10000);o.Fn.set("flash_loaded"+ah.replace(/[\-.]/g,"_"),function(){o.stack.FlashTransport[ah].swf=Y=ae.firstChild;var ak=o.stack.FlashTransport[ah].queue;for(var al=0;al<ak.length;al++){ak[al]()}ak.length=0});if(aa.swfContainer){ae=(typeof aa.swfContainer=="string")?d.getElementById(aa.swfContainer):aa.swfContainer}else{ae=d.createElement("div");T(ae.style,h&&aa.swfNoThrottle?{height:"20px",width:"20px",position:"fixed",right:0,top:0}:{height:"1px",width:"1px",position:"absolute",overflow:"hidden",right:0,top:0});d.body.appendChild(ae)}var ai="callback=flash_loaded"+ah.replace(/[\-.]/g,"_")+"&proto="+b.location.protocol+"&domain="+z(b.location.href)+"&port="+f(b.location.href)+"&ns="+I;ae.innerHTML="<object height='20' width='20' type='application/x-shockwave-flash' id='"+aj+"' data='"+ag+"'><param name='allowScriptAccess' value='always'></param><param name='wmode' value='transparent'><param name='movie' value='"+ag+"'></param><param name='flashvars' value='"+ai+"'></param><embed type='application/x-shockwave-flash' FlashVars='"+ai+"' allowScriptAccess='always' wmode='transparent' src='"+ag+"' height='1' width='1'></embed></object>"}return(ac={outgoing:function(ah,ai,ag){Y.postMessage(aa.channel,ah.toString());if(ag){ag()}},destroy:function(){try{Y.destroyChannel(aa.channel)}catch(ag){}Y=null;if(X){X.parentNode.removeChild(X);X=null}},onDOMReady:function(){ad=aa.remote;o.Fn.set("flash_"+aa.channel+"_init",function(){K(function(){ac.up.callback(true)})});o.Fn.set("flash_"+aa.channel+"_onMessage",af);aa.swf=B(aa.swf);var ah=z(aa.swf);var ag=function(){o.stack.FlashTransport[ah].init=true;Y=o.stack.FlashTransport[ah].swf;Y.createChannel(aa.channel,aa.secret,j(aa.remote),aa.isHost);if(aa.isHost){if(h&&aa.swfNoThrottle){T(aa.props,{position:"fixed",right:0,top:0,height:"20px",width:"20px"})}T(aa.props,{src:P(aa.remote,{xdm_e:j(p.href),xdm_c:aa.channel,xdm_p:6,xdm_s:aa.secret}),name:U+aa.channel+"_provider"});X=A(aa)}};if(o.stack.FlashTransport[ah]&&o.stack.FlashTransport[ah].init){ag()}else{if(!o.stack.FlashTransport[ah]){o.stack.FlashTransport[ah]={queue:[ag]};Z(ah)}else{o.stack.FlashTransport[ah].queue.push(ag)}}},init:function(){G(ac.onDOMReady,ac)}})};o.stack.PostMessageTransport=function(aa){var ac,ad,Y,Z;function X(ae){if(ae.origin){return j(ae.origin)}if(ae.uri){return j(ae.uri)}if(ae.domain){return p.protocol+"//"+ae.domain}throw"Unable to retrieve the origin of the event"}function ab(af){var ae=X(af);if(ae==Z&&af.data.substring(0,aa.channel.length+1)==aa.channel+" "){ac.up.incoming(af.data.substring(aa.channel.length+1),ae)}}return(ac={outgoing:function(af,ag,ae){Y.postMessage(aa.channel+" "+af,ag||Z);if(ae){ae()}},destroy:function(){x(N,"message",ab);if(ad){Y=null;ad.parentNode.removeChild(ad);ad=null}},onDOMReady:function(){Z=j(aa.remote);if(aa.isHost){var ae=function(af){if(af.data==aa.channel+"-ready"){Y=("postMessage" in ad.contentWindow)?ad.contentWindow:ad.contentWindow.document;x(N,"message",ae);v(N,"message",ab);K(function(){ac.up.callback(true)},0)}};v(N,"message",ae);T(aa.props,{src:P(aa.remote,{xdm_e:j(p.href),xdm_c:aa.channel,xdm_p:1}),name:U+aa.channel+"_provider"});ad=A(aa)}else{v(N,"message",ab);Y=("postMessage" in N.parent)?N.parent:N.parent.document;Y.postMessage(aa.channel+"-ready",Z);K(function(){ac.up.callback(true)},0)}},init:function(){G(ac.onDOMReady,ac)}})};o.stack.FrameElementTransport=function(Y){var Z,ab,aa,X;return(Z={outgoing:function(ad,ae,ac){aa.call(this,ad);if(ac){ac()}},destroy:function(){if(ab){ab.parentNode.removeChild(ab);ab=null}},onDOMReady:function(){X=j(Y.remote);if(Y.isHost){T(Y.props,{src:P(Y.remote,{xdm_e:j(p.href),xdm_c:Y.channel,xdm_p:5}),name:U+Y.channel+"_provider"});ab=A(Y);ab.fn=function(ac){delete ab.fn;aa=ac;K(function(){Z.up.callback(true)},0);return function(ad){Z.up.incoming(ad,X)}}}else{if(d.referrer&&j(d.referrer)!=S.xdm_e){N.top.location=S.xdm_e}aa=N.frameElement.fn(function(ac){Z.up.incoming(ac,X)});Z.up.callback(true)}},init:function(){G(Z.onDOMReady,Z)}})};o.stack.NameTransport=function(ab){var ac;var ae,ai,aa,ag,ah,Y,X;function af(al){var ak=ab.remoteHelper+(ae?"#_3":"#_2")+ab.channel;ai.contentWindow.sendMessage(al,ak)}function ad(){if(ae){if(++ag===2||!ae){ac.up.callback(true)}}else{af("ready");ac.up.callback(true)}}function aj(ak){ac.up.incoming(ak,Y)}function Z(){if(ah){K(function(){ah(true)},0)}}return(ac={outgoing:function(al,am,ak){ah=ak;af(al)},destroy:function(){ai.parentNode.removeChild(ai);ai=null;if(ae){aa.parentNode.removeChild(aa);aa=null}},onDOMReady:function(){ae=ab.isHost;ag=0;Y=j(ab.remote);ab.local=B(ab.local);if(ae){o.Fn.set(ab.channel,function(al){if(ae&&al==="ready"){o.Fn.set(ab.channel,aj);ad()}});X=P(ab.remote,{xdm_e:ab.local,xdm_c:ab.channel,xdm_p:2});T(ab.props,{src:X+"#"+ab.channel,name:U+ab.channel+"_provider"});aa=A(ab)}else{ab.remoteHelper=ab.remote;o.Fn.set(ab.channel,aj)}var ak=function(){var al=ai||this;x(al,"load",ak);o.Fn.set(ab.channel+"_load",Z);(function am(){if(typeof al.contentWindow.sendMessage=="function"){ad()}else{K(am,50)}}())};ai=A({props:{src:ab.local+"#_4"+ab.channel},onLoad:ak})},init:function(){G(ac.onDOMReady,ac)}})};o.stack.HashTransport=function(Z){var ac;var ah=this,af,aa,X,ad,am,ab,al;var ag,Y;function ak(ao){if(!al){return}var an=Z.remote+"#"+(am++)+"_"+ao;((af||!ag)?al.contentWindow:al).location=an}function ae(an){ad=an;ac.up.incoming(ad.substring(ad.indexOf("_")+1),Y)}function aj(){if(!ab){return}var an=ab.location.href,ap="",ao=an.indexOf("#");if(ao!=-1){ap=an.substring(ao)}if(ap&&ap!=ad){ae(ap)}}function ai(){aa=setInterval(aj,X)}return(ac={outgoing:function(an,ao){ak(an)},destroy:function(){N.clearInterval(aa);if(af||!ag){al.parentNode.removeChild(al)}al=null},onDOMReady:function(){af=Z.isHost;X=Z.interval;ad="#"+Z.channel;am=0;ag=Z.useParent;Y=j(Z.remote);if(af){T(Z.props,{src:Z.remote,name:U+Z.channel+"_provider"});if(ag){Z.onLoad=function(){ab=N;ai();ac.up.callback(true)}}else{var ap=0,an=Z.delay/50;(function ao(){if(++ap>an){throw new Error("Unable to reference listenerwindow")}try{ab=al.contentWindow.frames[U+Z.channel+"_consumer"]}catch(aq){}if(ab){ai();ac.up.callback(true)}else{K(ao,50)}}())}al=A(Z)}else{ab=N;ai();if(ag){al=parent;ac.up.callback(true)}else{T(Z,{props:{src:Z.remote+"#"+Z.channel+new Date(),name:U+Z.channel+"_consumer"},onLoad:function(){ac.up.callback(true)}});al=A(Z)}}},init:function(){G(ac.onDOMReady,ac)}})};o.stack.ReliableBehavior=function(Y){var aa,ac;var ab=0,X=0,Z="";return(aa={incoming:function(af,ad){var ae=af.indexOf("_"),ag=af.substring(0,ae).split(",");af=af.substring(ae+1);if(ag[0]==ab){Z="";if(ac){ac(true);ac=null}}if(af.length>0){aa.down.outgoing(ag[1]+","+ab+"_"+Z,ad);if(X!=ag[1]){X=ag[1];aa.up.incoming(af,ad)}}},outgoing:function(af,ad,ae){Z=af;ac=ae;aa.down.outgoing(X+","+(++ab)+"_"+af,ad)}})};o.stack.QueueBehavior=function(Z){var ac,ad=[],ag=true,aa="",af,X=0,Y=false,ab=false;function ae(){if(Z.remove&&ad.length===0){w(ac);return}if(ag||ad.length===0||af){return}ag=true;var ah=ad.shift();ac.down.outgoing(ah.data,ah.origin,function(ai){ag=false;if(ah.callback){K(function(){ah.callback(ai)},0)}ae()})}return(ac={init:function(){if(t(Z)){Z={}}if(Z.maxLength){X=Z.maxLength;ab=true}if(Z.lazy){Y=true}else{ac.down.init()}},callback:function(ai){ag=false;var ah=ac.up;ae();ah.callback(ai)},incoming:function(ak,ai){if(ab){var aj=ak.indexOf("_"),ah=parseInt(ak.substring(0,aj),10);aa+=ak.substring(aj+1);if(ah===0){if(Z.encode){aa=k(aa)}ac.up.incoming(aa,ai);aa=""}}else{ac.up.incoming(ak,ai)}},outgoing:function(al,ai,ak){if(Z.encode){al=H(al)}var ah=[],aj;if(ab){while(al.length!==0){aj=al.substring(0,X);al=al.substring(aj.length);ah.push(aj)}while((aj=ah.shift())){ad.push({data:ah.length+"_"+aj,origin:ai,callback:ah.length===0?ak:null})}}else{ad.push({data:al,origin:ai,callback:ak})}if(Y){ac.down.init()}else{ae()}},destroy:function(){af=true;ac.down.destroy()}})};o.stack.VerifyBehavior=function(ab){var ac,aa,Y,Z=false;function X(){aa=Math.random().toString(16).substring(2);ac.down.outgoing(aa)}return(ac={incoming:function(af,ad){var ae=af.indexOf("_");if(ae===-1){if(af===aa){ac.up.callback(true)}else{if(!Y){Y=af;if(!ab.initiate){X()}ac.down.outgoing(af)}}}else{if(af.substring(0,ae)===Y){ac.up.incoming(af.substring(ae+1),ad)}}},outgoing:function(af,ad,ae){ac.down.outgoing(aa+"_"+af,ad,ae)},callback:function(ad){if(ab.initiate){X()}}})};o.stack.RpcBehavior=function(ad,Y){var aa,af=Y.serializer||O();var ae=0,ac={};function X(ag){ag.jsonrpc="2.0";aa.down.outgoing(af.stringify(ag))}function ab(ag,ai){var ah=Array.prototype.slice;return function(){var aj=arguments.length,al,ak={method:ai};if(aj>0&&typeof arguments[aj-1]==="function"){if(aj>1&&typeof arguments[aj-2]==="function"){al={success:arguments[aj-2],error:arguments[aj-1]};ak.params=ah.call(arguments,0,aj-2)}else{al={success:arguments[aj-1]};ak.params=ah.call(arguments,0,aj-1)}ac[""+(++ae)]=al;ak.id=ae}else{ak.params=ah.call(arguments,0)}if(ag.namedParams&&ak.params.length===1){ak.params=ak.params[0]}X(ak)}}function Z(an,am,ai,al){if(!ai){if(am){X({id:am,error:{code:-32601,message:"Procedure not found."}})}return}var ak,ah;if(am){ak=function(ao){ak=q;X({id:am,result:ao})};ah=function(ao,ap){ah=q;var aq={id:am,error:{code:-32099,message:ao}};if(ap){aq.error.data=ap}X(aq)}}else{ak=ah=q}if(!r(al)){al=[al]}try{var ag=ai.method.apply(ai.scope,al.concat([ak,ah]));if(!t(ag)){ak(ag)}}catch(aj){ah(aj.message)}}return(aa={incoming:function(ah,ag){var ai=af.parse(ah);if(ai.method){if(Y.handle){Y.handle(ai,X)}else{Z(ai.method,ai.id,Y.local[ai.method],ai.params)}}else{var aj=ac[ai.id];if(ai.error){if(aj.error){aj.error(ai.error)}}else{if(aj.success){aj.success(ai.result)}}delete ac[ai.id]}},init:function(){if(Y.remote){for(var ag in Y.remote){if(Y.remote.hasOwnProperty(ag)){ad[ag]=ab(Y.remote[ag],ag)}}}aa.down.init()},destroy:function(){for(var ag in Y.remote){if(Y.remote.hasOwnProperty(ag)&&ad.hasOwnProperty(ag)){delete ad[ag]}}aa.down.destroy()}})};b.easyXDM=o})(window,document,location,window.setTimeout,decodeURIComponent,encodeURIComponent);return easyXDM.noConflict("ComplexTVV2")}function initializeJSON2(){if(typeof JSON!=="object"){JSON={}}(function(){function f(n){return n<10?"0"+n:n}if(typeof Date.prototype.toJSON!=="function"){Date.prototype.toJSON=function(key){return isFinite(this.valueOf())?this.getUTCFullYear()+"-"+f(this.getUTCMonth()+1)+"-"+f(this.getUTCDate())+"T"+f(this.getUTCHours())+":"+f(this.getUTCMinutes())+":"+f(this.getUTCSeconds())+"Z":null};String.prototype.toJSON=Number.prototype.toJSON=Boolean.prototype.toJSON=function(key){return this.valueOf()}}var cx=/[\u0000\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,escapable=/[\\\"\x00-\x1f\x7f-\x9f\u00ad\u0600-\u0604\u070f\u17b4\u17b5\u200c-\u200f\u2028-\u202f\u2060-\u206f\ufeff\ufff0-\uffff]/g,gap,indent,meta={"\b":"\\b","\t":"\\t","\n":"\\n","\f":"\\f","\r":"\\r",'"':'\\"',"\\":"\\\\"},rep;function quote(string){escapable.lastIndex=0;return escapable.test(string)?'"'+string.replace(escapable,function(a){var c=meta[a];return typeof c==="string"?c:"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})+'"':'"'+string+'"'}function str(key,holder){var i,k,v,length,mind=gap,partial,value=holder[key];if(value&&typeof value==="object"&&typeof value.toJSON==="function"){value=value.toJSON(key)}if(typeof rep==="function"){value=rep.call(holder,key,value)}switch(typeof value){case"string":return quote(value);case"number":return isFinite(value)?String(value):"null";case"boolean":case"null":return String(value);case"object":if(!value){return"null"}gap+=indent;partial=[];if(Object.prototype.toString.apply(value)==="[object Array]"){length=value.length;for(i=0;i<length;i+=1){partial[i]=str(i,value)||"null"}v=partial.length===0?"[]":gap?"[\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"]":"["+partial.join(",")+"]";gap=mind;return v}if(rep&&typeof rep==="object"){length=rep.length;for(i=0;i<length;i+=1){if(typeof rep[i]==="string"){k=rep[i];v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}else{for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=str(k,value);if(v){partial.push(quote(k)+(gap?": ":":")+v)}}}}v=partial.length===0?"{}":gap?"{\n"+gap+partial.join(",\n"+gap)+"\n"+mind+"}":"{"+partial.join(",")+"}";gap=mind;return v}}if(typeof JSON.stringify!=="function"){JSON.stringify=function(value,replacer,space){var i;gap="";indent="";if(typeof space==="number"){for(i=0;i<space;i+=1){indent+=" "}}else{if(typeof space==="string"){indent=space}}rep=replacer;if(replacer&&typeof replacer!=="function"&&(typeof replacer!=="object"||typeof replacer.length!=="number")){throw new Error("JSON.stringify")}return str("",{"":value})}}if(typeof JSON.parse!=="function"){JSON.parse=function(text,reviver){var j;function walk(holder,key){var k,v,value=holder[key];if(value&&typeof value==="object"){for(k in value){if(Object.prototype.hasOwnProperty.call(value,k)){v=walk(value,k);if(v!==undefined){value[k]=v}else{delete value[k]}}}}return reviver.call(holder,key,value)}text=String(text);cx.lastIndex=0;if(cx.test(text)){text=text.replace(cx,function(a){return"\\u"+("0000"+a.charCodeAt(0).toString(16)).slice(-4)})}if(/^[\],:{}\s]*$/.test(text.replace(/\\(?:["\\\/bfnrt]|u[0-9a-fA-F]{4})/g,"@").replace(/"[^"\\\n\r]*"|true|false|null|-?\d+(?:\.\d*)?(?:[eE][+\-]?\d+)?/g,"]").replace(/(?:^|:|,)(?:\s*\[)+/g,""))){j=eval("("+text+")");return typeof reviver==="function"?walk({"":j},""):j}throw new SyntaxError("JSON.parse")}}}())}function initializeTrunk8(jQuery){(function(g){var c,a,f={center:"center",left:"left",right:"right"},e={auto:"auto"};function b(h){this.$element=g(h);this.original_text=this.$element.html();this.settings=g.extend({},g.fn.trunk8.defaults)}b.prototype.updateSettings=function(h){this.settings=g.extend(this.settings,h)};function d(){var n=this.data("trunk8"),l=n.settings,h=l.width,q=l.side,w=l.fill,u=a.getLineHeight(this)*l.lines,r=n.original_text,i=r.length,j="",m,t,k,p,v,s,o;this.html(r);if(h===e.auto){if(this.height()<=u){return}m=0;t=i-1;while(m<=t){k=m+((t-m)>>1);p=a.eatStr(r,q,i-k,w);this.html(p);if(this.height()>u){t=k-1}else{m=k+1;j=(j.length>p.length)?j:p}}this.html("");if(m>t){v=r.charAt(j.indexOf(w)-1);if(v!==" "){truncatedTextThatDoesNotBreakOnSpace=r.slice(0,j.indexOf(w));truncatedTextThatDoesBreakOnSpace=truncatedTextThatDoesNotBreakOnSpace.slice(0,truncatedTextThatDoesNotBreakOnSpace.lastIndexOf(" ")+1);j=truncatedTextThatDoesBreakOnSpace+w}}this.html(j);if(l.tooltip){this.attr("title",r)}}else{if(!isNaN(h)){k=i-h;p=a.eatStr(r,q,k,w);this.html(p);if(l.tooltip){this.attr("title",r)}}else{g.error('Invalid width "'+h+'".')}}}c={init:function(h){return this.each(function(){var j=g(this),i=j.data("trunk8");if(!i){j.data("trunk8",(i=new b(this)))}i.updateSettings(h);d.call(j)})},update:function(h){return this.each(function(){var i=g(this);if(h){i.data("trunk8").original_text=h}d.call(i)})},revert:function(){return this.each(function(){var h=g(this).data("trunk8").original_text;g(this).html(h)})},getSettings:function(){return g(this.get(0)).data("trunk8").settings}};a={eatStr:function(o,k,j,n){var m=o.length,i=a.eatStr.generateKey.apply(null,arguments),h,l;if(a.eatStr.cache[i]){return a.eatStr.cache[i]}if((typeof o!=="string")||(m===0)){g.error('Invalid source string "'+o+'".')}if((j<0)||(j>m)){g.error('Invalid bite size "'+j+'".')}else{if(j===0){return o}}if(typeof(n+"")!=="string"){g.error("Fill unable to be converted to a string.")}switch(k){case f.right:return o.substr(0,m-j)+n;case f.left:return a.eatStr.cache[i]=n+g.trim(o.substr(j));case f.center:h=m>>1;l=j>>1;return a.eatStr.cache[i]=g.trim(a.eatStr(o.substr(0,m-h),f.right,j-l,""))+n+g.trim(a.eatStr(o.substr(m-h),f.left,l,""));default:g.error('Invalid side "'+k+'".')}},getLineHeight:function(k){var h=g(k).css("float");if(h!=="none"){g(k).css("float","none")}var m=g(k).css("position");if(m==="absolute"){g(k).css("position","static")}var i=g(k).html(),j="line-height-test",l;g(k).html("i").wrap('<div id="'+j+'" />');l=g("#"+j).innerHeight();g(k).html(i).css({"float":h,position:m}).unwrap();return l}};a.eatStr.cache={};a.eatStr.generateKey=function(){return Array.prototype.join.call(arguments,"")};g.fn.trunk8=function(h){if(c[h]){return c[h].apply(this,Array.prototype.slice.call(arguments,1))}else{if(typeof h==="object"||!h){return c.init.apply(this,arguments)}else{g.error("Method "+h+" does not exist on jQuery.trunk8")}}};g.fn.trunk8.defaults={fill:"&hellip;",lines:1,side:f.right,tooltip:true,width:e.auto}})(jQuery)}function initializeHTML5Shiv(){if(typeof(window.html5)==="undefined"){ComplexTVV2.$('<!--[if lt IE 9]><script src="http://html5shiv.googlecode.com/svn/trunk/html5.js"><\/script><![endif]-->').appendTo("head")}}
/*!
     * Cookies.js - 0.3.0
     * Thursday, February 14 2013 @ 4:16 AM EST
     *
     * Copyright (c) 2013, Scott Hamper
     * Licensed under the MIT license,
     * http://www.opensource.org/licenses/MIT
     */
function initializeCookies(environment){var exports=undefined;(function(environment){var Cookies=function(key,value,options){return arguments.length===1?Cookies.get(key):Cookies.set(key,value,options)};Cookies._document=document;Cookies._navigator=navigator;Cookies.defaults={path:"/"};Cookies.get=function(key){if(Cookies._cachedDocumentCookie!==Cookies._document.cookie){Cookies._renewCache()}return Cookies._cache[key]};Cookies.set=function(key,value,options){options=Cookies._getExtendedOptions(options);options.expires=Cookies._getExpiresDate(value===undefined?-1:options.expires);Cookies._document.cookie=Cookies._generateCookieString(key,value,options);return Cookies};Cookies.expire=function(key,options){return Cookies.set(key,undefined,options)};Cookies._areEnabled=function(){return Cookies._navigator.cookieEnabled||Cookies.set("cookies.js",1).get("cookies.js")==="1"};Cookies.enabled=Cookies._areEnabled();Cookies._getExtendedOptions=function(options){return{path:options&&options.path||Cookies.defaults.path,domain:options&&options.domain||Cookies.defaults.domain,expires:options&&options.expires||Cookies.defaults.expires,secure:options&&options.secure!==undefined?options.secure:Cookies.defaults.secure}};Cookies._isValidDate=function(date){return Object.prototype.toString.call(date)==="[object Date]"&&!isNaN(date.getTime())};Cookies._getExpiresDate=function(expires,now){now=now||new Date();switch(typeof expires){case"number":expires=new Date(now.getTime()+expires*1000);break;case"string":expires=new Date(expires);break}if(expires&&!Cookies._isValidDate(expires)){throw new Error("`expires` parameter cannot be converted to a valid Date instance")}return expires};Cookies._generateCookieString=function(key,value,options){key=encodeURIComponent(key);value=(value+"").replace(/[^!#$&-+\--:<-\[\]-~]/g,encodeURIComponent);options=options||{};var cookieString=key+"="+value;cookieString+=options.path?";path="+options.path:"";cookieString+=options.domain?";domain="+options.domain:"";cookieString+=options.expires?";expires="+options.expires.toGMTString():"";cookieString+=options.secure?";secure":"";return cookieString};Cookies._getCookieObjectFromString=function(documentCookie){var cookieObject={};var cookiesArray=documentCookie?documentCookie.split("; "):[];for(var i=0;i<cookiesArray.length;i++){var separatorIndex=cookiesArray[i].indexOf("=");var key=decodeURIComponent(cookiesArray[i].substr(0,separatorIndex));if(cookieObject[key]===undefined){var value=decodeURIComponent(cookiesArray[i].substr(separatorIndex+1));cookieObject[key]=value}}return cookieObject};Cookies._renewCache=function(){Cookies._cache=Cookies._getCookieObjectFromString(Cookies._document.cookie);Cookies._cachedDocumentCookie=Cookies._document.cookie};if(typeof define==="function"&&define.amd){define(function(){return Cookies})}else{if(typeof exports!=="undefined"){if(typeof module!=="undefined"&&module.exports){exports=module.exports=Cookies}exports.Cookies=Cookies}else{environment.Cookies=Cookies}}})(environment)}function initializeHammer(){
/*! Hammer.JS - v1.1.3 - 2014-05-22
	 * http://eightmedia.github.io/hammer.js
	 *
	 * Copyright (c) 2014 Jorik Tangelder <j.tangelder@gmail.com>;
	 * Licensed under the MIT license */
!function(a,b){function c(){d.READY||(s.determineEventTypes(),r.each(d.gestures,function(a){u.register(a)}),s.onTouch(d.DOCUMENT,n,u.detect),s.onTouch(d.DOCUMENT,o,u.detect),d.READY=!0)}var d=function v(a,b){return new v.Instance(a,b||{})};d.VERSION="1.1.3",d.defaults={behavior:{userSelect:"none",touchAction:"pan-y",touchCallout:"none",contentZooming:"none",userDrag:"none",tapHighlightColor:"rgba(0,0,0,0)"}},d.DOCUMENT=document,d.HAS_POINTEREVENTS=navigator.pointerEnabled||navigator.msPointerEnabled,d.HAS_TOUCHEVENTS="ontouchstart" in a,d.IS_MOBILE=/mobile|tablet|ip(ad|hone|od)|android|silk/i.test(navigator.userAgent),d.NO_MOUSEEVENTS=d.HAS_TOUCHEVENTS&&d.IS_MOBILE||d.HAS_POINTEREVENTS,d.CALCULATE_INTERVAL=25;var e={},f=d.DIRECTION_DOWN="down",g=d.DIRECTION_LEFT="left",h=d.DIRECTION_UP="up",i=d.DIRECTION_RIGHT="right",j=d.POINTER_MOUSE="mouse",k=d.POINTER_TOUCH="touch",l=d.POINTER_PEN="pen",m=d.EVENT_START="start",n=d.EVENT_MOVE="move",o=d.EVENT_END="end",p=d.EVENT_RELEASE="release",q=d.EVENT_TOUCH="touch";d.READY=!1,d.plugins=d.plugins||{},d.gestures=d.gestures||{};var r=d.utils={extend:function(a,c,d){for(var e in c){!c.hasOwnProperty(e)||a[e]!==b&&d||(a[e]=c[e])}return a},on:function(a,b,c){a.addEventListener(b,c,!1)},off:function(a,b,c){a.removeEventListener(b,c,!1)},each:function(a,c,d){var e,f;if("forEach" in a){a.forEach(c,d)}else{if(a.length!==b){for(e=0,f=a.length;f>e;e++){if(c.call(d,a[e],e,a)===!1){return}}}else{for(e in a){if(a.hasOwnProperty(e)&&c.call(d,a[e],e,a)===!1){return}}}}},inStr:function(a,b){return a.indexOf(b)>-1},inArray:function(a,b){if(a.indexOf){var c=a.indexOf(b);return -1===c?!1:c}for(var d=0,e=a.length;e>d;d++){if(a[d]===b){return d}}return !1},toArray:function(a){return Array.prototype.slice.call(a,0)},hasParent:function(a,b){for(;a;){if(a==b){return !0}a=a.parentNode}return !1},getCenter:function(a){var b=[],c=[],d=[],e=[],f=Math.min,g=Math.max;return 1===a.length?{pageX:a[0].pageX,pageY:a[0].pageY,clientX:a[0].clientX,clientY:a[0].clientY}:(r.each(a,function(a){b.push(a.pageX),c.push(a.pageY),d.push(a.clientX),e.push(a.clientY)}),{pageX:(f.apply(Math,b)+g.apply(Math,b))/2,pageY:(f.apply(Math,c)+g.apply(Math,c))/2,clientX:(f.apply(Math,d)+g.apply(Math,d))/2,clientY:(f.apply(Math,e)+g.apply(Math,e))/2})},getVelocity:function(a,b,c){return{x:Math.abs(b/a)||0,y:Math.abs(c/a)||0}},getAngle:function(a,b){var c=b.clientX-a.clientX,d=b.clientY-a.clientY;return 180*Math.atan2(d,c)/Math.PI},getDirection:function(a,b){var c=Math.abs(a.clientX-b.clientX),d=Math.abs(a.clientY-b.clientY);return c>=d?a.clientX-b.clientX>0?g:i:a.clientY-b.clientY>0?h:f},getDistance:function(a,b){var c=b.clientX-a.clientX,d=b.clientY-a.clientY;return Math.sqrt(c*c+d*d)},getScale:function(a,b){return a.length>=2&&b.length>=2?this.getDistance(b[0],b[1])/this.getDistance(a[0],a[1]):1},getRotation:function(a,b){return a.length>=2&&b.length>=2?this.getAngle(b[1],b[0])-this.getAngle(a[1],a[0]):0},isVertical:function(a){return a==h||a==f},setPrefixedCss:function(a,b,c,d){var e=["","Webkit","Moz","O","ms"];b=r.toCamelCase(b);for(var f=0;f<e.length;f++){var g=b;if(e[f]&&(g=e[f]+g.slice(0,1).toUpperCase()+g.slice(1)),g in a.style){a.style[g]=(null==d||d)&&c||"";break}}},toggleBehavior:function(a,b,c){if(b&&a&&a.style){r.each(b,function(b,d){r.setPrefixedCss(a,d,b,c)});var d=c&&function(){return !1};"none"==b.userSelect&&(a.onselectstart=d),"none"==b.userDrag&&(a.ondragstart=d)}},toCamelCase:function(a){return a.replace(/[_-]([a-z])/g,function(a){return a[1].toUpperCase()})}},s=d.event={preventMouseEvents:!1,started:!1,shouldDetect:!1,on:function(a,b,c,d){var e=b.split(" ");r.each(e,function(b){r.on(a,b,c),d&&d(b)})},off:function(a,b,c,d){var e=b.split(" ");r.each(e,function(b){r.off(a,b,c),d&&d(b)})},onTouch:function(a,b,c){var f=this,g=function(e){var g,h=e.type.toLowerCase(),i=d.HAS_POINTEREVENTS,j=r.inStr(h,"mouse");j&&f.preventMouseEvents||(j&&b==m&&0===e.button?(f.preventMouseEvents=!1,f.shouldDetect=!0):i&&b==m?f.shouldDetect=1===e.buttons||t.matchType(k,e):j||b!=m||(f.preventMouseEvents=!0,f.shouldDetect=!0),i&&b!=o&&t.updatePointer(b,e),f.shouldDetect&&(g=f.doDetect.call(f,e,b,a,c)),g==o&&(f.preventMouseEvents=!1,f.shouldDetect=!1,t.reset()),i&&b==o&&t.updatePointer(b,e))};return this.on(a,e[b],g),g},doDetect:function(a,b,c,d){var e=this.getTouchList(a,b),f=e.length,g=b,h=e.trigger,i=f;b==m?h=q:b==o&&(h=p,i=e.length-(a.changedTouches?a.changedTouches.length:1)),i>0&&this.started&&(g=n),this.started=!0;var j=this.collectEventData(c,g,e,a);return b!=o&&d.call(u,j),h&&(j.changedLength=i,j.eventType=h,d.call(u,j),j.eventType=g,delete j.changedLength),g==o&&(d.call(u,j),this.started=!1),g},determineEventTypes:function(){var b;return b=d.HAS_POINTEREVENTS?a.PointerEvent?["pointerdown","pointermove","pointerup pointercancel lostpointercapture"]:["MSPointerDown","MSPointerMove","MSPointerUp MSPointerCancel MSLostPointerCapture"]:d.NO_MOUSEEVENTS?["touchstart","touchmove","touchend touchcancel"]:["touchstart mousedown","touchmove mousemove","touchend touchcancel mouseup"],e[m]=b[0],e[n]=b[1],e[o]=b[2],e},getTouchList:function(a,b){if(d.HAS_POINTEREVENTS){return t.getTouchList()}if(a.touches){if(b==n){return a.touches}var c=[],e=[].concat(r.toArray(a.touches),r.toArray(a.changedTouches)),f=[];return r.each(e,function(a){r.inArray(c,a.identifier)===!1&&f.push(a),c.push(a.identifier)}),f}return a.identifier=1,[a]},collectEventData:function(a,b,c,d){var e=k;return r.inStr(d.type,"mouse")||t.matchType(j,d)?e=j:t.matchType(l,d)&&(e=l),{center:r.getCenter(c),timeStamp:Date.now(),target:d.target,touches:c,eventType:b,pointerType:e,srcEvent:d,preventDefault:function(){var a=this.srcEvent;a.preventManipulation&&a.preventManipulation(),a.preventDefault&&a.preventDefault()},stopPropagation:function(){this.srcEvent.stopPropagation()},stopDetect:function(){return u.stopDetect()}}}},t=d.PointerEvent={pointers:{},getTouchList:function(){var a=[];return r.each(this.pointers,function(b){a.push(b)}),a},updatePointer:function(a,b){a==o?delete this.pointers[b.pointerId]:(b.identifier=b.pointerId,this.pointers[b.pointerId]=b)},matchType:function(a,b){if(!b.pointerType){return !1}var c=b.pointerType,d={};return d[j]=c===(b.MSPOINTER_TYPE_MOUSE||j),d[k]=c===(b.MSPOINTER_TYPE_TOUCH||k),d[l]=c===(b.MSPOINTER_TYPE_PEN||l),d[a]},reset:function(){this.pointers={}}},u=d.detection={gestures:[],current:null,previous:null,stopped:!1,startDetect:function(a,b){this.current||(this.stopped=!1,this.current={inst:a,startEvent:r.extend({},b),lastEvent:!1,lastCalcEvent:!1,futureCalcEvent:!1,lastCalcData:{},name:""},this.detect(b))},detect:function(a){if(this.current&&!this.stopped){a=this.extendEventData(a);var b=this.current.inst,c=b.options;return r.each(this.gestures,function(d){!this.stopped&&b.enabled&&c[d.name]&&d.handler.call(d,a,b)},this),this.current&&(this.current.lastEvent=a),a.eventType==o&&this.stopDetect(),a}},stopDetect:function(){this.previous=r.extend({},this.current),this.current=null,this.stopped=!0},getCalculatedData:function(a,b,c,e,f){var g=this.current,h=!1,i=g.lastCalcEvent,j=g.lastCalcData;i&&a.timeStamp-i.timeStamp>d.CALCULATE_INTERVAL&&(b=i.center,c=a.timeStamp-i.timeStamp,e=a.center.clientX-i.center.clientX,f=a.center.clientY-i.center.clientY,h=!0),(a.eventType==q||a.eventType==p)&&(g.futureCalcEvent=a),(!g.lastCalcEvent||h)&&(j.velocity=r.getVelocity(c,e,f),j.angle=r.getAngle(b,a.center),j.direction=r.getDirection(b,a.center),g.lastCalcEvent=g.futureCalcEvent||a,g.futureCalcEvent=a),a.velocityX=j.velocity.x,a.velocityY=j.velocity.y,a.interimAngle=j.angle,a.interimDirection=j.direction},extendEventData:function(a){var b=this.current,c=b.startEvent,d=b.lastEvent||c;(a.eventType==q||a.eventType==p)&&(c.touches=[],r.each(a.touches,function(a){c.touches.push({clientX:a.clientX,clientY:a.clientY})}));var e=a.timeStamp-c.timeStamp,f=a.center.clientX-c.center.clientX,g=a.center.clientY-c.center.clientY;return this.getCalculatedData(a,d.center,e,f,g),r.extend(a,{startEvent:c,deltaTime:e,deltaX:f,deltaY:g,distance:r.getDistance(c.center,a.center),angle:r.getAngle(c.center,a.center),direction:r.getDirection(c.center,a.center),scale:r.getScale(c.touches,a.touches),rotation:r.getRotation(c.touches,a.touches)}),a},register:function(a){var c=a.defaults||{};return c[a.name]===b&&(c[a.name]=!0),r.extend(d.defaults,c,!0),a.index=a.index||1000,this.gestures.push(a),this.gestures.sort(function(a,b){return a.index<b.index?-1:a.index>b.index?1:0}),this.gestures}};d.Instance=function(a,b){var e=this;c(),this.element=a,this.enabled=!0,r.each(b,function(a,c){delete b[c],b[r.toCamelCase(c)]=a}),this.options=r.extend(r.extend({},d.defaults),b||{}),this.options.behavior&&r.toggleBehavior(this.element,this.options.behavior,!0),this.eventStartHandler=s.onTouch(a,m,function(a){e.enabled&&a.eventType==m?u.startDetect(e,a):a.eventType==q&&u.detect(a)}),this.eventHandlers=[]},d.Instance.prototype={on:function(a,b){var c=this;return s.on(c.element,a,b,function(a){c.eventHandlers.push({gesture:a,handler:b})}),c},off:function(a,b){var c=this;return s.off(c.element,a,b,function(a){var d=r.inArray({gesture:a,handler:b});d!==!1&&c.eventHandlers.splice(d,1)}),c},trigger:function(a,b){b||(b={});var c=d.DOCUMENT.createEvent("Event");c.initEvent(a,!0,!0),c.gesture=b;var e=this.element;return r.hasParent(b.target,e)&&(e=b.target),e.dispatchEvent(c),this},enable:function(a){return this.enabled=a,this},dispose:function(){var a,b;for(r.toggleBehavior(this.element,this.options.behavior,!1),a=-1;b=this.eventHandlers[++a];){r.off(this.element,b.gesture,b.handler)}return this.eventHandlers=[],s.off(this.element,e[m],this.eventStartHandler),null}},function(a){function b(b,d){var e=u.current;if(!(d.options.dragMaxTouches>0&&b.touches.length>d.options.dragMaxTouches)){switch(b.eventType){case m:c=!1;break;case n:if(b.distance<d.options.dragMinDistance&&e.name!=a){return}var j=e.startEvent.center;if(e.name!=a&&(e.name=a,d.options.dragDistanceCorrection&&b.distance>0)){var k=Math.abs(d.options.dragMinDistance/b.distance);j.pageX+=b.deltaX*k,j.pageY+=b.deltaY*k,j.clientX+=b.deltaX*k,j.clientY+=b.deltaY*k,b=u.extendEventData(b)}(e.lastEvent.dragLockToAxis||d.options.dragLockToAxis&&d.options.dragLockMinDistance<=b.distance)&&(b.dragLockToAxis=!0);var l=e.lastEvent.direction;b.dragLockToAxis&&l!==b.direction&&(b.direction=r.isVertical(l)?b.deltaY<0?h:f:b.deltaX<0?g:i),c||(d.trigger(a+"start",b),c=!0),d.trigger(a,b),d.trigger(a+b.direction,b);var q=r.isVertical(b.direction);(d.options.dragBlockVertical&&q||d.options.dragBlockHorizontal&&!q)&&b.preventDefault();break;case p:c&&b.changedLength<=d.options.dragMaxTouches&&(d.trigger(a+"end",b),c=!1);break;case o:c=!1}}}var c=!1;d.gestures.Drag={name:a,index:50,handler:b,defaults:{dragMinDistance:10,dragDistanceCorrection:!0,dragMaxTouches:1,dragBlockHorizontal:!1,dragBlockVertical:!1,dragLockToAxis:!1,dragLockMinDistance:25}}}("drag"),d.gestures.Gesture={name:"gesture",index:1337,handler:function(a,b){b.trigger(this.name,a)}},function(a){function b(b,d){var e=d.options,f=u.current;switch(b.eventType){case m:clearTimeout(c),f.name=a,c=setTimeout(function(){f&&f.name==a&&d.trigger(a,b)},e.holdTimeout);break;case n:b.distance>e.holdThreshold&&clearTimeout(c);break;case p:clearTimeout(c)}}var c;d.gestures.Hold={name:a,index:10,defaults:{holdTimeout:500,holdThreshold:2},handler:b}}("hold"),d.gestures.Release={name:"release",index:1/0,handler:function(a,b){a.eventType==p&&b.trigger(this.name,a)}},d.gestures.Swipe={name:"swipe",index:40,defaults:{swipeMinTouches:1,swipeMaxTouches:1,swipeVelocityX:0.6,swipeVelocityY:0.6},handler:function(a,b){if(a.eventType==p){var c=a.touches.length,d=b.options;if(c<d.swipeMinTouches||c>d.swipeMaxTouches){return}(a.velocityX>d.swipeVelocityX||a.velocityY>d.swipeVelocityY)&&(b.trigger(this.name,a),b.trigger(this.name+a.direction,a))}}},function(a){function b(b,d){var e,f,g=d.options,h=u.current,i=u.previous;switch(b.eventType){case m:c=!1;break;case n:c=c||b.distance>g.tapMaxDistance;break;case o:!r.inStr(b.srcEvent.type,"cancel")&&b.deltaTime<g.tapMaxTime&&!c&&(e=i&&i.lastEvent&&b.timeStamp-i.lastEvent.timeStamp,f=!1,i&&i.name==a&&e&&e<g.doubleTapInterval&&b.distance<g.doubleTapDistance&&(d.trigger("doubletap",b),f=!0),(!f||g.tapAlways)&&(h.name=a,d.trigger(h.name,b)))}}var c=!1;d.gestures.Tap={name:a,index:100,handler:b,defaults:{tapMaxTime:250,tapMaxDistance:10,tapAlways:!0,doubleTapDistance:20,doubleTapInterval:300}}}("tap"),d.gestures.Touch={name:"touch",index:-1/0,defaults:{preventDefault:!1,preventMouse:!1},handler:function(a,b){return b.options.preventMouse&&a.pointerType==j?void a.stopDetect():(b.options.preventDefault&&a.preventDefault(),void (a.eventType==q&&b.trigger("touch",a)))}},function(a){function b(b,d){switch(b.eventType){case m:c=!1;break;case n:if(b.touches.length<2){return}var e=Math.abs(1-b.scale),f=Math.abs(b.rotation);if(e<d.options.transformMinScale&&f<d.options.transformMinRotation){return}u.current.name=a,c||(d.trigger(a+"start",b),c=!0),d.trigger(a,b),f>d.options.transformMinRotation&&d.trigger("rotate",b),e>d.options.transformMinScale&&(d.trigger("pinch",b),d.trigger("pinch"+(b.scale<1?"in":"out"),b));break;case p:c&&b.changedLength<2&&(d.trigger(a+"end",b),c=!1)}}var c=!1;d.gestures.Transform={name:a,index:45,defaults:{transformMinScale:0.01,transformMinRotation:1},handler:b}}("transform"),"function"==typeof define&&define.amd?define(function(){return d}):"undefined"!=typeof module&&module.exports?module.exports=d:a.Hammer=d}(window)}function initializeJqueryHammer(Hammer,jQuery){
/*! jQuery plugin for Hammer.JS - v1.1.2 - 2014-04-25
	 * http://eightmedia.github.com/hammer.js
	 *
	 * Copyright (c) 2014 Jorik Tangelder <j.tangelder@gmail.com>;
	 * Licensed under the MIT license */
!function(a,b){function c(a,c){Date.now||(Date.now=function(){return(new Date).getTime()}),a.utils.each(["on","off"],function(d){a.utils[d]=function(a,e,f){c(a)[d](e,function(a){var d=c.extend({},a.originalEvent,a);d.button===b&&(d.button=a.which-1),f.call(this,d)})}}),a.Instance.prototype.trigger=function(a,b){var d=c(this.element);return d.has(b.target).length&&(d=c(b.target)),d.trigger({type:a,gesture:b})},c.fn.hammer=function(b){return this.each(function(){var d=c(this),e=d.data("hammer");e?e&&b&&a.utils.extend(e.options,b):d.data("hammer",new a(this,b||{}))})}}"function"==typeof define&&define.amd?define(["hammerjs","jquery"],c):c(Hammer,jQuery||a.Zepto)}(window)}ComplexTVV2={};ComplexTVV2.$=ComplexTVV2.$||jQuery;ComplexTVV2._=ComplexTVV2._||initializeUnderscore();ComplexTVV2.Backbone=ComplexTVV2.Backbone||initializeBackbone(ComplexTVV2.$,ComplexTVV2._);ComplexTVV2.easyXDM=initializeEasyXDM();ComplexTVV2.Collections=ComplexTVV2.Collections||{};ComplexTVV2.Models=ComplexTVV2.Models||{};ComplexTVV2.Templates=ComplexTVV2.Templates||{};ComplexTVV2.Views=ComplexTVV2.Views||{};initializeJSON2();initializeTrunk8(ComplexTVV2.$);initializejQueryColorbox(ComplexTVV2.$);initializeHTML5Shiv();initializeCookies(ComplexTVV2);initializeHammer();initializeJqueryHammer(Hammer,ComplexTVV2.$);ComplexTVV2.EventTracker={trackEvent:function(event){var customVarName;var eventArguments=["complextv._trackEvent","ComplexTV"];var widgetId=event.widgetId;if(event.action&&(event.action.indexOf("ComplexTVV2Widget:")==-1)){event.action="ComplexTVV2Widget: "+event.action}ComplexTVV2._.each(["action","label","value","nonInteraction"],function(eventProperty){var propertyValue=event[eventProperty];if(typeof(propertyValue)!=="undefined"){eventArguments.push(propertyValue)}});if(widgetId){customVarName=this.getCustomVarName(widgetId);if(this.isDevEnv()){}else{window._gaq.push(["complextv._setAccount","UA-30251-60"],["complextv._setCustomVar",5,"Widget Type",customVarName])}}this.addToEventQueue(eventArguments)},addToEventQueue:function(argumentsArray){this.push(argumentsArray)},push:function(argumentsArray){if(this.isDevEnv()){}else{window._gaq.push(["complextv._setAccount","UA-30251-60"],argumentsArray)}},isDevEnv:function(){return},getCustomVarName:function(widgetId){if(widgetId=="v2-viewport"){return"News Sidebar"}else{if(widgetId=="v2-content"){return"CTV Homepage Body"}else{if(widgetId=="v2-sidebar"){return"CTV Article Sidebar"}else{if(widgetId=="v2-widget-list"){return"CTV Article Bottom"}else{return"CTV Video Widget"}}}}}};ComplexTVV2.Models.Video=ComplexTVV2.Backbone.Model.extend({shouldAlwaysHavePreroll:function(){return this.getAdFrequency()=="1"},shouldNeverHavePreroll:function(){return this.getAdFrequency()=="0"},hasAdSetOverride:function(){return !this.doesNotHaveAdSetOverride()},doesNotHaveAdSetOverride:function(){return this.getAdSet()===null},getAdFrequency:function(){var adFrequency=this.findMetadataByPattern(/^ad\-fq$/i);return typeof(adFrequency)==="undefined"?null:adFrequency.value},getAdSet:function(){var adSet=this.findMetadataByPattern(/^ad\-set$/i);return typeof(adSet)==="undefined"?null:adSet.value},getAdSetOrEmptyString:function(){var adSet=this.getAdSet();return(adSet===null)?"":adSet},getSnappyHeadline:function(){var snappyHeadline=this.findMetadataByPattern(/^snappy\-headline$/i);return typeof(snappyHeadline)==="undefined"?null:snappyHeadline.value},getAnchorShortHeadline:function(){var anchorShortHeadline=this.findMetadataByPattern(/^anchor\-short\-headline$/i);return typeof(anchorShortHeadline)==="undefined"?null:anchorShortHeadline.value},findMetadataByPattern:function(pattern){return ComplexTVV2._.find(this.get("metadata"),function(metadata){return pattern.test(metadata.key)})},isAdult:function(){return this.hasAdExclusion("adult")},isPromotional:function(){return this.hasAdExclusion("promo")},hasAdExclusion:function(adType){return ComplexTVV2._.contains(this.get("ad_exclusions"),adType)}});ComplexTVV2.Collections.Videos=ComplexTVV2.Backbone.Collection.extend({model:ComplexTVV2.Models.Video,initialize:function(){this.initializeRPC()},initializeRPC:function(){if(this.isBeingRunFromTheWeb()){this.rpc=new ComplexTVV2.easyXDM.Rpc({remote:"http://www.complex.com/tv/cors/widget_v2/"},{remote:{request:{}}})}},isBeingRunFromTheWeb:function(){return ComplexTVV2._.contains(["http:","https:"],window.location.protocol)},sync:function(method,collection,options){if(this.isBeingRunFromTheWeb()){this.syncUsingRPC(options)}else{ComplexTVV2.Backbone.sync(method,collection,options)}},syncUsingRPC:function(options){var that=this;this.rpc.request({url:options.url,method:"GET",data:options.data},function(response){that.combineFeaturedData(response.data,options)})},combineFeaturedData:function(data,options){var that=this;var videoList=JSON.parse(data);var featuredVideo;var combinedVideos;var featuredEndpoint;var isComplexNews=options.data.isComplexNews;featuredEndpoint=this.determineFeaturedEndpoint(isComplexNews);this.rpc.request({url:featuredEndpoint,method:"GET",},function(response){featuredVideo=that.setFeaturedVideoAttr(that.limitMaxNumberVideos(JSON.parse(response.data),2),"Featured");combinedVideos=featuredVideo.concat(videoList);that.combineTakeoverData(combinedVideos,options)})},combineTakeoverData:function(data,options){var that=this;var recentVideos=data;var takeoverVideo;var combinedVideos;var processedVideos;this.rpc.request({url:"/tv/api/videos/featured/complex-widget-takeover?type=desktop",method:"GET",},function(response){takeoverVideo=that.setFeaturedVideoAttr(that.limitMaxNumberVideos(JSON.parse(response.data),1),"Takeover");combinedVideos=takeoverVideo.concat(recentVideos);processedVideos=that.limitMaxNumberVideos(that.removeDuplicates(combinedVideos),options.data.per_page-1);that.parseResponseData(processedVideos)})},setFeaturedVideoAttr:function(data,type){for(var key in data){data[key].featured_type=type}return data},limitMaxNumberVideos:function(data,count){if(data.length>count){return data.slice(0,count)}return data},determineFeaturedEndpoint:function(isComplexNews){var featuredType=(typeof(cmnunt_zone)!=="undefined")?cmnunt_zone.split("_")[0]:"";var channelArray=["style","sneakers","art-design","city-guide","tech","rides","music","pop-culture","sports","girls","video-games"];if(isComplexNews){return"/tv/api/videos/featured/complex-widget-channels"}else{if(channelArray.indexOf(featuredType)!==-1){return"/tv/api/videos/featured/complex-widget-channels?featured_type="+featuredType}else{return"/tv/api/videos/featured/complex-widget-homepage"}}},getCustomValue:function(data){return ComplexTVV2.$("#ctv-v2-widget").data(data)},removeDuplicates:function(data){return ComplexTVV2._.uniq(data,function(item){return item.embed_code})},parseResponseData:function(data){this.reset(data,{parse:true})},parse:function(response){if(typeof(response.data)!=="undefined"){return response.data}return response}});ComplexTVV2.Views.Base=ComplexTVV2.Backbone.View.extend({clearCurrentElementMarkup:function(){this.$el.empty()},haltEventPropagation:function(event){ComplexTVV2.Application.haltEventPropagation(event)},trackEvent:function(event){ComplexTVV2.EventTracker.trackEvent(event)}});ComplexTVV2.Views.ShareButton=ComplexTVV2.Views.Base.extend({events:{click:"handleClick"},shareMessage:"Share",initialize:function(){this.initializePopupURL()},initializePopupURL:function(){this.popupURL=""},handleClick:function(event){this.haltEventPropagation(event);this.trackShare();this.openPopup()},trackShare:function(){this.trackEvent(this.shareEvent)},openPopup:function(){window.open(this.popupURL,"",this.popupOptions)},updateToShareVideo:function(video){this.updateShareEvent(video);this.updatePopupURL(video)},updateShareEvent:function(video){this.shareEvent={action:this.shareMessage,label:video.get("name")}},updatePopupURL:function(video){}});ComplexTVV2.Views.FacebookShareButton=ComplexTVV2.Views.ShareButton.extend({el:".ctv-v2-facebook-share",popupOptions:"menubar=no,toolbar=no,height=436,width=626",baseURL:"http://www.facebook.com/sharer.php",shareMessage:"Share on Facebook",initializePopupURL:function(){this.popupURL=this.baseURL+"?u=http%3A%2F%2Fcomplex.com%2Ftv"},updatePopupURL:function(video){var videoURL=encodeURIComponent(video.get("url"));this.popupURL=this.baseURL+"?u="+videoURL}});ComplexTVV2.Views.TwitterShareButton=ComplexTVV2.Views.ShareButton.extend({el:".ctv-v2-twitter-share",popupOptions:"menubar=no,toolbar=no,height=550,width=520",baseURL:"http://twitter.com/intent/tweet",shareMessage:"Tweet",initializePopupURL:function(){this.popupURL=this.baseURL+"?text=Visit%20complex.com%2Ftv%20for%20the%20sharpest%20original%20shows%20and%20exclusive%20celebrity%20video%20from%20Complex%27s%20pop%20culture%20powerhouse."},updatePopupURL:function(video){var videoURL=encodeURIComponent(video.get("url"));var videoName=encodeURIComponent(video.get("name"));var via="ComplexMag";this.popupURL=this.baseURL+"?url="+videoURL+"&via=ComplexMag&text="+videoName}});ComplexTVV2.Views.GooglePlusShareButton=ComplexTVV2.Views.ShareButton.extend({el:".ctv-v2-google-plus-share",popupOptions:"menubar=no,toolbar=no,height=600,width=600",baseURL:"https://plus.google.com/share",shareMessage:"Share on Google+",initializePopupURL:function(){this.popupURL=this.baseURL+"?url=http%3A%2F%2Fcomplex.com%2Ftv"},updatePopupURL:function(video){var videoURL=encodeURIComponent(video.get("url"));this.popupURL=this.baseURL+"?url="+videoURL}});ComplexTVV2.Views.Video=ComplexTVV2.Views.Base.extend({tagName:"li",model:ComplexTVV2.Models.Video,events:{mouseenter:"handleMouseEnter",mouseleave:"handleMouseLeave",click:"handleClick"},degrees:0,handleMouseEnter:function(event){this.trigger("videoViewMouseEnter",event,this);this.haltEventPropagation(event)},handleMouseLeave:function(event){this.trigger("videoViewMouseLeave",event,this);this.haltEventPropagation(event)},handleClick:function(event){this.trigger("videoViewClick",event,this)},render:function(){this.$el.html(this.getMarkupForModel());this.$rotator=this.$el.find(".ctv-v2-rotator");this.$mask=this.$el.find(".ctv-v2-mask");return this},renderFeatured:function(){this.$el.html(this.getFeaturedMarkupForModel());return this},getMarkupForModel:function(){return ComplexTVV2.Templates.Video(this.getTemplateData())},getFeaturedMarkupForModel:function(){return ComplexTVV2.Templates.FeaturedVideo(this.getTemplateData())},getTemplateData:function(){var anchorShortHeadline=this.model.getAnchorShortHeadline();var snappyHeadline=this.model.getSnappyHeadline();var shortHeadline=snappyHeadline?snappyHeadline:anchorShortHeadline;this.model.set({short_headline:shortHeadline});return this.model.toJSON()},activate:function(){this.$el.addClass("active")},startClock:function(advanceSpeed){var rotateTimer=ComplexTVV2._.bind(this.rotateTimer,this);this.setTimerRunning(true);this.setClock(window.setInterval(rotateTimer,advanceSpeed/180,false))},setTimerRunning:function(timerRunning){this.timerRunning=timerRunning},setClock:function(clock){this.clock=clock},rotateTimer:function(reset){this.rotateToCurrentDegrees();this.incrementDegrees();if(reset){this.resetRotation()}if(this.degrees>180){this.moveRotator()}if(this.degrees>360){this.resetRotation()}},rotateToCurrentDegrees:function(){var degreeCSS="rotate("+this.degrees+"deg)";var rotateCSS={"-webkit-transform":degreeCSS,"-moz-transform":degreeCSS,"-o-transform":degreeCSS,"-ms-transform":degreeCSS};this.setRotatorCSS(rotateCSS)},setRotatorCSS:function(css){this.$rotator.css(css)},incrementDegrees:function(){this.setDegrees(this.getDegrees()+2)},getDegrees:function(){return this.degrees},resetRotation:function(){this.setDegrees(0);this.$rotator.removeClass("ctv-v2-move");this.$mask.removeClass("ctv-v2-move")},moveRotator:function(){this.$rotator.addClass("ctv-v2-move");this.$mask.addClass("ctv-v2-move")},stopClock:function(){this.setTimerRunning(false);window.clearInterval(this.clock);this.setDegrees(0);this.rotateTimer(true)},setDegrees:function(degrees){this.degrees=degrees},isActive:function(){return this.$el.hasClass("active")},isNotActive:function(){return !this.isActive()}});ComplexTVV2.Views.VideoCollection=ComplexTVV2.Views.Base.extend({render:function(element,currentPage,isComplexNews){this.element=element;this.widgetId=this.element.data("widget-id");this.currentPage=currentPage;this.clearCurrentElementPage();if(!isComplexNews&&this.currentPage=="1"){var collectionWithoutFeatured=new ComplexTVV2.Backbone.Collection(this.collection.slice(1,this.collection.length));this.renderFeaturedVideo(this.collection.first());collectionWithoutFeatured.each(this.renderVideo,this)}else{this.collection.each(this.renderVideo,this)}this.ellipsisVideoNames()},clearCurrentElementPage:function(element){this.divId='[data-widget-id="'+this.element.data("widget-id")+'"]';ComplexTVV2.$(this.divId+" .ctv-v2-video-list").empty()},renderVideo:function(video){var view=new ComplexTVV2.Views.Video({model:video});var item=ComplexTVV2.$(view.render().el).fadeIn("fast");view.on("videoViewClick",this.handleVideoClick,this);this.element.find(".ctv-v2-video-list").append(item);if(!this.isVideoRenderedAlready(video)){if(!this.element.hasClass("loaded")&&this.currentPage==1){this.setVideoRendered(video)}else{if(this.currentPage!=1){this.setVideoRendered(video)}}}},renderFeaturedVideo:function(video){var view=new ComplexTVV2.Views.Video({model:video});var item=ComplexTVV2.$(view.renderFeatured().el).fadeIn("fast");view.on("videoViewClick",this.handleVideoClick,this);this.element.find(".ctv-v2-video-list").append(item);if(!this.isVideoRenderedAlready(video)){if(!this.element.hasClass("loaded")&&this.currentPage==1){this.setVideoRendered(video)}else{if(this.currentPage!=1){this.setVideoRendered(video)}}}},handleVideoMouseEnter:function(event,videoView){this.trigger("mouseDidEnterVideoView",videoView)},handleVideoMouseLeave:function(event,videoView){this.trigger("mouseDidLeaveVideoView",videoView)},handleVideoClick:function(event,videoView){this.trigger("videoViewWasClicked",event,videoView)},ellipsisVideoNames:function(){ComplexTVV2.$(".ctv-v2-details a .ctv-v2-ellipsis-text").trunk8({lines:ComplexTVV2.Application.numberOfVideoDetailLines})},trackThumbnailLoaded:function(video){this.trackEvent({action:"Thumbnail Loaded - Widget",label:video.get("name"),widgetId:this.widgetId})},isVideoRenderedAlready:function(video){return video.get("rendered")},setVideoRendered:function(video){video.set("rendered",true)}});ComplexTVV2.Views.FullscreenVideoCollection=ComplexTVV2.Views.Base.extend({render:function(element,currentPage){this.element=element;this.widgetId=this.element.data("widget-id");this.clearCurrentElementPage();if(currentPage=="1"){var collectionWithoutFeatured=new ComplexTVV2.Backbone.Collection(this.collection.slice(1,this.collection.length));this.renderFeaturedVideo(this.collection.first());collectionWithoutFeatured.each(this.renderVideo,this)}else{this.collection.each(this.renderVideo,this)}this.ellipsisVideoNames()},clearCurrentElementPage:function(){ComplexTVV2.$("#ctv-v2-fullscreen-video-list-"+this.widgetId).empty()},renderVideo:function(video){var view=new ComplexTVV2.Views.Video({model:video});var item=ComplexTVV2.$(view.render().el).fadeIn("fast");view.on("videoViewClick",this.handleFullscreenVideoClick,this);ComplexTVV2.$("#ctv-v2-fullscreen-video-list-"+this.widgetId).append(item);if(!this.isVideoRenderedAlready(video)){this.trackThumbnailLoaded(video);this.setVideoRendered(video)}},renderFeaturedVideo:function(video){var view=new ComplexTVV2.Views.Video({model:video});var item=ComplexTVV2.$(view.renderFeatured().el).fadeIn("fast");view.on("videoViewClick",this.handleFullscreenVideoClick,this);ComplexTVV2.$("#ctv-v2-fullscreen-video-list-"+this.widgetId).append(item);if(!this.isVideoRenderedAlready(video)){this.trackThumbnailLoaded(video);this.setVideoRendered(video)}},handleFullscreenVideoClick:function(event,videoView){this.trigger("fullscreenVideoViewWasClicked",event,videoView)},ellipsisVideoNames:function(){ComplexTVV2.$(".ctv-v2-details a .ctv-v2-ellipsis-text",ComplexTVV2.$("#ctv-v2-fullscreen-video-list-"+this.widgetId)).trunk8({lines:ComplexTVV2.Application.numberOfVideoDetailLines})},trackThumbnailLoaded:function(video){this.trackEvent({action:"Thumbnail Loaded - Overlay",label:video.get("name"),widgetId:this.widgetId})},isVideoRenderedAlready:function(video){return video.get("fullscreen_rendered")},setVideoRendered:function(video){video.set("fullscreen_rendered",true)}});ComplexTVV2.Views.Widget=ComplexTVV2.Views.Base.extend({events:{"click .ctv-v2-logo":"handleLogoClick","click .ctv-v2-view-more":"handleViewMoreClick"},filters:{recentVideos:{action:"fetchRecentVideos"}},ooyalaPlayer:{name:1,player:0},defaults:{perPage:4,playerId:"3985af8dd6a94b798755d3b5dbc8ba0a",labelIds:undefined,isComplexNews:false},page:1,numberOfPages:3,OO:undefined,numberOfPlayersToCache:0,numberOfClicks:0,numberOfFullscreenClicks:0,shareButtons:[],currentVideo:undefined,complexDisqusShortName:"cmplx",hammerOptions:{dragLockToAxis:true,dragBlockHorizontal:true},initialize:function(options){this.parseInitializationOptions(options);this.initializePaths();this.initializeLoadTracking();this.initializeCollection();this.initializeCollectionView();this.initializeFullscreenCollectionView();this.setDefaultFilter();this.initializeShareButtons();this.initializeAdManager();this.initializeOoyalaPlayerManager();this.setImageFormats();this.setDrawingInitClasses();this.bindWidgetClickEvents()},bindWidgetClickEvents:function(){this.handleNextPageClick();this.handlePreviousPageClick()},handleNextPageClick:function(){var that=this;var callback=ComplexTVV2._.bind(this.nextPageClickEvent,this);ComplexTVV2.$(this.divId+" .ctv-v2-header .ctv-v2-nav-next").on("click",callback);if(!this.options.isComplexNews){ComplexTVV2.$(this.divId).hammer(this.hammerOptions).on("swipeleft",callback)}},nextPageClickEvent:function(event){this.haltEventPropagation(event);if(!this.onLastPage()){this.hideViewMore();if(this.onSecondLastPage()){this.showViewMore()}this.moveToNextPage();this.trackNextPageClick("widget")}},handlePreviousPageClick:function(){var that=this;var callback=ComplexTVV2._.bind(this.previousPageClickEvent,this);ComplexTVV2.$(this.divId+" .ctv-v2-header .ctv-v2-nav-previous").on("click",callback);if(!this.options.isComplexNews){ComplexTVV2.$(this.divId).hammer(this.hammerOptions).on("swiperight",callback)}},previousPageClickEvent:function(event){this.haltEventPropagation(event);this.hideViewMore();if(!this.onFirstPage()){this.decrementPage();this.pageDidChange();this.trackPreviousPageClick("widget")}},parseInitializationOptions:function(options){this.options=ComplexTVV2.$.extend({},this.defaults,options);this.widgetId=this.options.element.data("widget-id");this.divId='[data-widget-id="'+this.widgetId+'"]'},initializePaths:function(options){if(this.customLabelsWereSet()){this.initializePathsForLabel()}else{this.initializeDefaultPaths()}},customLabelsWereSet:function(){return typeof(this.options.labelIds)!=="undefined"},initializePathsForLabel:function(){if(this.curationParametersWereSet()){this.pathToRecentVideos="/tv/api/labels/curated/latest"}else{this.pathToRecentVideos="/tv/api/widget/latest_label_videos"}},curationParametersWereSet:function(){return(typeof(this.options.includeOnlyLabels)!=="undefined")||(typeof(this.options.excludeLabels)!=="undefined")||(typeof(this.options.includeOnlyKeywords)!=="undefined")||(typeof(this.options.excludeKeywords)!=="undefined")||(typeof(this.options.collation)!=="undefined")||(typeof(this.options.includeAllLabels!=="undefined"))},initializeDefaultPaths:function(){this.pathToRecentVideos="/tv/api/widget/latest_videos"},initializeCollection:function(){this.collection=new ComplexTVV2.Collections.Videos();this.bindCollectionEvents()},bindCollectionEvents:function(){this.collection.on("reset",this.collectionWasReset,this)},collectionWasReset:function(){this.setNumberOfPages();this.resetPagination();this.renderCurrentPage();this.options.element.attr("class","loaded");this.trackLoadOnce()},setNumberOfPages:function(){var collectionLength=this.collection.length;var perPage=this.options.perPage;this.numberOfPages=Math.ceil(collectionLength/perPage)},resetPagination:function(){this.moveToFirstPage();this.updatePaginationArrows()},updatePaginationArrows:function(){if(this.onOnlyPage()){this.disablePreviousArrow();this.disableNextArrow()}else{if(this.onLastPage()){this.disableNextArrow();this.enablePreviousArrow()}else{if(this.onFirstPage()){this.disablePreviousArrow();this.enableNextArrow()}else{this.enableNextArrow();this.enablePreviousArrow()}}}},onOnlyPage:function(){return this.numberOfPages===1},disablePreviousArrow:function(){this.disableArrow(this.getPreviousArrow());this.disableArrow(this.getFullscreenPreviousArrow())},disableNextArrow:function(){this.disableArrow(this.getNextArrow());this.disableArrow(this.getFullscreenNextArrow())},getPreviousArrow:function(){return ComplexTVV2.$(this.divId+" .ctv-v2-nav-previous")},getFullscreenPreviousArrow:function(){return ComplexTVV2.$(".ctv-v2-video-fullscreen-"+this.widgetId+" .ctv-v2-nav-previous")},getNextArrow:function(){return ComplexTVV2.$(this.divId+" .ctv-v2-nav-next")},getFullscreenNextArrow:function(){return ComplexTVV2.$(".ctv-v2-video-fullscreen-"+this.widgetId+" .ctv-v2-nav-next")},disableArrow:function(element){element.addClass("ctv-v2-disabled");element.children("span").addClass("ctv-v2-disabled")},enablePreviousArrow:function(){this.enableArrow(this.getPreviousArrow());this.enableArrow(this.getFullscreenPreviousArrow())},enableNextArrow:function(){this.enableArrow(this.getNextArrow());this.enableArrow(this.getFullscreenNextArrow())},enableArrow:function(element){element.removeClass("ctv-v2-disabled");element.children("span").removeClass("ctv-v2-disabled")},moveToFirstPage:function(){this.setPage(1)},setPage:function(page){this.page=page},renderCurrentPage:function(){var currentSubset=this.options.isComplexNews?new ComplexTVV2.Backbone.Collection(this.collection.slice(0,this.options.complexNewsCounts)):this.getPaginatedSubset();this.renderCollection(currentSubset)},renderCurrentFullscreenPage:function(){var currentSubset=this.getPaginatedSubset();this.renderFullscreenCollection(currentSubset)},renderCollection:function(collection){this.collectionView.collection=collection;this.collectionView.render(this.options.element,this.page,this.options.isComplexNews);this.setFirstPageLiClass()},setFirstPageLiClass:function(){if(this.onFirstPage()){ComplexTVV2.$(this.divId+" .ctv-v2-video-list li:first-child").addClass("first")}},renderFullscreenCollection:function(collection){this.fullscreenCollectionView.collection=collection;this.fullscreenCollectionView.render(this.options.element,this.page);this.setFirstFullscreenPageLiClass()},setFirstFullscreenPageLiClass:function(){if(this.onFirstPage()){ComplexTVV2.$("#ctv-v2-fullscreen-video-list-"+this.widgetId+" li:first-child").addClass("first")}},getPaginatedSubset:function(){var pagination=this.determineStartAndStopIndices();var startIndex=pagination.startIndex;var stopIndex=pagination.stopIndex;return this.paginateCollection(startIndex,stopIndex)},paginateCollection:function(startIndex,stopIndex){var models=this.collection.slice(startIndex,stopIndex);return new ComplexTVV2.Backbone.Collection(models)},determineStartAndStopIndices:function(){var perPage=this.options.perPage;var page=this.page;if(this.onFirstPage()){return{startIndex:(page-1)*perPage,stopIndex:(page*perPage)-1}}else{return{startIndex:(page-1)*perPage-1,stopIndex:(page*perPage)-1}}},initializeCollectionView:function(){this.collectionView=new ComplexTVV2.Views.VideoCollection({collection:this.collection});this.bindCollectionViewEvents()},bindCollectionViewEvents:function(){this.collectionView.on("videoViewWasClicked",this.videoWasClicked,this)},initializeFullscreenCollectionView:function(){this.fullscreenCollectionView=new ComplexTVV2.Views.FullscreenVideoCollection({collection:this.collection});this.bindFullscreenCollectionViewEvents()},bindFullscreenCollectionViewEvents:function(){this.fullscreenCollectionView.on("fullscreenVideoViewWasClicked",this.fullscreenVideoWasClicked,this)},setDefaultFilter:function(){this.currentFilter=this.filters.recentVideos},initializeAdManager:function(){if(typeof(ctvWidFq)!=="undefined"){var frequencies=ComplexTVV2._.map(ctvWidFq.split(","),function(frequency){return parseInt(frequency,10)});this.adManager=new ComplexTVV2.AdManager(frequencies[0],frequencies[1])}else{this.adManager=new ComplexTVV2.AdManager(1,2)}},initializeOoyalaPlayerManager:function(){if(typeof(this.options.playerManager)!=="undefined"){this.ooyalaManager=this.options.playerManager}else{this.ooyalaManager=new ComplexTVV2.OoyalaPlayerManager();this.ooyalaManager.seedCache(this.options.playerId,this.numberOfPlayersToCache)}},initializeLoadTracking:function(){if(!this.options.element.hasClass("loaded")){var engagementCallback=ComplexTVV2._.bind(this.trackEngagementEvent,this);this.trackLoadOnce=ComplexTVV2._.once(engagementCallback)}else{this.trackLoadOnce=function(){}}},trackEngagementEvent:function(){this.trackEvent({action:"Load Complete",label:"Widget Loaded",widgetId:this.widgetId})},setImageFormats:function(){this.imageFormats=["image/jpeg","image/gif","image/png","image/svg"]},performInitialFetch:function(){this.fetchVideosUsingCurrentFilter()},fetchVideosUsingCurrentFilter:function(){this.fetchVideosForFilter(this.currentFilter)},fetchVideosForFilter:function(filter){this[filter.action]()},fetchRecentVideos:function(){var fetchOptions=ComplexTVV2.$.extend({},this.getBaseFetchOptions(),this.getCurationFetchOptions());this.fetch(this.pathToRecentVideos,fetchOptions)},getBaseFetchOptions:function(){var options={per_page:this.numberOfVideosToFetch(),isComplexNews:this.options.isComplexNews};if(this.customLabelsWereSet()){options.labels=this.options.labelIds}return options},numberOfVideosToFetch:function(){return this.options.perPage*this.numberOfPages},getCurationFetchOptions:function(){var options={};if(typeof(this.options.includeOnlyLabels)!=="undefined"){options.include_only_labels=this.options.includeonlyLabels}if(typeof(this.options.excludeLabels)!=="undefined"){options.exclude_labels=this.options.excludeLabels}if(typeof(this.options.includeOnlyKeywords)!=="undefined"){options.include_only_keywords=this.options.includeOnlyKeywords}if(typeof(this.options.excludeKeywords)!=="undefined"){options.exclude_keywords=this.options.excludeKeywords}if(typeof(this.options.collation)!=="undefined"){options.collation=this.options.collation}if(typeof(this.options.includeAllLabels)!=="undefined"){options.include_all_labels=this.options.includeAllLabels}return options},fetch:function(url,data){this.collection.fetch({url:url,data:data})},trackNextPageClick:function(section){this.trackEvent({action:"Click - Next Page",label:"Next Page - "+section,widgetId:this.widgetId})},trackPreviousPageClick:function(section){this.trackEvent({action:"Click - Previous Page",label:"Previous Page - "+section,widgetId:this.widgetId})},hideFullscreenViewMore:function(){ComplexTVV2.$(".ctv-v2-video-fullscreen-"+this.widgetId+" .ctv-v2-view-more").hide()},showFullscreenViewMore:function(){ComplexTVV2.$(".ctv-v2-video-fullscreen-"+this.widgetId+" .ctv-v2-view-more").fadeIn(1000)},hideViewMore:function(){var currentLayout=ComplexTVV2.$(this.divId).data("layout");if(currentLayout==1){ComplexTVV2.$(this.divId+" > .ctv-v2-view-more").hide()}else{ComplexTVV2.$(this.divId+" .ctv-v2-header .ctv-v2-view-more").hide()}},showViewMore:function(){var currentLayout=ComplexTVV2.$(this.divId).data("layout");if(currentLayout==1){ComplexTVV2.$(this.divId+" > .ctv-v2-view-more").fadeIn(1000)}else{ComplexTVV2.$(this.divId+" .ctv-v2-header .ctv-v2-view-more").fadeIn(1000)}},handleLogoClick:function(event){this.trackLogoClick("widget")},handleViewMoreClick:function(event){this.trackViewMoreClick("widget")},trackViewMoreClick:function(section){this.trackEvent({action:"Click - View More",label:"View More - "+section,widgetId:this.widgetId})},onLastPage:function(){return this.page==this.numberOfPages},onSecondLastPage:function(){return(this.page+1)==this.numberOfPages},moveToNextPage:function(){this.incrementPage();this.pageDidChange()},incrementPage:function(){this.setPage(this.page+1)},pageDidChange:function(){this.updatePaginationArrows();this.renderCurrentPage()},setLoadMoreTextAndLink:function(){var loadMoreEl=ComplexTVV2.$("#ctv-v2-load-more");loadMoreEl.text("View More On Complex TV");loadMoreEl.attr({href:"http://www.complex.com/tv/",target:"_blank"});loadMoreEl.addClass("last")},videoWasClicked:function(event,videoView){var video=videoView.model;this.haltEventPropagation(event);this.trackVideoClick(video,"widget");this.trackFeaturedVideoClick(video,"widget");this.setFullscreenCurrentPage(video);this.playVideo(video);this.pauseComplexVideo();this.handleResponsiveOverlayResizing();ComplexTVV2.$.colorbox({inline:true,href:this.divId+" .ctv-v2-video-fullscreen-"+this.widgetId,transition:"none",width:"80%",closeButton:false,escKey:true,overlayClose:false,fixed:true,onOpen:ComplexTVV2._.bind(this.handleFullscreenEvents,this),onComplete:ComplexTVV2._.bind(this.handleOnCompleteEvents,this,video),onCleanup:ComplexTVV2._.bind(this.handleClosedEvents,this)})},handleResponsiveOverlayResizing:function(){var that=this;window.addEventListener("resize",function(){that.setPlayerDimension();that.resizeColorbox()},false)},setFullscreenCurrentPage:function(video){if(this.options.isComplexNews){var currentPosition=this.collection.indexOf(video)+1;if(currentPosition<=3){this.setPage(1)}else{if(currentPosition>3&&currentPosition<=7){this.setPage(2)}else{this.setPage(3)}}}},pauseComplexVideo:function(){if(typeof(ooplayer)!=="undefined"){ooplayer.pause()}},fullscreenVideoWasClicked:function(event,videoView){var video=videoView.model;this.haltEventPropagation(event);this.trackVideoClick(video,"overlay");this.trackFeaturedVideoClick(video,"overlay");this.updateVideoDetailsWithVideo(video);this.playVideo(video)},trackVideoClick:function(video,section){if(section==="widget"){this.incrementNumberOfClicks();this.trackEvent({action:"Click_"+this.getNumberOfClicks()+" - "+section,label:video.get("name"),widgetId:this.widgetId})}else{this.incrementNumberOfFullscreenClicks();this.trackEvent({action:"Click_"+this.getNumberOfFullscreenClicks()+" - "+section,label:video.get("name"),widgetId:this.widgetId})}},trackFeaturedVideoClick:function(video,section){var featuredType=video.get("featured_type");if(featuredType){this.trackEvent({action:featuredType+" Click - "+section,label:video.get("name"),widgetId:this.widgetId})}},trackLogoClick:function(section){this.trackEvent({action:"Click - Complex Logo",label:"Complex Logo - "+section,widgetId:this.widgetId})},incrementNumberOfClicks:function(){this.setNumberOfClicks(this.getNumberOfClicks()+1)},incrementNumberOfFullscreenClicks:function(){this.setNumberOfFullscreenClicks(this.getNumberOfFullscreenClicks()+1)},setNumberOfClicks:function(numberOfClicks){this.numberOfClicks=numberOfClicks},setNumberOfFullscreenClicks:function(numberOfClicks){this.numberOfFullscreenClicks=numberOfClicks},getNumberOfClicks:function(){return this.numberOfClicks},getNumberOfFullscreenClicks:function(){return this.numberOfFullscreenClicks},initializeShareButtons:function(){this.initializeFacebookShareButton();this.initializeTwitterShareButton();this.initializeGooglePlusShareButton()},initializeFacebookShareButton:function(){this.shareButtons.push(new ComplexTVV2.Views.FacebookShareButton())},initializeTwitterShareButton:function(){this.shareButtons.push(new ComplexTVV2.Views.TwitterShareButton())},initializeGooglePlusShareButton:function(){this.shareButtons.push(new ComplexTVV2.Views.GooglePlusShareButton())},playVideo:function(video){this.destroyVideoPlayer();this.downloadAndCreatePlayerForVideo(video)},destroyVideoPlayer:function(){this.undefineVideoPlayer()},undefineVideoPlayer:function(){this.ooyalaManager.destroy(this.playerName)},downloadAndCreatePlayerForVideo:function(embedCode){var callback=ComplexTVV2._.bind(this.createAndShowPlayerOnReady,this,embedCode);this.ooyalaManager.prepareOoyalaPlayer(this.options.playerId,callback)},createAndShowPlayerOnReady:function(embedCode){var that=this;var player=this.ooyalaManager.getPlayer();this.playerName=player[this.ooyalaPlayer.name];this.OO=player[this.ooyalaPlayer.player];this.OO.ready(function(){that.createPlayer(embedCode)})},createPlayer:function(video){var subscribeToPlayerMessageBus=ComplexTVV2._.bind(this.subscribeToPlayerMessageBus,this);var playerOptions={wmode:"opaque",autoplay:true,onCreate:subscribeToPlayerMessageBus};this.setCurrentVideo(video);this.adManager.willPlayVideo(video);ComplexTVV2._.extend(playerOptions,this.adManager.getOptionsForAdvertisement());this.videoPlayer=this.OO.Player.create("ctv-v2-player-"+this.widgetId,video.get("embed_code"),playerOptions)},subscribeToPlayerMessageBus:function(player){var messageBus=player.mb;this.subscribeToAdsPlayedEvent(messageBus);this.subscribeToWillShowCompanionAdsEvent(messageBus);this.subscribeToPlayheadTimeChangedEvent(messageBus);this.subscribeToVideoPlayedEvent(messageBus)},subscribeToAdsPlayedEvent:function(messageBus){var playedCallback=ComplexTVV2._.bind(this.fadeOutCompanionAd,this);messageBus.subscribe(this.OO.EVENTS.ADS_PLAYED,"ComplexTVV2",playedCallback)},subscribeToVideoPlayedEvent:function(messageBus){var videoPlayedCallback=ComplexTVV2._.bind(this.videoPlayed,this,messageBus);messageBus.intercept(this.OO.EVENTS.PLAYED,"ComplexTVV2video-played",videoPlayedCallback)},videoPlayed:function(messageBus){var activeVideoContentID=this.activePlayingVideoEmbed;var nextVideoEmbed=this.setNextVideoPageAndReturnNextVideoEmbed(activeVideoContentID);var nextVideo=this.getVideoInCollection(nextVideoEmbed);var videoView=new ComplexTVV2.Views.Video({model:nextVideo});var video=videoView.model;this.setActiveToClickedVideo(video);this.updateVideoDetailsWithVideo(video);ComplexTVV2._.defer(ComplexTVV2._.bind(this.playVideo,this,video));return false},setNextVideoPageAndReturnNextVideoEmbed:function(embed){var collectionLength=this.collection.length;var embedCodeArray=this.collection.pluck("embed_code");var nextVideoPosition=embedCodeArray.indexOf(embed)+1;var nextPage;var nextVideoEmbed;var numberOfVideosPerPage=this.options.perPage;if(nextVideoPosition==collectionLength){nextPage=1;nextVideoEmbed=embedCodeArray[0]}else{if(this.onFirstPage){numberOfVideosPerPage--}nextPage=Math.floor(nextVideoPosition/numberOfVideosPerPage)+1;nextVideoEmbed=embedCodeArray[nextVideoPosition]}this.setPage(nextPage);this.renderCurrentFullscreenPage();return nextVideoEmbed},getVideoInCollection:function(embed){return this.collection.find(function(model){return model.get("embed_code")===embed})},fadeOutCompanionAd:function(){ComplexTVV2.$("#ctv-v2-ad-container").fadeOut("slow")},subscribeToWillShowCompanionAdsEvent:function(messageBus){var willShowCompanionAdsCallback=ComplexTVV2._.bind(this.willShowCompanionAds,this);messageBus.subscribe(this.OO.EVENTS.WILL_SHOW_COMPANION_ADS,"ads",willShowCompanionAdsCallback)},willShowCompanionAds:function(eventName,companionAds){var ad=this.findCompanionAd(companionAds.ads);if(typeof(ad)!=="undefined"){this.generateCompanionAdMarkup(ad);this.fadeInCompanionAd()}},findCompanionAd:function(companionAds){return ComplexTVV2._.find(companionAds,function(ad){return ad.width==300&&ad.height==250})},generateCompanionAdMarkup:function(ad){if(ad.resourceType=="static"&&this.hasCreativeType(ad.creativeType)){this.generateStaticCompanionAd(ad)}else{if(this.isFlashType(ad.creativeType)){this.generateFlashCompanionAd(ad)}else{this.generateIframeCompanionAd(ad)}}},isFlashType:function(type){return type=="application/x-shockwave-flash"},hasCreativeType:function(type){return this.imageFormats.indexOf(type)!=-1},generateFlashCompanionAd:function(ad){var $iframe=ComplexTVV2.$("<iframe />",{src:ad.url+"&clickTAG="+encodeURIComponent(ad.clickThroughUrl)+"&clickTag="+encodeURIComponent(ad.clickThroughUrl),frameborder:"0",scrolling:"no",allowtransparency:"true",width:"300",height:"250"});this.setCompanionAdMarkup($iframe)},generateStaticCompanionAd:function(ad){var $anchor=this.generateAnchorForAd(ad);var $image=this.generateImageForAd(ad);$anchor.html($image);this.setCompanionAdMarkup($anchor)},generateAnchorForAd:function(ad){return ComplexTVV2.$("<a />",{href:ad.clickThroughUrl})},generateImageForAd:function(ad){return ComplexTVV2.$("<img />",{src:ad.url})},generateIframeCompanionAd:function(ad){var $iframe=ComplexTVV2.$("<iframe />",{src:ad.url,frameborder:"0",scrolling:"no",allowtransparency:"true",width:"300",height:"250"});this.setCompanionAdMarkup($iframe)},setCompanionAdMarkup:function($element){ComplexTVV2.$("#cmnWidgetCompanion").html($element)},fadeInCompanionAd:function(){ComplexTVV2.$("#ctv-v2-ad-container").fadeIn("slow")},subscribeToPlayheadTimeChangedEvent:function(messageBus){this.registerAdManagerCallback(messageBus);this.registerPlayTracking(messageBus)},registerAdManagerCallback:function(messageBus){if(this.adManager.hasPlayheadTimeChangedCallback()){var adManagerCallback=this.adManager.getPlayheadTimeChangedCallback();var playheadTimeChangedCallback=ComplexTVV2._.bind(this.callAdManagerCallbackAndUnsubscribe,this,messageBus,adManagerCallback);messageBus.subscribe(this.OO.EVENTS.PLAYHEAD_TIME_CHANGED,"ComplexTVV2",playheadTimeChangedCallback)}},callAdManagerCallbackAndUnsubscribe:function(messageBus,callback){callback();messageBus.unsubscribe(this.OO.EVENTS.PLAYHEAD_TIME_CHANGED,"ComplexTVV2")},registerPlayTracking:function(messageBus){var callback=ComplexTVV2._.bind(this.trackPlayStart,this,messageBus);messageBus.subscribe(this.OO.EVENTS.DOWNLOADING,"ComplexTVV2 - Analytics",callback)},trackPlayStart:function(messageBus){this.trackEvent({action:"Play",label:this.getCurrentVideoName(),widgetId:this.widgetId});messageBus.unsubscribe(this.OO.EVENTS.DOWNLOADING,"ComplexTVV2 - Analytics")},getCurrentVideoName:function(){if(typeof(this.currentVideo)==="undefined"){return""}return this.currentVideo.get("name")},setCurrentVideo:function(video){this.currentVideo=video},updateVideoDetailsWithVideo:function(video){this.setVideoDetailsText(video.get("name"));this.setVideoDescText(video.get("description"));this.setVideoDetailsLink(video.get("url"));this.showDisqusCommentsCount(video.get("url"));this.updateSharingButtons(video);this.updateFullscreenWidgetView(video);this.resizeColorbox()},updateFullscreenWidgetView:function(video){this.activePlayingVideoEmbed=video.get("embed_code");this.updatePaginationArrows();this.renderCurrentFullscreenPage();this.setActiveToClickedVideo();this.updateViewMoreLink()},updateViewMoreLink:function(){this.hideFullscreenViewMore();if(this.onLastPage()){this.showFullscreenViewMore()}},setActiveToClickedVideo:function(){ComplexTVV2.$("#ctv-v2-fullscreen-video-list-"+this.widgetId+" .li-"+this.activePlayingVideoEmbed).parent().addClass("active")},setVideoDetailsText:function(text){ComplexTVV2.$(".ctv-v2-title").text(text)},setVideoDescText:function(text){ComplexTVV2.$(".ctv-v2-desc").html(text)},setVideoDetailsLink:function(url){var urlWithUtmCode=url+this.options.utmStringForVideoTitle;ComplexTVV2.$(".ctv-v2-link-to-video").attr("href",urlWithUtmCode)},showDisqusCommentsCount:function(url){disqus_shortname="complextv";this.prepareCommentsLink(url);if(typeof DISQUSWIDGETS==="undefined"){this.insertDisqusCode()}else{if(this.complexDisqusScriptExist()){this.insertDisqusCode()}}},complexDisqusScriptExist:function(){var len=ComplexTVV2.$("script").filter(function(){return(ComplexTVV2.$(this).attr("src")=="http://cmplx.disqus.com/count.js")}).length;return len!=0&&DISQUSWIDGETS.forum==this.complexDisqusShortName},prepareCommentsLink:function(url){var disqusURL=url+"#disqus_thread";this.setCommentsLink(disqusURL)},setCommentsLink:function(url){ComplexTVV2.$(".ctv-v2-link-to-comments").attr("href",url)},insertDisqusCode:function(){(function(){var s=document.createElement("script");s.async=true;s.type="text/javascript";s.src="http://complextv.disqus.com/count.js";(document.getElementsByTagName("HEAD")[0]||document.getElementsByTagName("BODY")[0]).appendChild(s)}())},updateSharingButtons:function(video){ComplexTVV2._.each(this.shareButtons,function(shareButton){shareButton.updateToShareVideo(video)})},handleFullscreenEvents:function(){this.setDrawingInitClasses();this.disableBackgroundScroll();this.handleFullscreenNextPageClick();this.handleFullscreenPreviousPageClick();this.handleFullscreenLogoClick();this.handlefullscreenViewMoreClick();this.handleFullscreenVideoTitleClick();this.showFullscreenContent();this.setPlayerDimension();this.attachCloseButton();this.handleCloseButtonClick();this.trackOverlayLoad();this.resizeColorbox()},disableBackgroundScroll:function(){ComplexTVV2.$("html").css({overflow:"hidden"})},enableBackgroundScroll:function(){ComplexTVV2.$("html").css({overflow:""})},trackOverlayLoad:function(){this.trackEvent({action:"Overlay Load Complete",label:"Overlay Loaded",widgetId:this.widgetId})},attachCloseButton:function(){ComplexTVV2.$("body").append('<div id="ctv-v2-close">CLOSE</div>')},setPlayerDimension:function(){var playerWidth;var playerHeight;var windowWidth=ComplexTVV2.$(window).width();var windowHeight=ComplexTVV2.$(window).height();if(windowWidth<=604){playerWidth=200}else{if(windowWidth==768){playerWidth=315}else{if(windowWidth<=966&&windowHeight<=966){playerWidth=470}else{playerWidth=(windowWidth-110)*0.58}}}playerHeight=playerWidth*(9/16);ComplexTVV2.$("#ctv-v2-player-"+this.widgetId).css({width:playerWidth+"px",height:playerHeight+"px"})},handleFullscreenLogoClick:function(){var that=this;ComplexTVV2.$("#ctv-v2-fullscreen-logo").on("click",function(event){that.trackLogoClick("overlay")})},handlefullscreenViewMoreClick:function(){var that=this;ComplexTVV2.$(".ctv-v2-video-fullscreen-"+this.widgetId+" .ctv-v2-view-more").on("click",function(event){that.trackViewMoreClick("overlay")})},handleClosedEvents:function(){if(this.drawingInitClassIsSet()){return}ComplexTVV2.$("#cboxOverlay,#colorbox,#ctv-v2-close").addClass("drawing");this.handleCloseCleanUp();if(this.shouldUpdateCloseView()){this.updatePaginationArrows();this.updateViewMore();this.renderCurrentPage()}},drawingInitClassIsSet:function(){return ComplexTVV2.$(".drawing-init").length>0},setDrawingInitClasses:function(){ComplexTVV2.$("#cboxOverlay,#colorbox,#ctv-v2-close").addClass("drawing-init")},handleOnCompleteEvents:function(video){ComplexTVV2.$("#cboxOverlay,#colorbox,#ctv-v2-close").removeClass("drawing").removeClass("drawing-init");this.updateVideoDetailsWithVideo(video)},handleFullscreenNextPageClick:function(){var that=this;var callback=ComplexTVV2._.bind(this.fullscreenNextPageClickEvent,this);ComplexTVV2.$(".ctv-v2-video-fullscreen-"+this.widgetId+" .ctv-v2-nav-next").on("click",callback);ComplexTVV2.$(".ctv-v2-video-fullscreen-"+this.widgetId).hammer(this.hammerOptions).on("swipeleft",callback)},fullscreenNextPageClickEvent:function(event){this.haltEventPropagation(event);if(!this.onLastPage()){this.hideFullscreenViewMore();if(this.onSecondLastPage()){this.showFullscreenViewMore()}this.incrementPage();this.updatePaginationArrows();this.renderCurrentFullscreenPage();this.trackNextPageClick("overlay")}this.setActiveToClickedVideo()},handleFullscreenPreviousPageClick:function(event){var that=this;var callback=ComplexTVV2._.bind(this.fullscreenPreviousPageClickEvent,this);ComplexTVV2.$(".ctv-v2-video-fullscreen-"+this.widgetId+" .ctv-v2-nav-previous").on("click",callback);ComplexTVV2.$(".ctv-v2-video-fullscreen-"+this.widgetId).hammer(this.hammerOptions).on("swiperight",callback)},fullscreenPreviousPageClickEvent:function(event){this.haltEventPropagation(event);this.hideFullscreenViewMore();if(!this.onFirstPage()){this.decrementPage();this.updatePaginationArrows();this.renderCurrentFullscreenPage();this.trackPreviousPageClick("overlay")}this.setActiveToClickedVideo()},handleFullscreenVideoTitleClick:function(event){var that=this;ComplexTVV2.$(".ctv-v2-video-fullscreen-"+this.widgetId+" .ctv-v2-title").on("click",function(event){var videoTitle=ComplexTVV2.$(event.target).text();that.trackVideoTitleClick(videoTitle)})},trackVideoTitleClick:function(videoTitle){this.trackEvent({action:"Click - Video Title",label:videoTitle,widgetId:this.widgetId})},showFullscreenContent:function(){ComplexTVV2.$(".ctv-v2-video-fullscreen-"+this.widgetId).show()},onFirstPage:function(){return this.page==1},decrementPage:function(){this.setPage(this.page-1)},handleCloseCleanUp:function(){ComplexTVV2.$(".ctv-v2-video-fullscreen-"+this.widgetId).hide();ComplexTVV2.$("#ctv-v2-close").remove();this.enableBackgroundScroll();this.setBackComplexDisqusShortName()},setBackComplexDisqusShortName:function(){disqus_shortname=this.complexDisqusShortName;DISQUSWIDGETS.forum=this.complexDisqusShortName},handleCloseButtonClick:function(){var that=this;ComplexTVV2.$("#ctv-v2-close").on("click",function(event){ComplexTVV2.$.colorbox.close();that.handleCloseCleanUp();if(that.shouldUpdateCloseView()){that.updatePaginationArrows();that.updateViewMore();that.renderCurrentPage()}})},shouldUpdateCloseView:function(){return this.widgetId!="v2-widget-list"},updateViewMore:function(){this.hideViewMore();if(this.onLastPage()){this.showViewMore()}},resizeColorbox:function(){ComplexTVV2.$.colorbox.resize({width:"80%"})}});ComplexTVV2.Application={DEFAULT_THUMBNAIL_HEIGHT:78,DEFAULT_LAYOUT:1,DEFAULT_THEME:"complex",DEFAULT_VIDEO_COUNT:4,setWidgetOptions:function(element){this.element=element;this.widgetId=element.data("widget-id");this.layout=this.element.data("layout")||this.DEFAULT_LAYOUT;this.labelIds=this.element.data("label-ids");this.theme=this.element.data("theme")||this.DEFAULT_THEME;this.thumbnailHeight=this.element.data("thumbnailHeight")||this.DEFAULT_THUMBNAIL_HEIGHT;this.thumbnailWidth=Math.round(this.thumbnailHeight*(16/9));this.videoCount=this.getCustomVideoCount(this.element.data("video-count"))},getCustomVideoCount:function(value){return this.getCustomValueWithinLimit(value,2,10)},getCustomValueWithinLimit:function(data,minimum,maximum){var customValue=data;if(typeof(customValue)==="undefined"){return undefined}return(customValue>=minimum&&customValue<=maximum)?customValue:undefined},appendWidgetCSSToHead:function(){this.appendMarkupToHead(this.getMarkupForWidgetCSS())},appendComplexSVGToHead:function(){var complexSVGLink="//svg.complex.com/css/cmplx-svg.css";if(!ComplexTVV2.$('link[href="'+complexSVGLink+'"]').length){this.appendMarkupToHead('<link href="'+complexSVGLink+'" rel="stylesheet" />')}},appendMarkupToHead:function(markup){ComplexTVV2.$(markup).appendTo("head")},getMarkupForWidgetCSS:function(){return'<link href="'+this.pathToCSS()+'" media="all" type="text/css" rel="stylesheet" />'},pathToCSS:function(){var supportedThemes={"complex-news":"http://assets.complex.com/tv/css/widget_v2/complex-news.min.d84e3678be0cbc989b180b5e7233d241.css",original:"http://assets.complex.com/tv/css/widget_v2/original.min.c968d0b1b7611bf5a28ab6c8af24a9c8.css"};var theme=this.theme;if(supportedThemes.hasOwnProperty(theme)){return supportedThemes[theme]}return supportedThemes.original},initializeWidgetProperties:function(){this.initializeNumberOfVideoDetailLines();this.initializeUtmCode()},initializeNumberOfVideoDetailLines:function(){this.numberOfVideoDetailLines=Math.floor(this.thumbnailHeight/15)},initializeUtmCode:function(){var utmString=this.generateUtmString()+"&utm_content=";this.utmStringForCTVLogo=utmString+"CTVLogo";this.utmStringForViewMore=utmString+"MoreComplexTVLink";this.utmStringForVideoTitle=utmString+"VideoTitle"},generateUtmString:function(){var utmSource=this.theme;var utmMedium="referral";var utmCampaign="ComplexTvWidget";return"?utm_source="+utmSource+"&utm_medium="+utmMedium+"&utm_campaign="+utmCampaign},compileVideoTemplate:function(){ComplexTVV2.Templates.Video=ComplexTVV2._.template('<a class="ctv-v2-image-wrapper" href="<%= url %>"><span class="ctv-v2-rounded"><img src="<%= thumbnail_image_url %>" alt="<%- name %>" onerror="ComplexTVV2.Application.replaceMissingImage(this, \'default.png\');"/></span></a><div class="ctv-v2-details li-<%= embed_code %>"><a href="<%= url %>"><span class="ctv-v2-ellipsis-text"><%- short_headline !== null ? short_headline : display_title %></span></a></div>');ComplexTVV2.Templates.FeaturedVideo=ComplexTVV2._.template('<a class="ctv-v2-image-wrapper" href="<%= url %>"><span class="ctv-v2-rounded"><img src="<%= mobile_image_url %>" alt="<%- name %>" onerror="ComplexTVV2.Application.replaceMissingImage(this, \'default.png\');"/></span></a><div class="ctv-v2-details li-<%= embed_code %>"><a href="<%= url %>"><span class="ctv-v2-ellipsis-text"><%- short_headline !== null ? short_headline : display_title %></span></a></div>')},prepareDynamicWidgetStyles:function(){var widgetWidth=this.element.width();var liElementsWidth=widgetWidth-60;var layout=this.layout;var widgetId='div[data-widget-id="'+this.widgetId+'"]';var css={};if(layout===1){css[widgetId]={"min-height":"520px !important"}}else{if(layout===2){var widgetLiWidth=liElementsWidth/2-20;css[widgetId]={"min-height":"320px !important"};css[widgetId+" ul.ctv-v2-video-list li"]={width:"50% !important"};css[widgetId+" ul.ctv-v2-video-list li.first"]={width:"50% !important"};css[widgetId+" ul.ctv-v2-video-list li.first img"]={width:"93% !important"};css[widgetId+" ul.ctv-v2-video-list li.first .ctv-v2-details"]={width:widgetLiWidth+"px !important"}}}if(this.widgetId==="v2-viewport"&&this.theme==="complex-news"){css[widgetId+" .ctv-v2-nav-wrapper"]={display:"none"};css[widgetId+" .ctv-v2-video-list li.first .ctv-v2-image-wrapper"]={width:"150px !important"};css[widgetId+" .ctv-v2-video-list li.first .ctv-v2-details"]={"float":"left"};css[widgetId+" .ctv-v2-header"]={display:"none !important"};css[widgetId]={"background-image":"none !important"};css[widgetId+" .ctv-v2-content"]={"padding-top":"0px !important"}}this.appendMarkupToHead('<style type="text/css">'+this.buildCSS(css)+"</style>")},buildCSS:function(rules){var css="";ComplexTVV2._.each(rules,function(rulesForSelector,selector){css=css+selector+" { ";ComplexTVV2._.each(rulesForSelector,function(value,property){css=css+property+": "+value+"; "});css=css+"}"});return css},prepareWidgetMarkup:function(){var playerMarkup='<div class="ctv-v2-player-wrapper"><div id="ctv-v2-player-'+this.widgetId+'"></div></div>';var titleMarkup='<a class="ctv-v2-link-to-video" target="_self" href="#"><h2 class="ctv-v2-title"></h2></a><hr />';var descMarkup='<div class="ctv-v2-desc-comment"><div class="ctv-v2-desc"></div><div class="ctv-v2-comment"><a class="ctv-v2-link-to-comments" target="_self" href="#"></a></div></div>';var facebook='<li class="facebook"><a class="ctv-v2-facebook-share" href="#" target="_blank" title="Share on Facebook"><i class="cmplx-icon icon-facebook"></i></a></li>';var twitter='<li class="twitter"><a class="ctv-v2-twitter-share" href="#" target="_blank" title="Share on Twitter"><i class="cmplx-icon icon-twitter"></i></a></li>';var google='<li class="google-plus"><a class="ctv-v2-google-plus-share" href="#" target="_blank" title="Share on Google+"><i class="cmplx-icon icon-google-plus"></i></a></li>';var shareButtons='<ul class="ctv-v2-share-btns">'+facebook+twitter+google+"</ul>";var shareText='<span class="ctv-v2-share-text">Share This</span>';var shareWrapper='<div class="ctv-v2-share-wrapper">'+shareText+shareButtons+"</div>";var videoDetailsMarkup='<div class="ctv-v2-video-details">'+titleMarkup+descMarkup+shareWrapper+"</div>";var adMarkup='<div id="ctv-v2-ad-container"><div id="ctv-v2-companion-ad-container"><div id="cmnWidgetCompanion"></div></div><span class="ctv-v2-ad-background"></span></div>';var viewMoreMarkup='<div class="ctv-v2-view-more"><a target="_self" href="http://www.complex.com/tv/'+this.utmStringForViewMore+'">More on Complex TV</a></div>';var headerNavMarkup='<div class="ctv-v2-nav-wrapper"><a class="ctv-v2-nav-previous"><i class="cmplx-icon icon-widget-left"></i></a><a class="ctv-v2-nav-next"><i class="cmplx-icon icon-widget-right"></i></a></div>';var fullscreenVideoListMarkup='<div class="ctv-v2-fullscreen-content">'+adMarkup+'<ul id="ctv-v2-fullscreen-video-list-'+this.widgetId+'"></ul></div>';var fullscreenHeaderMarkup='<div class="ctv-v2-fullscreen-header">'+headerNavMarkup+"</div>";var fullscreenWidget='<div class="ctv-v2-fullscreen-container">'+fullscreenHeaderMarkup+fullscreenVideoListMarkup+viewMoreMarkup+"</div>";var wrapperMarkup='<div class="ctv-v2-video-fullscreen-'+this.widgetId+'" style="display: none;">'+playerMarkup+videoDetailsMarkup+fullscreenWidget+"</div>";var videoListMarkup='<ul class="ctv-v2-video-list"></ul>';var headerMarkup='<div class="ctv-v2-header"><a class="ctv-v2-logo cmplx-svg-complex-tv-logo-dark" target="_self" href="http://www.complex.com/tv/'+this.utmStringForCTVLogo+'"></a>'+headerNavMarkup+viewMoreMarkup+"</div>";var contentMarkup='<div class="ctv-v2-content">'+videoListMarkup+"</div>";this.element.html(headerMarkup+contentMarkup+viewMoreMarkup+wrapperMarkup)},createWidget:function(){var options=this.getOptionsForWidget();var widget=new ComplexTVV2.Views.Widget(options);widget.performInitialFetch()},getOptionsForWidget:function(){var that=this,perPageValue=this.videoCount,isComplexNewsValue=false;if(this.widgetId==="v2-viewport"){perPageValue=4;isComplexNewsValue=true}var options={perPage:perPageValue,isComplexNews:isComplexNewsValue,complexNewsCounts:this.videoCount,utmStringForVideoTitle:this.utmStringForVideoTitle,element:this.element};ComplexTVV2._.each({labelIds:"label-ids",playerId:"player-id",defaultFilter:"default-filter",includeOnlyLabels:"curation-include-only-labels",excludeLabels:"curation-exclude-labels",includeOnlyKeywords:"curation-include-only-keywords",excludeKeywords:"curation-exclude-keywords",collation:"curation-collation",includeAllLabels:"curation-include-all-labels"},function(dataAttribute,optionId){var customValue=that.element.data(dataAttribute);if(typeof(customValue)!=="undefined"){options[optionId]=customValue}});return options},haltEventPropagation:function(event){event.preventDefault();event.stopImmediatePropagation()},replaceMissingImage:function(image,filename){image.onerror="";image.src="http://assets.complex.com/tv/images/"+filename;return true}};ComplexTVV2.AdManager=(function(){function AdManager(numberOfVideosBeforeFirstAd,numberOfVideosBetweenAds){this._numberOfVideosBeforeFirstAd=numberOfVideosBeforeFirstAd;this._numberOfVideosBetweenAds=numberOfVideosBetweenAds;this._initializeCookies()}AdManager.prototype._initializeCookies=function(){if(this._cookiesAreEnabled()){this._initializeNumberOfVideosCookie();this._initializeInitialAdCookie()}};AdManager.prototype._cookiesAreEnabled=function(){return ComplexTVV2.Cookies.enabled};AdManager.prototype._initializeNumberOfVideosCookie=function(){if(this._cookieIsNotSet("numberOfVideosSinceLastAd")){this._setNumberOfVideosSinceLastAd(0)}};AdManager.prototype._cookieIsNotSet=function(cookieName){return typeof(this._getCookie(cookieName))==="undefined"};AdManager.prototype._getCookie=function(cookieName){return ComplexTVV2.Cookies.get(cookieName)};AdManager.prototype._setNumberOfVideosSinceLastAd=function(numberOfVideos){return this._setCookie("numberOfVideosSinceLastAd",numberOfVideos)};AdManager.prototype._setCookie=function(cookieName,cookieValue,options){return ComplexTVV2.Cookies.set(cookieName,cookieValue,options)};AdManager.prototype._initializeInitialAdCookie=function(){if(this._cookieIsNotSet("initialAdHasPlayed")){this._setInitialAdHasPlayed(false)}};AdManager.prototype._setInitialAdHasPlayed=function(value){return this._setCookie("initialAdHasPlayed",value)};AdManager.prototype._shouldPlayPreroll=function(){if(this._cookiesAreDisabled()){return true}return this._shouldShowInitialAd()||this._shouldShowAlternatingAd()};AdManager.prototype._cookiesAreDisabled=function(){return !this._cookiesAreEnabled()};AdManager.prototype._shouldShowInitialAd=function(){return this._initialAdHasNotPlayed()&&this._numberOfVideosSinceLastAd()>=this._numberOfVideosBeforeFirstAd};AdManager.prototype._initialAdHasNotPlayed=function(){return !this._initialAdHasPlayed()};AdManager.prototype._initialAdHasPlayed=function(){return this._getCookie("initialAdHasPlayed")==="true"};AdManager.prototype._shouldShowAlternatingAd=function(){return this._initialAdHasPlayed()&&this._numberOfVideosSinceLastAd()>=this._numberOfVideosBetweenAds};AdManager.prototype._numberOfVideosSinceLastAd=function(){var value=this._getCookie("numberOfVideosSinceLastAd");return typeof(value)!=="undefined"?parseInt(value,10):0};AdManager.prototype.didPlayVideoWithAd=function(){if(this._initialAdHasNotPlayed()){this._didPlayInitialAd()}this._resetNumberOfVideosSinceLastAd();this._incrementNumberOfVideosSinceLastAd()};AdManager.prototype._didPlayInitialAd=function(){this._setInitialAdHasPlayed(true)};AdManager.prototype._resetNumberOfVideosSinceLastAd=function(){this._setNumberOfVideosSinceLastAd(0)};AdManager.prototype.didPlayVideoWithoutAd=function(){this._incrementNumberOfVideosSinceLastAd()};AdManager.prototype._incrementNumberOfVideosSinceLastAd=function(){this._setNumberOfVideosSinceLastAd(this._numberOfVideosSinceLastAd()+1)};AdManager.prototype.getPlayheadTimeChangedCallback=function(){return this._playheadTimeChangedCallback};AdManager.prototype.getOptionsForAdvertisement=function(){return this._playerOptions};AdManager.prototype.willPlayVideo=function(video){if(video.shouldAlwaysHavePreroll()){this.willPlayPreroll(video);this.doNothingOnPlayheadTimeChanged();return}if(video.shouldNeverHavePreroll()){this.willNotPlayPreroll(video);this.doNothingOnPlayheadTimeChanged();return}var shouldPlayPreroll=this._shouldPlayPreroll();if(video.isPromotional()){this.willPlayPreroll(video);if(shouldPlayPreroll){this.doNothingOnPlayheadTimeChanged()}else{this.trackViewWithoutAd()}return}if(video.isAdult()){this.willPlayPreroll(video);if(shouldPlayPreroll){this.trackViewWithAd()}else{this.trackViewWithoutAd()}return}if(shouldPlayPreroll){this.willPlayPreroll(video);this.trackViewWithAd();return}this.willNotPlayPreroll(video);this.trackViewWithoutAd()};AdManager.prototype.willPlayPreroll=function(video){var options={"google-ima-ads-manager":{playWhenAdClick:true,adTagUrl:this._generateNewAdTagForVideo(video)},adSetCode:"3f3b9e47c2954e21bdfb5618c47a61ea"};if(video.doesNotHaveAdSetOverride()){ComplexTVV2.$.extend(options,{adSetCode:"d0601749e69a442b831cde6ba43c2abb"})}if(video.hasAdSetOverride()){ComplexTVV2.$.extend(options,{adSetCode:video.getAdSet()})}this._playerOptions=options};AdManager.prototype._generateNewAdTagForVideo=function(video){var exclusions=video.get("ad_exclusions");var keywords=typeof(exclusions)!=="undefined"?exclusions.join(","):[];var embedCode=video.get("embed_code");return typeof(cmnWidget)==="function"?cmnWidget(keywords)+embedCode:"http://pubads.g.doubleclick.net/gampad/ads?sz=640x360&iu=/5202/cmn_complextv/home&ciu_szs&impl=s&gdfp_req=1&env=vp&output=xml_vast2&unviewed_position_start=1&correlator=8215644650626928&cust_params=kw%3Ds_pop%2Cto%2Ct2%2Chome%2Csubhome%2Cinternal%2Ctv%2Cdefault_embed%26"};AdManager.prototype.doNothingOnPlayheadTimeChanged=function(){this._playheadTimeChangedCallback=undefined};AdManager.prototype.willNotPlayPreroll=function(video){var options={"google-ima-ads-manager":{adTagUrl:undefined},adSetCode:"bc69025d6e364d99950d3e95d2918d71"};if(video.hasAdSetOverride()){ComplexTVV2.$.extend(options,{adSetCode:video.getAdSet()})}this._playerOptions=options};AdManager.prototype.hasPlayheadTimeChangedCallback=function(){return typeof(this._playheadTimeChangedCallback)==="function"};AdManager.prototype.trackViewWithAd=function(){this._playheadTimeChangedCallback=ComplexTVV2._.once(ComplexTVV2._.bind(this.didPlayVideoWithAd,this))};AdManager.prototype.trackViewWithoutAd=function(){this._playheadTimeChangedCallback=ComplexTVV2._.once(ComplexTVV2._.bind(this.didPlayVideoWithoutAd,this))};return AdManager}());ComplexTVV2.OoyalaPlayerManager=(function(){function OoyalaPlayerManager(){this.initializeCache()}ComplexTVV2._.extend(OoyalaPlayerManager.prototype,{cachedOoyalaPlayers:0,namespaceCounter:0,cachedOoyalaPlayerNames:null,ooyalaPlayerId:null,initializeCache:function(){this.cachedOoyalaPlayerNames=new Array()},seedCache:function(playerId,numberOfPlayersToCache){var callback=this.incrementCache;if(this.cachedOoyalaPlayers>3){return}this.ooyalaPlayerId=playerId;for(var i=0;i<numberOfPlayersToCache;++i){this.downloadOoyalaPlayer(playerId,callback)}},incrementCache:function(){++this.cachedOoyalaPlayers},decrementCache:function(){--this.cachedOoyalaPlayers},downloadOoyalaPlayer:function(playerId,callback){var baseUrl="http://player.ooyala.com/v3/";var namespace=this.getNextNameSpace();var downloadUrl=baseUrl+playerId+"?namespace="+namespace;var trackRequest=ComplexTVV2._.bind(this.storeCacheName,this,namespace);this.addUnderscoreIfMissing();ComplexTVV2.$.getScript(downloadUrl,function(){trackRequest();callback()})},storeCacheName:function(namespace){this.incrementCache();this.cachedOoyalaPlayerNames.push(namespace)},prepareOoyalaPlayer:function(playerId,callback){if(this.hasCachedPlayer()){callback()}else{return this.downloadOoyalaPlayer(playerId,callback)}},addUnderscoreIfMissing:function(){if(typeof(window._)==="undefined"){window._=ComplexTVV2._}},getPlayer:function(){return this.getCachedPlayer()},getCachedPlayer:function(){var cachedPlayerName=this.cachedOoyalaPlayerNames.pop();this.decrementCache();this.seedCache(this.ooyalaPlayerId,1);return[window[cachedPlayerName],cachedPlayerName]},getNextNameSpace:function(){++this.namespaceCounter;return"ComplexTVV2_"+this.namespaceCounter},hasCachedPlayer:function(){return this.cachedOoyalaPlayers>0},destroy:function(playerName){try{delete window[playerName]}catch(e){window[playerName]=undefined}}});return OoyalaPlayerManager}());function initializeComplexWidget(widgetDataId){ComplexTVV2.$(function(){var element=ComplexTVV2.$('[data-widget-id="'+widgetDataId+'"]');var application=ComplexTVV2.Application;application.setWidgetOptions(element);application.appendWidgetCSSToHead();application.appendComplexSVGToHead();application.initializeWidgetProperties();application.compileVideoTemplate();application.prepareDynamicWidgetStyles();application.prepareWidgetMarkup();application.createWidget()})}window.initializeComplexWidget=initializeComplexWidget})();